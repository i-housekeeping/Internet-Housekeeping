Ext.namespace('Ext.ux.Sprocket');Ext.override(Ext.util.Observable,{subscribe:function(eventName,fn,scope,o){Ext.ux.Sprocket.PubSub.addEvents(eventName);Ext.ux.Sprocket.PubSub.on(eventName,fn,scope,o);},publish:function(eventName,event){if(Ext.ux.Sprocket.PubSub.eventsSuspended===true)
return true;if(!Ext.ux.Sprocket.PubSub.events)
return false;var glob=Ext.ux.Sprocket.PubSub.events['*'];if(glob)
if(glob.fire.call(glob,event,eventName)===false)
return true;if(eventName.substr(0,1)=='/'&&eventName.length>1){var chans=eventName.substr(1).split('/');var matched=false;for(var i=0,len=chans.length;i<=len;i++){var fn=Ext.ux.Sprocket.PubSub.events['/'+chans.slice(0,i).join('/').toLowerCase()];if(fn){matched=true;if(fn.fire.call(fn,event,eventName)===false)
return true;}}
return matched;}else{var fn=Ext.ux.Sprocket.PubSub.events[eventName.toLowerCase()];if(fn){fn.fire.call(fn,event,eventName);return true;}}
return false;},removeSubcribers:function(eventName){for(var evt in Ext.ux.Sprocket.PubSub.events){if((evt==eventName)||(!eventName)){var fn=Ext.ux.Sprocket.PubSub.events[evt];if(fn)
Ext.ux.Sprocket.PubSub.events[fn].clearListeners();}}}});Ext.ux.Sprocket.PubSub=new Ext.util.Observable();Ext.namespace('Ext.ux.WindowSnap');Ext.override(Ext.Window,{initDraggable:function(){this.dd=new Ext.ux.WindowSnap.DD(this);}});Ext.ux.WindowSnap={version:'1.6',snapRange:20,dragSnap:false,dropSnap:true,animateDropSnap:true};Ext.ux.WindowSnap.DD=function(){Ext.ux.WindowSnap.DD.superclass.constructor.apply(this,arguments);};Ext.extend(Ext.ux.WindowSnap.DD,Ext.Window.DD,{startDrag:function(){Ext.ux.WindowSnap.DD.superclass.startDrag.apply(this,arguments);if(Ext.ux.WindowSnap.dragSnap)
this._getSnapData();},endDrag:function(){Ext.ux.WindowSnap.DD.superclass.endDrag.apply(this,arguments);if(Ext.ux.WindowSnap.dropSnap){this._getSnapData();var pos=this.win.getPosition();this.setSnapXY(this.win.el,pos[0],pos[1],true);}
this.snapDD=[];},alignElWithMouse:function(el,iPageX,iPageY){var oCoord=this.getTargetCoord(iPageX,iPageY);var fly=el.dom?el:Ext.fly(el,'_dd');if(!this.deltaSetXY){var aCoord=[oCoord.x,oCoord.y];fly.setXY(aCoord);var newLeft=fly.getLeft(true);var newTop=fly.getTop(true);this.deltaSetXY=[newLeft-oCoord.x,newTop-oCoord.y];}else{if(Ext.ux.WindowSnap.dragSnap)
this.setSnapXY(fly,oCoord.x+this.deltaSetXY[0],oCoord.y+this.deltaSetXY[1]);else
fly.setLeftTop(oCoord.x+this.deltaSetXY[0],oCoord.y+this.deltaSetXY[1]);}
this.cachePosition(oCoord.x,oCoord.y);this.autoScroll(oCoord.x,oCoord.y,el.offsetHeight,el.offsetWidth);return oCoord;},setSnapXY:function(fly,x,y,drop){var box=this.win.getBox();var range=Ext.ux.WindowSnap.snapRange;var viewTop=0;var viewLeft=0;var viewBottom=app.desktop.el.getHeight();var viewRight=(Ext.lib.Dom.getViewWidth()-1);var lx=[];var ly=[];if(Math.abs(x-viewLeft)<range)
lx.push(viewLeft);else if(Math.abs((x+box.width)-viewRight)<range)
lx.push(viewRight-box.width);if(Math.abs(y-viewTop)<range)
ly.push(viewTop);else if(Math.abs((y+box.height)-viewBottom)<range)
ly.push(viewBottom-box.height);for(var i=0,len=this.snapDD.length;i<len;i++){var nx=undefined;if(Math.abs(x-(this.snapDD[i].x+this.snapDD[i].width))<range){nx=this.snapDD[i].x+this.snapDD[i].width;}else if(Math.abs((x+box.width)-this.snapDD[i].x)<range){nx=this.snapDD[i].x-box.width;}
if(nx!==undefined&&(y>=this.snapDD[i].y&&y<=(this.snapDD[i].y+this.snapDD[i].height)||(y+box.height>=this.snapDD[i].y&&y+box.height<=(this.snapDD[i].y+this.snapDD[i].height)))){if(nx<0)
continue;lx.push(nx);continue;}
var ny=undefined;if(Math.abs(y-(this.snapDD[i].y+this.snapDD[i].height))<range){ny=this.snapDD[i].y+this.snapDD[i].height;}else if(Math.abs((y+box.height)-this.snapDD[i].y)<range){ny=this.snapDD[i].y-box.height;}
if(ny!==undefined&&(x>=this.snapDD[i].x&&x<=(this.snapDD[i].x+this.snapDD[i].width)||(x+box.width>=this.snapDD[i].x&&x+box.width<=(this.snapDD[i].x+this.snapDD[i].width)))){if(ny<0)
continue;ly.push(ny);continue;}}
if(lx.length){lx=lx.sort(function(a,b){return Math.abs(a-x)<Math.abs(b-x)?-1:Math.abs(a-x)>Math.abs(b-y)?1:0});x=lx[0];}
if(ly.length){ly=ly.sort(function(a,b){return Math.abs(a-y)<Math.abs(b-y)?-1:Math.abs(a-y)>Math.abs(b-y)?1:0});y=ly[0];}
if(drop&&Ext.ux.WindowSnap.animateDropSnap)
fly.moveTo(x,y,{easing:'bounceOut',duration:.3});else
fly.setLeftTop(x,y);},_getSnapData:function(){var snapDD=this.snapDD=[];var win=this.win;win.manager.each(function(w){if(!w||!w.isVisible()||win===w)
return;snapDD.push(w.getBox());});}});Ext.namespace('sprocket','Ext.ux.Sprocket');(function(){if(window.defined===undefined)
defined=function(o){return o!==undefined};var log;if(window.log){log=window.log;}else if(Ext.log){log=Ext.log;}else if(window.console){if(window.controllers){log=function(){window.console.log.apply(window.console,arguments);};}else{log=function(m){window.console.log(m);};}}else{log=Ext.emptyFn;}
var VERSION='0.1';var STATE_CONNECTING=0;var STATE_OPEN=1;var STATE_CLOSED=2;Ext.ux.Sprocket.Socket=function(config){Ext.apply(this,config);this.initialize(config||{});};Ext.extend(Ext.ux.Sprocket.Socket,Ext.util.Observable,{initialize:function(config){this.version=VERSION;this.CONNECTING=STATE_CONNECTING;this.OPEN=STATE_OPEN;this.CLOSED=STATE_CLOSED;this.parseWSURL();this.addEvents({message:true,data:true,open:true,close:true});this.readyState=STATE_CLOSED;if(Ext.air){this.socket=new air.Socket();this.socket.addEventListener(air.Event.CONNECT,this.onConnected.createDelegate(this));this.socket.addEventListener(air.IOErrorEvent.IO_ERROR,this.onDisconnected.createDelegate(this));this.socket.addEventListener(air.SecurityErrorEvent.SECURITY_ERROR,this.onDisconnected.createDelegate(this));this.socket.addEventListener(air.Event.CLOSE,this.onDisconnected.createDelegate(this));this.socket.addEventListener(air.ProgressEvent.SOCKET_DATA,this.onData.createDelegate(this));}else{if(!defined(Ext.ux.Sprocket.socketMan))
Ext.ux.Sprocket.socketMan=new Ext.ux.Sprocket.SocketManager(config.manager||{});Ext.ux.Sprocket.socketMan.onCreate(this);}},parseWSURL:function(){if(!defined(this.url)||!this.url.match(/^(wss?|s?tcp|pubsub):\/\/([^:|\/]+)(?::(\d+))?(\/.*)?/))
throw new Error("SYNTAX_ERR");this.proto=RegExp.$1;this.secure=false;if(this.proto=='wss'){this.secure=true;}else if(this.proto=='stcp'){this.secure=true;}
this.host=RegExp.$2;if(RegExp.$3==null){this.port=this.secure?815:81;}else{this.port=RegExp.$3;}
this.resource=RegExp.$4||'/';},destroy:function(){this.disconnect();if(this.socket){this.socket.removeEventListener(air.Event.CONNECT,this.onConnected.createDelegate(this));this.socket.removeEventListener(air.IOErrorEvent.IO_ERROR,this.onDisconnected.createDelegate(this));this.socket.removeEventListener(air.SecurityErrorEvent.SECURITY_ERROR,this.onDisconnected.createDelegate(this));this.socket.removeEventListener(air.Event.CLOSE,this.onDisconnected.createDelegate(this));this.socket.removeEventListener(air.ProgressEvent.SOCKET_DATA,this.onData.createDelegate(this));this.socket.disconnect();}
if(Ext.ux.Sprocket.socketMan)
Ext.ux.Sprocket.socketMan.onDestroy(this);},connect:function(host,port){if(this.readyState==STATE_OPEN)
return;if(!Ext.isEmpty(host))
this.host=host;if(!Ext.isEmpty(port))
this.port=port;this.filter.reset();if(this.socket){this.readyState=STATE_CONNECTING;this.socket.connect(this.host,this.port);}else
Ext.ux.Sprocket.socketMan.onConnect(this,this.url);},disconnect:function(){if(this.readyState!=STATE_OPEN){if(this.socket){this.readyState=STATE_CLOSED;this.socket.close();}else
Ext.ux.Sprocket.socketMan.onDisconnect(this);}},postMessage:function(data){if(this.readyState!=STATE_OPEN)
throw new Error("INVALID_STATE_ERR");if(this.filter){var chunks=this.filter.put(data);if(chunks.length>0){if(this.socket){this.socket.writeUTFBytes(chunks);this.socket.flush();}else
Ext.ux.Sprocket.socketMan.onSend(this,chunks);}}else{if(this.socket){this.socket.writeUTFBytes(data);this.socket.flush();}else
Ext.ux.Sprocket.socketMan.onSend(this,data);}},send:function(){this.postMessage.apply(this,arguments);},onData:function(data){var evt={socket:this};if(this.socket){var ev=data;data=this.socket.readUTFBytes(this.socket.bytesAvailable);this.bytesLoaded=ev.bytesLoaded;this.bytesTotal=ev.bytesTotal;}
if(this.filter){var chunks;try{chunks=this.filter.get(data);}catch(e){log('Error in filter get call: '+e.message);};try{if(chunks.length>0)
evt.data=chunks;else
return;}catch(e){log('Error in socket data event call: '+e.message);return;};}else{evt.data=data;}
this.fireEvent('data',evt);if(this.onmessage)
this.onmessage(evt);},onConnected:function(){if(this.socket)
this.readyState=STATE_OPEN;var evt={socket:this};this.fireEvent('open',evt);if(this.onopen)
this.onopen(evt);},onDisconnected:function(ev){var evt={socket:this};if(this.socket){this.readyState=STATE_CLOSED;if(ev){evt.errorEvent=ev;evt.error=ev.text;if(ev.errorID)
evt.errorID=ev.errorID;}}
this.fireEvent('close',evt);if(this.onclose)
this.onclose(evt);}});if(!Ext.air){Ext.ux.Sprocket.SocketManager=function(config){Ext.apply(this,config);this.initialize(config||{});};Ext.extend(Ext.ux.Sprocket.SocketManager,Ext.util.Observable,{version:'0.1',endpointURL:'/sprocket.socket',timeout:45000,backoff:10000,xdomain:false,useJSONP:false,useCSS:false,initialize:function(config){this.sockets={};this.sids=[];this.reqChannel=[undefined,undefined];this.queue=[];this.channels=[];this.bytesIn=0;this.bytesOut=0;this.socketInstances=0;this.reqFailures=0;this.failureLimit=5;this.addEvents({sent:true,received:true});var l=document.location.hostname.split('.').reverse();var domain=l[0];if(l[1])
domain=l[1]+'.'+domain;config.origDomain=document.domain;config.domain=document.domain;if(this.xdomain&&(Ext.isIE||Ext.isOpera)&&!this.useCSS){this.useJSONP=true;}
if(this.xdomain&&!this.useJSONP){log('setting document.domain to '+domain);config.domain=domain;if(!Ext.isIE){try{document.domain=domain;}catch(e){log(e);};}}
if(this.endpointURL){this.endpointURL=this.endpointURL.replace('__DOMAIN__',config.domain);log('sprocket.socket url set to:'+this.endpointURL);}
if(this.xurl){this.xurl=this.xurl.replace('__DOMAIN__',config.domain);log('sprocket.socket xdomain url set to:'+this.xurl);}},destroy:function(e){this.sockets=null;this.queue.length=0;this.sids.length=0;this.reqChannel.length=0;},getAllConnectionIds:function(){var cids=[];for(var i=0,len=this.sids.length;i<len;i++){var s=this.sockets[this.sids[i]];if(s&&s.cid)
cids.push(s.cid);}
return cids;},onCreate:function(socket){this.socketInstances++;var id=socket.id=Ext.id(socket,'sock');this.sids.push(id);this.sockets[id]=socket;},onDestroy:function(socket){this.socketInstances--;this.sids.remove(socket.id);delete this.sockets[socket.id];},onSend:function(socket,data){this.queue.push({action:'send',id:socket.id,data:data});var bytes=data.length;this.fireEvent('sent',this,bytes,this.bytesOut);this.bytesOut+=bytes;this.checkQueue('onSend');},onConnect:function(socket,url){this.queue.push({action:'connect',id:socket.id,url:url});this.checkQueue('onConnect');},onDisconnect:function(socket){socket.readyState=STATE_CLOSED;var data={action:'disconnect',id:socket.id};if(socket.cid)
data.cid=socket.cid;this.queue.push(data);this.checkQueue('onDisconnect');},getSocket:function(id){return this.sockets[id];},deferCheck:function(delay,reason){if(this.deferId)
clearTimeout(this.deferId);return this.deferId=this.checkQueue.defer(delay||2000,this,[reason]);},checkQueue:function(from){if(this.deferId)
clearTimeout(this.deferId);var channel=1;if(defined(this.reqChannel[channel])&&this.isLoading(channel))
channel=2;if(defined(this.reqChannel[channel])&&this.isLoading(channel))
return this.deferCheck(2000,'both channels were busy');var out=[];var ids={};var splicer=[];var q,socket;while(this.queue.length>0){q=this.queue.shift();q.socket=this.getSocket(q.id);if(!defined(q.socket))
continue;ids[q.id]=1;var data={sid:q.id};if(q.socket&&q.socket.cid)
data.cid=q.socket.cid;if(channel>1)
data['nowait']=1;switch(q.action){case'connect':if(q.socket){q.socket.readyState=STATE_CONNECTING;delete q.socket.cid;delete data.cid;data.action='connect';data.url=q.url;out.push(data);}else
log('connect without socket, ignored');break;case'disconnect':if(q.socket)
q.socket.readyState=STATE_CLOSED;if(q.cid)
data.cid=q.cid;if(q.cid){data.action='disconnect';out.push(data);}
break;case'send':if(q.socket.cid){data.send=q.data;out.push(data);}else
log('send while not connected on '+q.id);break;default:log('undefined action: '+q.action);break;}}
var polling=(channel==1&&this.queue.length==0&&out.length==0)?true:false;if(polling){var socket;for(var i=0,len=this.sids.length;i<len;i++){if(!ids[this.sids[i]]){socket=this.getSocket(this.sids[i]);if(socket.readyState==STATE_CLOSED)
continue;out.push({cid:socket.cid,sid:this.sids[i]});}}}
if(out.length>0)
this.reqChannel[channel]=this.ajaxRequest(out,channel);else{var defer=false;var socket;for(var i=0,len=this.sids.length;i<len;i++){socket=this.getSocket(this.sids[i]);if(!socket)
continue;if(socket.readyState==STATE_CLOSED)
continue;defer=true;}
if(defer){if(defined(this.reqChannel[1])&&this.isLoading(1)){return}
this.deferCheck(2000,'no data');}}},responseFail:function(res){log('response failed');log(res);this.reqFailures++;if(this.reqFailures>=this.failureLimit)
this.massDisconnect();else
this.deferCheck(this.backoff,'response failed');},massDisconnect:function(){for(var i=0,len=this.sids.length;i<len;i++){var s=this.sockets[this.sids[i]];if(s&&s.cid){s.readyState=STATE_CLOSED;s.onDisconnected();}}},response:function(res){this.reqFailures=0;var obj;if(res.responseText)
obj=Ext.decode(res.responseText);return this.processResponseObj(obj);},processResponseObj:function(o){if(!o||!defined(o)||!defined(o.items)){log('no socket data from the server');return this.checkQueue('response.noitems');}
var backoff=false;if(o.advice&&typeof o.advice=='object'){log('advice present');if(o.advice.wait){this.backoff=o.advice.wait;backoff=true;}}
var items=o.items;var socket;for(var i=0,len=items.length;i<len;i++){if(!items[i].sid){log('socket id not returned',items[i]);continue;}
socket=this.getSocket(items[i].sid);if(!socket){log('ignoring event for old socket',items[i].sid);continue;}
var hasData=defined(items[i].data)?true:false;if(hasData){var bytes=items[i].data.length;this.fireEvent('received',this,bytes,this.bytesIn);this.bytesIn+=bytes;}
switch(items[i].state){case STATE_CLOSED:if(hasData)
socket.onData(items[i].data);if(socket.readyState!=STATE_CLOSED){socket.readyState=STATE_CLOSED;socket.onDisconnected();}
if(defined(items[i].error))
socket.error=items[i].error;break;case STATE_OPEN:socket.cid=items[i].cid;if(socket.readyState!=STATE_OPEN){socket.readyState=STATE_OPEN;socket.onConnected();}
if(hasData)
socket.onData(items[i].data);break;default:if(!socket.cid)
socket.cid=items[i].cid;if(hasData)
socket.onData(items[i].data);break;}}
if(backoff)
return this.deferCheck(this.backoff,'advised to backoff: '+this.backoff+'ms');this.checkQueue('reponse');},callbackFunc:function(chan,eventName,args,cbFunc){switch(eventName){case'success':chan.busy=false;this.response.apply(this,args);break;case'failure':log('xdomain request failure');chan.busy=false;this.responseFail.apply(this,args);break;case'load':log('loaded iframe for channel:'+chan.channel+' cb_id:'+chan.cbid);chan.handler=function(o){chan.busy=true;cbFunc(o);};if(chan.pendingRequest){var data=chan.pendingRequest;delete chan.pendingRequest;chan.handler({url:this.endpointURL,timeout:this.timeout,headers:{'X-Sprocket-Client':'Ext/'+Ext.version+'/'+VERSION,'X-Sprocket-Client-Time':new Date().dateFormat('U')},params:{data:data}});}else{chan.busy=false;}
break;default:log('event not handled in xdomain sprocket.socket:'+eventName);break;}
return chan.channel;},processCSSJSONPResponse:function(chan,obj){chan.busy=false;this.processResponseObj(obj);},ajaxRequest:function(out,channel){var json=Ext.encode(out);if(this.xdomain||this.useJSONP||this.useCSS){if(this.useJSONP||this.useCSS){var chan;if(this.channels[channel]){chan=this.channels[channel];}else{chan=this.channels[channel]={busy:true,channel:channel};if(this.useCSS)
chan.conn=new Ext.data.CSSProxy({url:this.endpointURL,timeout:this.timeout});else
chan.conn=new Ext.data.ScriptTagProxy({url:this.endpointURL,timeout:this.timeout});chan.response=this.processCSSJSONPResponse.createDelegate(this,[chan],0);}
chan.busy=true;if(!this.reader)
this.reader=new Ext.ux.Sprocket.ObjectReader();var params={data:json};if(this.useJSONP)
params.json=1;chan.conn.load(Ext.apply(params,this.extraParams),this.reader,chan.response);return channel;}else{if(!this.channels[channel]){var id='sprocket-socket-iframe-'+channel;var frame=document.getElementById(id);if(frame){frame.parentNode.removeChild(frame);}
var chan=this.channels[channel]={};chan.cbid='sprocketSocket-'+Ext.id();chan.channel=channel;chan.busy=true;window[chan.cbid]=this.callbackFunc.createDelegate(this,[chan],0);chan.pendingRequest=json;frame=document.createElement('iframe');frame.className='x-hidden';frame.name=id;frame.setAttribute('id',id);document.body.appendChild(frame);var params={domain:document.domain,cb:'sprocketSocketCB',id:chan.cbid};var p=Ext.urlEncode(Ext.apply(params,this.extraParams));var url=this.xurl;url+=(url.indexOf('?')!=-1?'&':'?')+p;url+='&_dc='+(new Date().getTime());frame.setAttribute('src',url);return channel;}
this.channels[channel].handler({url:this.endpointURL,timeout:this.timeout,headers:{'X-Sprocket-Client':'Ext/'+Ext.version+'/'+VERSION,'X-Sprocket-Client-Time':new Date().dateFormat('U')},params:Ext.apply({data:json},this.extraParams)});return channel;}}else{return Ext.Ajax.request({url:this.endpointURL,success:this.response.createDelegate(this),failure:this.responseFail.createDelegate(this),timeout:this.timeout,headers:{'X-Sprocket-Client':'Ext/'+Ext.version+'/'+VERSION,'X-Sprocket-Client-Time':new Date().dateFormat('U')},params:{data:json}});}},isLoading:function(channel){if(this.xdomain){return this.channels[channel]&&this.channels[channel].busy;}else{return Ext.Ajax.isLoading(this.reqChannel[channel]);}}});Ext.ux.Sprocket.ObjectReader=function(){Ext.ux.Sprocket.ObjectReader.superclass.constructor.apply(this,arguments);};Ext.extend(Ext.ux.Sprocket.ObjectReader,Ext.data.DataReader,{readRecords:function(o){return o;}});window.sprocketSocketCB=function(eventName,args,cb,id){try{if(id&&window[id])
window[id](eventName,args,cb);}catch(e){log(e.message);};}}})();Ext.namespace('Ext.ux.Sprocket');(function(){function defined(x){return x!==undefined};var log;if(window.console){log=function(m){window.console.log(m);};}else if(Ext.log){log=window.Ext.log;}else{log=Ext.emptyFn;}
Ext.ux.Sprocket.Filter=function(config){if(!defined(config))
config={};Ext.apply(this,config);this.initialize(config);};Ext.override(Ext.ux.Sprocket.Filter,{version:'1.1',initialize:Ext.emptyFn,autoloadFilters:function(filters){for(var i=0,len=filters.length;i<len;i++){if(typeof filters[i]=='string'){var error='';var filter;try{filter=eval('Ext.ux.Sprocket.Filter.'+this.filters[i]);filters[i]=new filter();continue;}catch(e){error+=e;filter=filters[i];}
try{filter=eval(filter);filters[i]=new filter();}catch(e){error+='; '+e
throw'Failed to load filter: Ext.ux.Sprocket.Filter.'+filter+' or '+filter+' Error:'+error;}}}
return filters;},clone:function(){return new this.constructor();},get:function(chunks){if(chunks&&chunks.length)
this.getOneStart(chunks);var items=[];while(1){var it=this.getOne();var len=it.length;if(len)
for(var i=0;i<len;i++)
items.push(it[i]);else
break;}
return items;},reset:Ext.emptyFn});Ext.ux.Sprocket.Filter.Stream=function(){Ext.ux.Sprocket.Filter.Stream.superclass.constructor.apply(this,arguments);};Ext.extend(Ext.ux.Sprocket.Filter.Stream,Ext.ux.Sprocket.Filter,{version:'1.0',buffer:'',clone:function(){return new this.constructor();},getOneStart:function(items){if(!(items instanceof Array))
items=[items];this.buffer+=items.join('');},getOne:function(){if(!this.buffer.length)
return[];var data=this.buffer;this.buffer='';return[data];},put:function(data){return data;},getPending:function(){return this.buffer;},reset:function(){this.buffer='';}});Ext.ux.Sprocket.Filter.Stackable=function(){Ext.ux.Sprocket.Filter.Stackable.superclass.constructor.apply(this,arguments);};Ext.extend(Ext.ux.Sprocket.Filter.Stackable,Ext.ux.Sprocket.Filter,{version:'1.1',initialize:function(){Ext.ux.Sprocket.Filter.Stackable.superclass.initialize.apply(this,arguments);if(!this.filters)
this.filters=['Stream'];this.filters=this.autoloadFilters(this.filters);},clone:function(){var filters=[];this.filters.forEach(function(filter){filters.push(filter.clone());});return new this.constructor({filters:filters});},getOneStart:function(items){if(!(items instanceof Array))
items=[items];this.filters[0].getOneStart(items);},getOne:function(){var ret=[];while(!ret.length){var exchanged=0;for(var i=0,len=this.filters.length;i<len;i++){if(ret.length){this.filters[i].getOneStart(ret);exchanged++;}
ret=this.filters[i].getOne();}
if(!exchanged)
break;}
return ret;},put:function(data){for(var i=this.filters.length-1;i>-1;i--){data=this.filters[i].put(data);if(!data.length)
break;}
return data;},getPending:function(){var data;for(var i=0,len=this.filters.length;i<len;i++){if(data&&data.length)
this.filters[i].put(data);data=this.filters[i].getPending();}
return data||[];},getFilters:function(){return this.filters;},unshift:function(filters){if(!(filters instanceof Array))
filters=[filters];for(var i=filters.length-1,len=0;i>=len;i--)
this.filters.unshift(filters[i]);},push:function(filters){if(!(filters instanceof Array))
filters=[filters];for(var i=0,len=filters.length;i<len;i++)
this.filters.push(filters[i]);},shift:function(){var filter=this.filters.shift();if(filter){var pending=filter.getPending();if(pending&&this.filters[0])
this.filters[0].put(pending);}
return filter;},pop:function(){var filter=this.filters.pop();if(filter){var pending=filter.getPending();if(pending)
this.filters[this.filters.length-1].put(pending);}
return filter;},reset:function(){for(var i=0,len=this.filters.length;i<len;i++)
this.filters[i].reset();},_test:function(){log('starting test');this.shift();this.unshift([new Ext.ux.Sprocket.Filter.Line(),new Ext.ux.Sprocket.Filter.JSON()]);var items=this.put([{"foo":"bar"},{"bar":"baz"},{"blitz":"boom"}]);log('Filter Stackable with Line and JSON (should be json with \r\n between them:'+Ext.encode(items));items=this.get('{ "foo": "bar" }\r\n{ "bar": "baz" }\r\n{ "blitz": "boom" }\r\n');if(items.length==3&&items[0].foo=='bar')
log('PASS, returned an array of 3 objects');else
log('FAIL, did not return an array of 3 objects');log('Filter Stackable with Line and JSON:'+Ext.encode(items));log('done!');}});})();(function(){function defined(x){return x!==undefined};var log;if(window.console){log=function(m){window.console.log(m);};}else if(Ext.log){log=window.Ext.log;}else{log=Ext.emptyFn;}
Ext.ux.Sprocket.Filter.Line=function(config){Ext.ux.Sprocket.Filter.Line.superclass.constructor.apply(this,arguments);};Ext.extend(Ext.ux.Sprocket.Filter.Line,Ext.ux.Sprocket.Filter,{version:'1.1',buffer:'',outputLiteral:"\x0D\x0A",inputStart:"^(.*?)",inputRegexp:'\x0D\x0A?|\x0A\x0D?|\u2028',autoDetectRegexp:/^(.*?)(\x0D\x0A?|\x0A\x0D?|\u2028)/,matchInputRegexp:null,autoDetectState:null,AUTO_STATE_DONE:0x00,AUTO_STATE_FIRST:0x01,AUTO_STATE_SECOND:0x02,initialize:function(config){Ext.ux.Sprocket.Filter.Line.superclass.initialize.apply(this,arguments);this.config=config;this._setInputRegexp();this.reset();},clone:function(){return new this.constructor(this.lineterm);},_setInputRegexp:function(inputRegexp){if(inputRegexp)
this.inputRegexp=inputRegexp;this.matchInputRegexp=new RegExp(this.inputStart+"("+this.inputRegexp+")");},getPending:function(){return this.buffer;},getOneStart:function(lines){if(!(lines instanceof Array))
lines=[lines];this.buffer+=lines.join('');},getOne:function(){if(!this.buffer.length)
return[];var count=0;while(1){if(!this.autoDetectState){var ret;this.buffer=this.buffer.replace(this.matchInputRegexp,function(m,a){ret=[a];return'';});if(defined(ret))
return ret;break;}
if(this.autoDetectState&this.AUTO_STATE_FIRST){var line;var newline;this.buffer=this.buffer.replace(this.autoDetectRegexp,function(m,l,n){line=l;newline=n;return'';});if(!defined(line))
break;if((newline.length==2)||this.buffer.length){this._setInputRegexp(newline);this.autoDetectState=this.AUTO_STATE_DONE;}else{log("detected suspicious newline after line: <<"+line+">>\n");this._setInputRegexp(newline);this.autoDetectState=this.AUTO_STATE_SECOND;}
return[line];}
if(this.autoDetectState&this.AUTO_STATE_SECOND){if(!this.buffer.length)
return[];if(this.buffer.substr(0,1)==(this.inputRegexp=="\x0D"?"\x0A":"\x0D")){this.buffer=this.buffer.replace(/^(.)/,function(m,a){this.inputRegexp+=a;return'';});this._setInputRegexp();}else{log("decided prior suspicious newline is okay");}
this.autoDetectState=this.AUTO_STATE_DONE;continue;}
log("consistency error: AUTODETECT_STATE = "+this.autoDetectState);return[];}
return[];},put:function(lines){if(!lines)
return[];if(!(lines instanceof Array))
lines=[lines];var out=lines.join(this.outputLiteral);return(out.match(this.outputLiteral+'$'))?out:out+this.outputLiteral;},reset:function(){this.buffer='';this.autoDetectState=(this.inputRegexp)?this.AUTO_STATE_FIRST:this.AUTO_STATE_DONE;},_test:function(){log('starting test');var lines=this.put(["line one","line two","line three"]);log('Line Filter:'+Ext.encode(lines));lines=this.get("line one\nline two\nline three");var lines2=this.get("\nline four\n\nline six\n");lines2.forEach(function(it){lines.push(it);});log('Line Filter with intentional blank line #5:'+Ext.encode(lines));log('done!');}});})();(function(){var log;if(window.console){log=function(m){window.console.log(m);};}else if(Ext.log){log=window.Ext.log;}else{log=Ext.emptyFn;}
Ext.ux.Sprocket.Filter.JSON=function(){Ext.ux.Sprocket.Filter.JSON.superclass.constructor.apply(this,arguments);};Ext.extend(Ext.ux.Sprocket.Filter.JSON,Ext.ux.Sprocket.Filter,{version:'1.1',initialize:function(config){Ext.ux.Sprocket.Filter.JSON.superclass.initialize.apply(this,arguments);this.config=config;this.reset();},clone:function(){return new this.constructor(this.config);},getPending:function(){return this.buffer;},getOneStart:function(items){if(!(items instanceof Array))
items=[items];for(var i=0,len=items.length;i<len;i++)
this.buffer.push(items[i]);},getOne:function(){var obj=[];var item=this.buffer.shift();if(!item)
return obj;try{obj.push(Ext.decode(item));}catch(e){log('bad json in Filter.JSON:'+item+' : '+e);};return obj;},put:function(items){if(!items)
return[];var obj=[];for(var i=0,len=items.length;i<len;i++){try{obj.push(Ext.encode(items[i]));}catch(e){log('could not convert item to json in Filter.JSON: '+items[i]+' : '+e);};}
return obj;},reset:function(){this.buffer=[];},_test:function(){log('starting test');var items=this.put([{"foo":"bar"},{"bar":"baz"},{"blitz":"boom"}]);log('JSON Filter:'+Ext.util.JSON.encode(items));items=this.get('[ { "foo": "bar" }, { "bar": "baz" }, { "blitz": "boom" } ]');var items2=this.get('{ "foo2": "bar2"  }');items2.forEach(function(it){items.push(it);});log('JSON Filter:'+Ext.util.JSON.encode(items));log('done!');}});})();function set_cookie(name,value,expires,path,domain,secure)
{var today=new Date();today.setTime(today.getTime());if(expires)
{expires=expires*1000*60*60*24;}
var expires_date=new Date(today.getTime()+(expires));document.cookie=name+"="+escape(value)+
((expires)?";expires="+expires_date.toGMTString():"")+
((path)?";path="+path:"")+
((domain)?";domain="+domain:"")+
((secure)?";secure":"");}
function get_cookie(name){var start=document.cookie.indexOf(name+"=");var len=start+name.length+1;if((!start)&&(name!=document.cookie.substring(0,name.length)))
{return null;}
if(start==-1)return null;var end=document.cookie.indexOf(";",len);if(end==-1)end=document.cookie.length;return unescape(document.cookie.substring(len,end));}
function delete_cookie(name,path,domain){if(get_cookie(name))document.cookie=name+"="+((path)?";path="+path:"")+((domain)?";domain="+domain:"")+";expires=Thu, 01-Jan-1970 00:00:01 GMT";}
Ext.namespace("Ext.ux");Ext.ux.StartMenu=function(config){Ext.ux.StartMenu.superclass.constructor.call(this,config);var tools=this.toolItems;this.toolItems=new Ext.util.MixedCollection();if(tools){this.addTool.apply(this,tools);}};Ext.extend(Ext.ux.StartMenu,Ext.menu.Menu,{height:300,toolPanelWidth:100,width:300,render:function(){if(this.el){return;}
var el=this.el=new Ext.Layer({cls:"x-menu ux-start-menu",shadow:this.shadow,constrain:false,parentEl:this.parentEl||document.body,zindex:15000});var header=el.createChild({tag:"div",cls:"x-window-header x-unselectable x-panel-icon "+this.iconCls});header.setStyle('padding','7px 0 0 0');this.header=header;var headerText=header.createChild({tag:"span",cls:"x-window-header-text"});var tl=header.wrap({cls:"ux-start-menu-tl"});var tr=header.wrap({cls:"ux-start-menu-tr"});var tc=header.wrap({cls:"ux-start-menu-tc"});this.menuBWrap=el.createChild({tag:"div",cls:"ux-start-menu-body x-border-layout-ct ux-start-menu-body"});var ml=this.menuBWrap.wrap({cls:"ux-start-menu-ml"});var mc=this.menuBWrap.wrap({cls:"ux-start-menu-mc ux-start-menu-bwrap"});var shortcutRecord=Ext.data.Record.create(['id','name','cls',{name:'size',type:'float'},{name:'lastmod',type:'date',dateFormat:'timestamp'}]);var store=new Ext.data.JsonStore({fields:shortcutRecord});var tpl=new Ext.XTemplate('<ul class="x-menu-list">','<tpl for=".">','<li class="x-menu-list-item"><a href="javascript:void(0);" class="x-menu-item">','<img class="x-menu-item-icon {cls}-icon" src= "images/s.gif"/>{shortName}</a></li>','</tpl>','</ul>');var view=new Ext.DataView({store:store,tpl:tpl,width:'100%',height:'100%',multiSelect:true,overClass:'x-menu-item-active',itemSelector:'.x-menu-list-item',emptyText:'- No Shortcuts -',prepareData:function(data){if(data.iconCls)
data.iconCls=data.iconCls.replace(/-shortcut$/,'');data.shortName=Ext.util.Format.ellipsis(data.name,30);data.sizeString=Ext.util.Format.fileSize(data.size||0);data.dateString=data.lastmod.format("m/d/Y g:i a");return data;},listeners:{beforeclick:{fn:function(dv,idx,node,ev){if(ev.type&&ev.type=='click'){var record=dv.getRecord(node);if(!record)
return false;this.hide();log('launching '+record.data.id);var module=app.getModule(record.data.id);if(module&&module.launcher&&module.launcher.handler)
module.launcher.handler.call(module.launcher.scope);return false;}},scope:this}}});this.menuPanel=new Ext.Panel({baseCls:"x-panel x-border-panel ux-start-menu-apps-panel opaque",frame:false,border:false,layout:'fit',items:view});this.menuPanel.render(this.menuBWrap);this.toolsPanel=this.menuBWrap.createChild({tag:"div",cls:"x-panel x-border-panel ux-start-menu-tools-panel"});var bwrap=ml.wrap({cls:"x-window-bwrap"});var bc=bwrap.createChild({tag:"div",cls:"ux-start-menu-bc"});var bl=bc.wrap({cls:"ux-start-menu-bl x-panel-nofooter"});var br=bc.wrap({cls:"ux-start-menu-br"});bc.setStyle({height:'0px',padding:'0 0 6px 0'});this.keyNav=new Ext.menu.MenuNav(this);if(this.plain){el.addClass("x-menu-plain");}
if(this.cls){el.addClass(this.cls);}
this.focusEl=el.createChild({tag:"a",cls:"x-menu-focus",href:"#",onclick:"return false;",tabIndex:"-1"});var toolsUl=this.toolsPanel.createChild({tag:"ul",cls:"x-menu-list"});var ulListeners={"click":{fn:this.onClick,scope:this},"mouseover":{fn:this.onMouseOver,scope:this},"mouseout":{fn:this.onMouseOut,scope:this}};this.items.each(function(item){if(item.iconCls)
item.iconCls=item.iconCls.replace(/-(shortcut|icon)$/,'');var date=new Date();var record=new shortcutRecord({id:item.moduleId,name:item.text,cls:item.iconCls,lastmod:date,launcher:item});store.add([record]);},this);var dragZone=new Ext.app.FileDragZone(view,{containerScroll:false,targetCls:'li.x-menu-list-item',ddGroup:'file-manager-group'});var dropTarget=new Ext.dd.DropTarget(this.menuPanel.body.dom,{ddGroup:'file-manager-group',copy:false,notifyDrop:function(ddSource,e,odata){if(ddSource.dragData._done)
return true;ddSource.dragData._done=true;if(ddSource.view&&ddSource.view.store===store)
return false;function addRow(data,index,allItems){if(ddSource.grid)
ddSource.grid.store.remove(data);else
ddSource.view.store.remove(data);var record=new shortcutRecord(data.data);store.add(record);}
try{Ext.each(ddSource.dragData.selections,addRow);}catch(e){log('start menu:'+e);};if(ddSource.grid)
ddSource.grid.refresh();else
ddSource.view.refresh();view.refresh();return(true);}});this.autoWidth();toolsUl.on(ulListeners);this.toolItems.each(function(item){var li=document.createElement("li");li.className="x-menu-list-item";toolsUl.dom.appendChild(li);item.render(li,this);},this);this.toolsUl=toolsUl;this.autoWidth();this.menuBWrap.setStyle('position','relative');this.menuBWrap.setHeight(this.height);this.menuPanel.body.setStyle({padding:'2px',position:'absolute',overflow:'auto'});this.toolsPanel.setStyle({padding:'2px 4px 2px 2px',position:'absolute',overflow:'auto'});this.setTitle(this.title);},findTargetItem:function(e){var t=e.getTarget(".x-menu-list-item",this.menuPanel.dom,true);if(t&&t.menuItemId){if(this.items.get(t.menuItemId)){return this.items.get(t.menuItemId);}else{return this.toolItems.get(t.menuItemId);}}},show:function(el,pos,parentMenu){this.parentMenu=parentMenu;if(!this.el){this.render();}
this.fireEvent("beforeshow",this);this.showAt(this.el.getAlignToXY(el,pos||this.defaultAlign),parentMenu,false);var tPanelWidth=this.toolPanelWidth;var box=this.menuBWrap.getBox();this.menuPanel.setWidth(box.width-tPanelWidth);this.menuPanel.setHeight(box.height);this.toolsPanel.setWidth(tPanelWidth);this.toolsPanel.setX(box.x+box.width-tPanelWidth);this.toolsPanel.setHeight(box.height);},addTool:function(){var a=arguments,l=a.length,item;for(var i=0;i<l;i++){var el=a[i];if(el.render){item=this.addToolItem(el);}else if(typeof el=="string"){if(el=="separator"||el=="-"){item=this.addToolSeparator();}else{item=this.addText(el);}}else if(el.tagName||el.el){item=this.addElement(el);}else if(typeof el=="object"){item=this.addToolMenuItem(el);}}
return item;},addToolSeparator:function(){return this.addToolItem(new Ext.menu.Separator({itemCls:'ux-toolmenu-sep'}));},addToolItem:function(item){this.toolItems.add(item);if(this.toolsUl){var li=document.createElement("li");li.className="x-menu-list-item";this.toolsUl.dom.appendChild(li);item.render(li,this);this.delayAutoWidth();}
return item;},addToolMenuItem:function(config){if(!(config instanceof Ext.menu.Item)){if(typeof config.checked=="boolean"){config=new Ext.menu.CheckItem(config);}else{config=new Ext.menu.Item(config);}}
return this.addToolItem(config);},setTitle:function(title,iconCls){this.title=title;if(this.header.child('span')){this.header.child('span').update(title);}
return this;},getToolButton:function(config){var btn=new Ext.Button({handler:config.handler,minWidth:this.toolPanelWidth-10,scope:config.scope,text:config.text});return btn;}});Ext.namespace("Ext.ux");Ext.ux.TaskBar=function(app){this.app=app;this.init();}
Ext.extend(Ext.ux.TaskBar,Ext.util.Observable,{init:function(){this.startMenu=new Ext.ux.StartMenu(Ext.apply({height:300,shadow:true,width:300},this.app.startConfig));var startButton=this.startButton=new Ext.Button({text:'i-housekeeping',id:'ux-startbutton',iconCls:'start',menu:this.startMenu,menuAlign:'bl-tl',renderTo:'ux-taskbar-start'});var dropTarget=new Ext.dd.DropTarget(startButton.el,{ddGroup:'file-manager-group',copy:false,notifyDrop:function(){return false;},notifyEnter:function(){startButton.showMenu();}});var startWidth=Ext.get('ux-startbutton').getWidth()+10;var sbBox=new Ext.BoxComponent({el:'ux-taskbar-start',id:'TaskBarStart',minWidth:startWidth,region:'west',split:false,width:startWidth});this.quickStartPanel=new Ext.ux.QuickStartPanel({el:'ux-quickstart-panel',id:'TaskBarQuickStart',stateId:'ext-quickstart',minWidth:60,region:'west',split:true,width:94});this.trayPanel=new Ext.ux.TrayPanel({el:'ux-tray-panel',id:'TaskBarTray',stateId:'ext-task-tray',minWidth:75,region:'east',split:true,width:100});this.taskButtonPanel=new Ext.ux.TaskButtonsPanel({el:'ux-taskbuttons-panel',id:'TaskBarButtons',region:'center'});var panelWrap=new Ext.Container({el:'ux-taskbar-panel-wrap',items:[this.quickStartPanel,this.taskButtonPanel,this.trayPanel],layout:'border',region:'center'});var container=new Ext.ux.TaskBarContainer({el:'ux-taskbar',layout:'border',items:[sbBox,panelWrap]});this.el=container.el;this.el.on('contextmenu',function(e){e.stopEvent();},this);return this;},setActiveButton:function(btn){this.taskButtonPanel.setActiveButton(btn);}});Ext.ux.TaskBarContainer=Ext.extend(Ext.Container,{initComponent:function(){Ext.ux.TaskBarContainer.superclass.initComponent.call(this);this.el=Ext.get(this.el)||Ext.getBody();this.el.setHeight=Ext.emptyFn;this.el.setWidth=Ext.emptyFn;this.el.setSize=Ext.emptyFn;this.el.setStyle({overflow:'hidden',margin:'0',border:'0 none'});this.el.dom.scroll='no';this.allowDomMove=false;this.autoWidth=true;this.autoHeight=true;Ext.EventManager.onWindowResize(this.fireResize,this);this.renderTo=this.el;},fireResize:function(w,h){this.fireEvent('resize',this,w,h,w,h);}});Ext.ux.TaskButtonsPanel=Ext.extend(Ext.BoxComponent,{activeButton:null,enableScroll:true,scrollIncrement:0,scrollRepeatInterval:400,scrollDuration:.35,animScroll:true,resizeButtons:true,buttonWidth:168,minButtonWidth:118,buttonMargin:2,buttonWidthSet:false,initComponent:function(){Ext.ux.TaskButtonsPanel.superclass.initComponent.call(this);this.on('resize',this.delegateUpdates);this.items=[];this.stripWrap=Ext.get(this.el).createChild({cls:'ux-taskbuttons-strip-wrap',cn:{tag:'ul',cls:'ux-taskbuttons-strip'}});this.stripSpacer=Ext.get(this.el).createChild({cls:'ux-taskbuttons-strip-spacer'});this.strip=new Ext.Element(this.stripWrap.dom.firstChild);this.edge=this.strip.createChild({tag:'li',cls:'ux-taskbuttons-edge'});this.strip.createChild({cls:'x-clear'});},add:function(win){var li=this.strip.createChild({tag:'li'},this.edge);var btn=new Ext.ux.TaskBar.TaskButton(win,li);this.items.push(btn);if(!this.buttonWidthSet){this.lastButtonWidth=btn.container.getWidth();}
this.setActiveButton(btn);var x;if((win.blinkTaskButton!==undefined)&&(win.blinkTaskButton!==false)){x=btn.el.sequenceFx();var len=(win.blinkTaskButton===true)?1:win.blinkTaskButton||0;for(var i=0;i<len;i++){x.fadeOut({endOpacity:.5,duration:.1,easing:'easeOut'});x.fadeIn({endOpacity:1,duration:.5});}}
if((win.frameTaskButton!==undefined)&&(win.blinkTaskButton!==false)){if(!x)
x=btn.el.sequenceFx();var len=(win.frameTaskButton===true)?1:win.frameTaskButton||0;for(var i=0;i<len;i++)
x.frame();}
return btn;},remove:function(btn){var li=document.getElementById(btn.container.id);btn.destroy();li.parentNode.removeChild(li);var s=[];for(var i=0,len=this.items.length;i<len;i++){if(this.items[i]!=btn){s.push(this.items[i]);}}
this.items=s;this.delegateUpdates();},setActiveButton:function(btn){this.activeButton=btn;this.delegateUpdates();},delegateUpdates:function(){if(this.resizeButtons&&this.rendered){this.autoSize();}
if(this.enableScroll&&this.rendered){this.autoScroll();}},autoSize:function(){var count=this.items.length;var ow=this.el.dom.offsetWidth;var aw=this.el.dom.clientWidth;if(!this.resizeButtons||count<1||!aw){return;}
var each=Math.max(Math.min(Math.floor((aw-4)/count)-this.buttonMargin,this.buttonWidth),this.minButtonWidth);var btns=this.stripWrap.dom.getElementsByTagName('button');this.lastButtonWidth=Ext.get(btns[0].id).findParent('li').offsetWidth;for(var i=0,len=btns.length;i<len;i++){var btn=btns[i];var tw=Ext.get(btns[i].id).findParent('li').offsetWidth;var iw=btn.offsetWidth;btn.style.width=(each-(tw-iw))+'px';}},autoScroll:function(){var count=this.items.length;var ow=this.el.dom.offsetWidth;var tw=this.el.dom.clientWidth;var wrap=this.stripWrap;var cw=wrap.dom.offsetWidth;var pos=this.getScrollPos();var l=this.edge.getOffsetsTo(this.stripWrap)[0]+pos;if(!this.enableScroll||count<1||cw<20){return;}
wrap.setWidth(tw);if(l<=tw){wrap.dom.scrollLeft=0;if(this.scrolling){this.scrolling=false;this.el.removeClass('x-taskbuttons-scrolling');this.scrollLeft.hide();this.scrollRight.hide();}}else{if(!this.scrolling){this.el.addClass('x-taskbuttons-scrolling');}
tw-=wrap.getMargins('lr');wrap.setWidth(tw>20?tw:20);if(!this.scrolling){if(!this.scrollLeft){this.createScrollers();}else{this.scrollLeft.show();this.scrollRight.show();}}
this.scrolling=true;if(pos>(l-tw)){wrap.dom.scrollLeft=l-tw;}else{this.scrollToButton(this.activeButton,true);}
this.updateScrollButtons();}},createScrollers:function(){var h=this.el.dom.offsetHeight;var sl=this.el.insertFirst({cls:'ux-taskbuttons-scroller-left'});sl.setHeight(h);sl.addClassOnOver('ux-taskbuttons-scroller-left-over');this.leftRepeater=new Ext.util.ClickRepeater(sl,{interval:this.scrollRepeatInterval,handler:this.onScrollLeft,scope:this});this.scrollLeft=sl;var sr=this.el.insertFirst({cls:'ux-taskbuttons-scroller-right'});sr.setHeight(h);sr.addClassOnOver('ux-taskbuttons-scroller-right-over');this.rightRepeater=new Ext.util.ClickRepeater(sr,{interval:this.scrollRepeatInterval,handler:this.onScrollRight,scope:this});this.scrollRight=sr;},getScrollWidth:function(){return this.edge.getOffsetsTo(this.stripWrap)[0]+this.getScrollPos();},getScrollPos:function(){return parseInt(this.stripWrap.dom.scrollLeft,10)||0;},getScrollArea:function(){return parseInt(this.stripWrap.dom.clientWidth,10)||0;},getScrollAnim:function(){return{duration:this.scrollDuration,callback:this.updateScrollButtons,scope:this};},getScrollIncrement:function(){return(this.scrollIncrement||this.lastButtonWidth+2);},scrollToButton:function(item,animate){item=item.el.dom.parentNode;if(!item){return;}
var el=item;var pos=this.getScrollPos(),area=this.getScrollArea();var left=Ext.fly(el).getOffsetsTo(this.stripWrap)[0]+pos;var right=left+el.offsetWidth;if(left<pos){this.scrollTo(left,animate);}else if(right>(pos+area)){this.scrollTo(right-area,animate);}},scrollTo:function(pos,animate){this.stripWrap.scrollTo('left',pos,animate?this.getScrollAnim():false);if(!animate){this.updateScrollButtons();}},onScrollRight:function(){var sw=this.getScrollWidth()-this.getScrollArea();var pos=this.getScrollPos();var s=Math.min(sw,pos+this.getScrollIncrement());if(s!=pos){this.scrollTo(s,this.animScroll);}},onScrollLeft:function(){var pos=this.getScrollPos();var s=Math.max(0,pos-this.getScrollIncrement());if(s!=pos){this.scrollTo(s,this.animScroll);}},updateScrollButtons:function(){var pos=this.getScrollPos();this.scrollLeft[pos==0?'addClass':'removeClass']('ux-taskbuttons-scroller-left-disabled');this.scrollRight[pos>=(this.getScrollWidth()-this.getScrollArea())?'addClass':'removeClass']('ux-taskbuttons-scroller-right-disabled');}});Ext.ux.TaskBar.TaskButton=function(win,el){this.win=win;Ext.ux.TaskBar.TaskButton.superclass.constructor.call(this,{iconCls:win.iconCls,text:Ext.util.Format.ellipsis(win.title,20),tooltip:win.taskbuttonTooltip||win.title,renderTo:el,handler:function(){if(win.minimized||win.hidden){win.show();}else if(win==win.manager.getActive()){if(win.minimizable===false){if(win.closeAction=='hide')
win.hide();else{win.show();win.el.frame();}}else
win.minimize();}else{win.toFront();}},clickEvent:'mousedown'});};Ext.extend(Ext.ux.TaskBar.TaskButton,Ext.Button,{onRender:function(){Ext.ux.TaskBar.TaskButton.superclass.onRender.apply(this,arguments);this.cmenu=new Ext.menu.Menu({items:[{id:'restore',text:'Restore',handler:function(){if(!this.win.isVisible()){this.win.show();}else{this.win.restore();}},scope:this},{id:'minimize',text:'Minimize',handler:this.win.minimize,scope:this.win},{id:'maximize',text:'Maximize',handler:this.win.maximize,scope:this.win},'-',{id:'close',text:'Close',handler:this.closeWin.createDelegate(this,this.win,true),scope:this.win}]});this.cmenu.on('beforeshow',function(){var items=this.cmenu.items.items;var w=this.win;items[0].setDisabled(w.maximized!==true&&w.hidden!==true);items[1].setDisabled(w.minimized===true);items[1].setDisabled(w.minimizable===false);items[2].setDisabled(w.maximized===true||w.hidden===true);items[2].setDisabled(w.maximizable===false);items[3].setDisabled(w.closable===false);},this);this.el.on('contextmenu',function(e){e.stopEvent();if(!this.cmenu.el){this.cmenu.render();}
var xy=e.getXY();xy[1]-=this.cmenu.el.getHeight();this.cmenu.showAt(xy);},this);},closeWin:function(cMenu,e,win){if(!win.isVisible()){win.show();}else{win.restore();}
win.close();},setText:function(text){if(text){this.text=text;if(this.el){this.el.child("td.x-btn-center "+this.buttonSelector).update(Ext.util.Format.ellipsis(text,20));}}},setTooltip:function(text){if(text){this.tooltip=text;var btnEl=this.el.child(this.buttonSelector);Ext.QuickTips.unregister(btnEl.id);if(typeof this.tooltip=='object'){Ext.QuickTips.register(Ext.apply({target:btnEl.id},this.tooltip));}else{btnEl.dom[this.tooltipType]=this.tooltip;}}}});Ext.ux.QuickStartPanel=Ext.extend(Ext.BoxComponent,{enableMenu:true,initComponent:function(){Ext.ux.QuickStartPanel.superclass.initComponent.call(this);this.on('resize',this.delegateUpdates);this.menu=new Ext.menu.Menu();this.items=[];this.stripWrap=Ext.get(this.el).createChild({cls:'ux-quickstart-strip-wrap',cn:{tag:'ul',cls:'ux-quickstart-strip'}});this.stripSpacer=Ext.get(this.el).createChild({cls:'ux-quickstart-strip-spacer'});this.strip=new Ext.Element(this.stripWrap.dom.firstChild);this.edge=this.strip.createChild({tag:'li',cls:'ux-quickstart-edge'});this.strip.createChild({cls:'x-clear'});},add:function(config){var li=this.strip.createChild({tag:'li'},this.edge);var btn=new Ext.Button(Ext.apply(config,{cls:'x-btn-icon',menuText:config.text,renderTo:li,text:''}));this.items.push(btn);this.delegateUpdates();return btn;},remove:function(btn){var li=document.getElementById(btn.container.id);btn.destroy();li.parentNode.removeChild(li);var s=[];for(var i=0,len=this.items.length;i<len;i++){if(this.items[i]!=btn){s.push(this.items[i]);}}
this.items=s;this.delegateUpdates();},menuAdd:function(config){this.menu.add(config);},delegateUpdates:function(){if(this.enableMenu&&this.rendered){this.showButtons();this.clearMenu();this.autoMenu();}},showButtons:function(){var count=this.items.length;for(var i=0;i<count;i++){this.items[i].show();}},clearMenu:function(){this.menu.removeAll();},autoMenu:function(){var count=this.items.length;var ow=this.el.dom.offsetWidth;var tw=this.el.dom.clientWidth;var wrap=this.stripWrap;var cw=wrap.dom.offsetWidth;var l=this.edge.getOffsetsTo(this.stripWrap)[0];if(!this.enableMenu||count<1||cw<20){return;}
wrap.setWidth(tw);if(l<=tw){if(this.showingMenu){this.showingMenu=false;this.menuButton.hide();}}else{tw-=wrap.getMargins('lr');wrap.setWidth(tw>20?tw:20);if(!this.showingMenu){if(!this.menuButton){this.createMenuButton();}else{this.menuButton.show();}}
mo=this.getMenuButtonPos();for(var i=count-1;i>=0;i--){var bo=this.items[i].el.dom.offsetLeft+this.items[i].el.dom.offsetWidth;if(bo>mo){this.items[i].hide();var ic=this.items[i].initialConfig,config={iconCls:ic.iconCls,handler:ic.handler,scope:ic.scope,text:ic.menuText};this.menuAdd(config);}else{this.items[i].show();}}
this.showingMenu=true;}},createMenuButton:function(){var h=this.el.dom.offsetHeight;var mb=this.el.insertFirst({cls:'ux-quickstart-menubutton-wrap'});mb.setHeight(h);var btn=new Ext.Button({cls:'x-btn-icon',id:'ux-quickstart-menubutton',menu:this.menu,renderTo:mb});mb.setWidth(Ext.get('ux-quickstart-menubutton').getWidth());this.menuButton=mb;},getMenuButtonPos:function(){return this.menuButton.dom.offsetLeft;}});Ext.ux.TrayPanel=Ext.extend(Ext.BoxComponent,{enableMenu:true,initComponent:function(){Ext.ux.QuickStartPanel.superclass.initComponent.call(this);this.on('resize',this.delegateUpdates);this.menu=new Ext.menu.Menu();this.items=[];this.stripWrap=Ext.get(this.el).createChild({cls:'ux-tray-strip-wrap',cn:{tag:'ul',cls:'ux-tray-strip'}});this.stripSpacer=Ext.get(this.el).createChild({cls:'ux-tray-strip-spacer'});this.strip=new Ext.Element(this.stripWrap.dom.firstChild);this.edge=this.strip.createChild({tag:'li',cls:'ux-tray-edge'});this.strip.createChild({cls:'x-clear'});},add:function(config){var li=this.strip.createChild({tag:'li'},this.edge);var btn=new Ext.Button(Ext.apply(config,{cls:'x-btn-icon',menuText:config.text,renderTo:li,text:''}));this.items.push(btn);this.delegateUpdates();return btn;},remove:function(btn){var li=document.getElementById(btn.container.id);btn.destroy();li.parentNode.removeChild(li);var s=[];for(var i=0,len=this.items.length;i<len;i++){if(this.items[i]!=btn){s.push(this.items[i]);}}
this.items=s;this.delegateUpdates();},getButton:function(id){for(var i=0,len=this.items.length;i<len;i++)
if(this.items[i]==id)
return this.items[i];return null;},menuAdd:function(config){this.menu.add(config);},delegateUpdates:function(){if(this.enableMenu&&this.rendered){this.showButtons();this.clearMenu();this.autoMenu();}},showButtons:function(){var count=this.items.length;for(var i=0;i<count;i++){this.items[i].show();}},clearMenu:function(){this.menu.removeAll();},autoMenu:function(){var count=this.items.length;var ow=this.el.dom.offsetWidth;var tw=this.el.dom.clientWidth;var wrap=this.stripWrap;var cw=wrap.dom.offsetWidth;var l=this.edge.getOffsetsTo(this.stripWrap)[0];if(!this.enableMenu||count<1||cw<20){return;}
wrap.setWidth(tw);if(l<=tw){if(this.showingMenu){this.showingMenu=false;this.menuButton.hide();}}else{tw-=wrap.getMargins('lr');wrap.setWidth(tw>20?tw:20);if(!this.showingMenu){if(!this.menuButton){this.createMenuButton();}else{this.menuButton.show();}}
mo=this.getMenuButtonPos();for(var i=count-1;i>=0;i--){var bo=this.items[i].el.dom.offsetLeft+this.items[i].el.dom.offsetWidth;if(bo>mo){this.items[i].hide();var ic=this.items[i].initialConfig,config={iconCls:ic.iconCls,handler:ic.handler,scope:ic.scope,text:ic.menuText};this.menuAdd(config);}else{this.items[i].show();}}
this.showingMenu=true;}},createMenuButton:function(){var h=this.el.dom.offsetHeight;var mb=this.el.insertFirst({cls:'ux-tray-button-wrap'});mb.setHeight(h);var btn=new Ext.Button({cls:'x-btn-icon',id:'ux-tray-button',menu:this.menu,renderTo:mb});mb.setWidth(Ext.get('ux-tray-button').getWidth());this.menuButton=mb;},getMenuButtonPos:function(){return this.menuButton.dom.offsetLeft;}});Ext.Desktop=function(app){this.taskbar=new Ext.ux.TaskBar(app);var taskbar=this.taskbar;this.el=Ext.get('x-desktop');var desktopEl=this.el;var taskbarEl=Ext.get('ux-taskbar');this.shortcuts=new Ext.ux.Shortcuts({renderTo:'x-desktop',viewId:'x-desktop-view',taskbarEl:taskbarEl});this.config=null;this.initialConfig=null;this.subscribe('/desktop/notify',function(config){var win=new Ext.ux.Notification(Ext.apply({animateTarget:taskbarEl,autoDestroy:true,hideDelay:3000,html:'',iconCls:'x-icon-waiting',title:''},config));win.show();});var windows=new Ext.WindowGroup();var activeWindow;function minimizeWin(win){win.minimized=true;win.hide();}
function showWin(win){if(win.ishidden){win.ishidden=false;win.taskButton=taskbar.taskButtonPanel.add(win);if(win.trayButton)
win.animateTarget=win.trayButton.el;else
win.animateTarget=win.taskButton.el;layout();}
markActive(win);}
function markActive(win){if(activeWindow&&activeWindow!=win){markInactive(activeWindow);}
taskbar.setActiveButton(win.taskButton);activeWindow=win;Ext.fly(win.taskButton.el).addClass('active-win');win.minimized=false;}
function markInactive(win){if(win==activeWindow){activeWindow=null;Ext.fly(win.taskButton.el).removeClass('active-win');}}
function removeWin(win){if(win.taskButton){taskbar.taskButtonPanel.remove(win.taskButton);win.taskButton=null;}
layout();}
function hideWin(win){if(win.minimized)
return;win.ishidden=true;taskbar.taskButtonPanel.remove(win.taskButton);win.taskButton=null;layout();}
function layout(){var dbg=Ext.getCmp('x-debug-browser');var extra=dbg?dbg.el.getHeight():0;desktopEl.setHeight(Ext.lib.Dom.getViewHeight()-taskbarEl.getHeight()-extra);}
Ext.EventManager.onWindowResize(layout);this.layout=layout;this.createWindow=function(config,cls){var win=new(cls||Ext.Window)(Ext.applyIf(config||{},{manager:windows,minimizable:true,collapsible:true,constrain:true,maximizable:true}));win.render(desktopEl);win.taskButton=taskbar.taskButtonPanel.add(win);win.cmenu=new Ext.menu.Menu({items:[]});win.animateTarget=win.taskButton.el;if(win.notifyButton){var mod=this.addNotificationButton(win.notifyButton);if(mod){win.trayButton=mod.trayButton;if(win.animateToNotifyButton)
win.animateTarget=mod.trayButton.el;}}
win.on({'activate':{fn:markActive},'beforeshow':{fn:showWin},'deactivate':{fn:markInactive},'minimize':{fn:minimizeWin},'close':{fn:removeWin},'hide':{fn:hideWin}});layout();return win;};this.getManager=function(){return windows;};this.getWindow=function(id){return windows.get(id);};this.getViewHeight=function(){var dbg=Ext.getCmp('x-debug-browser');var extra=dbg?dbg.el.getHeight():0;return(Ext.lib.Dom.getViewHeight()-taskbarEl.getHeight()-extra);};this.getViewWidth=function(){return Ext.lib.Dom.getViewWidth();};this.getWinWidth=function(){var width=Ext.lib.Dom.getViewWidth();return width<200?200:width;};this.getWinHeight=function(){var dbg=Ext.getCmp('x-debug-browser');var extra=dbg?dbg.el.getHeight():0;var height=(Ext.lib.Dom.getViewHeight()-taskbarEl.getHeight()-extra);return height<100?100:height;};this.getWinX=function(width){return(Ext.lib.Dom.getViewWidth()-width)/2};this.getWinY=function(height){var dbg=Ext.getCmp('x-debug-browser');var extra=dbg?dbg.el.getHeight():0;return(Ext.lib.Dom.getViewHeight()-taskbarEl.getHeight()-extra-height)/2;};this.setBackgroundColor=function(hex){if(hex){Ext.get(document.body).setStyle('background-color','#'+hex);this.config.styles.backgroundcolor=hex;}};this.setFontColor=function(hex){if(hex){Ext.util.CSS.refreshCache();Ext.util.CSS.updateRule('.ux-shortcut-btn-text','color','#'+hex);this.config.styles.fontcolor=hex;}};this.setTheme=function(o){if(o&&o.id&&o.name&&o.pathtofile){Ext.util.CSS.swapStyleSheet('theme',o.pathtofile);this.config.styles.theme=o;}};this.setTransparency=function(b){if(String(b)!=""){if(b)
taskbarEl.addClass("transparent");else
taskbarEl.removeClass("transparent");this.config.styles.transparency=b}};this.setWallpaper=function(o,skipNotify){if(o&&o.id&&o.name&&o.pathtofile){var notifyWin;if(!skipNotify){notifyWin=this.showNotification({html:'Loading wallpaper...',title:'Please wait'});var wp=new Image();wp.src=o.pathtofile;var task=new Ext.util.DelayedTask(verify,this);task.delay(200);}else{document.body.background=o.pathtofile;}
this.config.styles.wallpaper=o;}
function verify(){if(wp.complete){task.cancel();if(notifyWin){notifyWin.setIconClass('x-icon-done');notifyWin.setTitle('Finished');notifyWin.setMessage('Wallpaper loaded.');this.hideNotification(notifyWin);}
document.body.background=wp.src;}else
task.delay(200);}};this.setWallpaperPosition=function(pos){if(pos){if(pos==="center"){var b=Ext.get(document.body);b.removeClass('wallpaper-tile');b.addClass('wallpaper-center');}else if(pos==="tile"){var b=Ext.get(document.body);b.removeClass('wallpaper-center');b.addClass('wallpaper-tile');}
this.config.styles.wallpaperposition=pos;}};this.showNotification=function(config){var win=new Ext.ux.Notification(Ext.apply({animateTarget:taskbarEl,autoDestroy:true,hideDelay:3000,html:'',iconCls:'x-icon-waiting',title:''},config));win.show();return win;};this.hideNotification=function(win,delay){if(!win)
return;(function(){win.animHide();}).defer(delay||3000);};this.addAutoRun=function(id){var m=app.getModule(id),c=this.config.launchers.autorun;if(m&&!m.autorun){m.autorun=true;c.push(id);}};this.removeAutoRun=function(id){var m=app.getModule(id),c=this.config.launchers.autorun;if(m&&m.autorun){var i=0;while(i<c.length){if(c[i]==id)
c.splice(i,1);else
i++;}
m.autorun=null;}};this.addContextMenuItem=function(id){var m=app.getModule(id);if(m&&!m.contextMenuItem){this.cmenu.add(m.launcher);}};this.addShortcut=function(id,updateConfig){var m=app.getModule(id);if(m&&!m.shortcut){var c=m.launcher;m.shortcut=this.shortcuts.addShortcut({id:m.moduleId,handler:c.handler,iconCls:c.shortcutIconCls,winIconCls:c.iconCls,scope:c.scope,text:c.text});if(updateConfig)
this.config.launchers.shortcut.push(id);}};this.removeShortcut=function(id,updateConfig){var m=app.getModule(id);if(m&&m.shortcut){this.shortcuts.removeShortcut(m.shortcut);m.shortcut=null;if(updateConfig){var sc=this.config.launchers.shortcut,i=0;while(i<sc.length){if(sc[i]==id)
sc.splice(i,1);else
i++;}}}};this.addQuickStartButton=function(id,updateConfig){var m=app.getModule(id);if(m&&!m.quickStartButton){var c=m.launcher;m.quickStartButton=this.taskbar.quickStartPanel.add({handler:c.handler,iconCls:c.iconCls,scope:c.scope,text:c.text,tooltip:c.tooltip||c.text});if(updateConfig)
this.config.launchers.quickstart.push(id);}};this.removeQuickStartButton=function(id,updateConfig){var m=app.getModule(id);if(m&&m.quickStartButton){this.taskbar.quickStartPanel.remove(m.quickStartButton);m.quickStartButton=null;if(updateConfig){var qs=this.config.launchers.quickstart,i=0;while(i<qs.length){if(qs[i]==id)
qs.splice(i,1);else
i++;}}}};this.addNotificationButton=function(id,updateConfig){var m=app.getModule(id);if(m&&!m.trayButton){var c=m.launcher;m.trayButton=this.taskbar.trayPanel.add({handler:c.handler,iconCls:c.iconCls,scope:c.scope,text:c.text,tooltip:c.tooltip||c.text});if(updateConfig)
this.config.launchers.quickstart.push(id);}
return m;};this.removeNotificationButton=function(id,updateConfig){var m=app.getModule(id);if(m&&m.trayButton){this.taskbar.trayPanel.remove(m.trayButton);m.trayButton=null;if(updateConfig){var qs=this.config.launchers.quickstart,i=0;while(i<qs.length){if(qs[i]==id)
qs.splice(i,1);else
i++;}}}};layout();this.cmenu=new Ext.menu.Menu();desktopEl.on('contextmenu',function(e){if(e.target&&e.target.id)
log('right click on:'+e.target.id);e.stopEvent();if(e.target.id=='x-loading-mask')
return e.stopEvent();if(e.target.id==desktopEl.id||e.target.id=='x-desktop-view'){if(e.ctrlKey){if(!Ext.log){this.publish('/desktop/sound/play',{file:'resources/sounds/click-low.mp3'});var sc=document.createElement('scr'+'ipt');document.body.appendChild(sc);sc.onload=function(){log('CometDesktop v'+app.version);log('Detected Browser/OS:'+app.browserOS);};sc.setAttribute('type','text/javascript');sc.setAttribute('src','lib/debug.js');}else{log('CometDesktop v'+app.version);log('Detected Browser/OS:'+app.browserOS);}
return;}
if(!this.cmenu.el){this.cmenu.render();}
var xy=e.getXY();xy[1]-=this.cmenu.el.getHeight();this.cmenu.showAt(xy);}},this);};Ext.extend(Ext.Desktop,Ext.util.Observable);Ext.ux.NotificationMgr={positions:[]};Ext.ux.Notification=Ext.extend(Ext.Window,{initComponent:function(){Ext.apply(this,{iconCls:this.iconCls||'x-icon-information',width:200,autoHeight:true,closable:true,plain:false,draggable:false,bodyStyle:'text-align:left;padding:10px;',resizable:false});if(this.autoDestroy)
this.task=new Ext.util.DelayedTask(this.animHide,this);else
this.closable=true;Ext.ux.Notification.superclass.initComponent.call(this);},setMessage:function(msg){this.body.update(msg);},setTitle:function(title,iconCls){Ext.ux.Notification.superclass.setTitle.call(this,title,iconCls||this.iconCls);},onRender:function(ct,position){Ext.ux.Notification.superclass.onRender.call(this,ct,position);},onDestroy:function(){Ext.ux.NotificationMgr.positions.remove(this.pos);Ext.ux.Notification.superclass.onDestroy.call(this);},afterShow:function(){Ext.ux.Notification.superclass.afterShow.call(this);this.on('move',function(){Ext.ux.NotificationMgr.positions.remove(this.pos);if(this.autoDestroy){this.task.cancel();}},this);if(this.autoDestroy){this.task.delay(this.hideDelay||5000);}},animShow:function(){this.pos=0;while(Ext.ux.NotificationMgr.positions.indexOf(this.pos)>-1){this.pos++;}
Ext.ux.NotificationMgr.positions.push(this.pos);this.setSize(200,100);this.el.alignTo(this.animateTarget||document,"br-tr",[-1,-1-((this.getSize().height+10)*this.pos)]);this.el.slideIn('b',{duration:.7,callback:this.afterShow,scope:this});},animHide:function(){Ext.ux.NotificationMgr.positions.remove(this.pos);this.el.ghost("b",{duration:1,remove:true});}});Ext.BLANK_IMAGE_URL='images/s.gif';Ext.apply(window.app,{connection:'/desktop/connect',apps:[],poweredby:['Ext/'+Ext.version],browserOS:__getBrowserOS(),register:function(cfg){app.apps.push(cfg);},addAppVersion:function(appVersion){if(appVersion!==undefined)
app.poweredby.push(appVersion);if(!Ext.Ajax.defaultHeaders)
Ext.Ajax.defaultHeaders={};Ext.Ajax.defaultHeaders['X-Powered-By']=app.poweredby.join('; ');}});app.addAppVersion('CometDesktop/'+app.version+' + i-housekeeping');Ext.app.App=function(cfg){Ext.apply(this,cfg);Ext.apply(this,app);this.addEvents({'ready':true,'beforeunload':true});window.app=this;Ext.onReady(this.initApp,this);};Ext.extend(Ext.app.App,Ext.util.Observable,{isReady:false,modules:[],initApp:function(){this.startTime=new Date();this.loadTime=(parseInt(this.startTime.dateFormat('U'))-parseInt(this.initTime.dateFormat('U')));log('load time:'+this.loadTime+' seconds');var map=new Ext.KeyMap(document,[{key:Ext.EventObject.BACKSPACE,stopEvent:false,fn:function(key,e){var t=e.target.tagName;if(!t)
return;t=t.toLowerCase();if(t!="input"&&t!="textarea"){log('stopping backspace for tag: '+t);e.stopEvent();}}}]);this.startConfig=this.startConfig||this.getStartConfig();this.desktop=new Ext.Desktop(this);this.getModules();if(this.modules.length){this.initModules(this.modules);this.initDesktopConfig();}
this.init();if(Ext.isIE)
Ext.EventManager.on(window,'beforeunload',this.eventUnloadIE,this);else
Ext.EventManager.on(window,'beforeunload',this.eventUnload,this,true);this.removeLoadingMask();this.isReady=true;this.fireEvent('ready',this);},eventUnloadIE:function(e){var _this=this;function unload(){return _this.eventUnload(e);}
function stop(){document.detachEvent('onstop',stop);return unload(e);}
switch(document.readyState){case'interactive':document.attachEvent('onstop',stop);window.setTimeout(function(){document.detachEvent('onstop',stop);},0);break;default:return unload(e);break;}},eventUnload:function(e){var x=Ext.lib.Ajax.createXhrObject();x.conn.open('POST','/authorize/logout',false);var originalTitle=document.title;document.title='Please wait...';if(this.fireEvent('beforeunload',this,x)===false){if(e)e.stopEvent();document.title=originalTitle;return;}
x.conn.setRequestHeader('X-SessionTime',this.startTime.dateFormat('c/U')+'~'+(new Date).dateFormat('c/U'));x.conn.setRequestHeader('X-LoadTime',this.loadTime);x.conn.onreadystatechange=Ext.emptyFn;x.conn.send('v'+this.config.version);document.title=originalTitle;},getModules:Ext.emptyFn,getStartConfig:Ext.emptyFn,getLogoutButtonConfig:Ext.emptyFn,getDesktopConfig:Ext.emptyFn,init:Ext.emptyFn,initModules:function(ms){for(var i=0,len=ms.length;i<len;i++){if(ms[i].launcher&&ms[i].launcher.handler)
ms[i].launcher.handler=this.gaPageview.createDelegate(this,['/app/'+ms[i].moduleId],false).createSequence(ms[i].launcher.handler);}},initDesktopConfig:function(o){if(!o){this.getDesktopConfig();}else{var l=o.launchers;l.contextmenu=l.contextmenu||[];l.startmenu=l.startmenu||[];l.startmenutool=l.startmenutool||[];l.quickstart=l.quickstart||[];l.shortcut=l.shortcut||[];o.styles=o.styles||[];l.autorun=l.autorun||[];this.desktop.config=o;this.desktop.initialConfig=o;this.initContextMenu(l.contextmenu);this.initStartMenu(l.startmenu,false);this.initStartMenu(l.startmenutool,true);this.initLogoutButton();this.initQuickStart(l.quickstart);this.initShortcuts(l.shortcut);this.initNetworkStatus();this.initStyles(o.styles);this.initAutoRun(l.autorun);var name=o.user.first;if(o.user.last!='')
name+=' '+o.user.last;this.gaSetVar('id:'+o.user.id+'/name:'+name);}},initNetworkStatus:function(){this.desktop.addNotificationButton('network-status',false);},initAutoRun:function(mIds){if(mIds){for(var i=0,len=mIds.length;i<len;i++){var m=this.getModule(mIds[i]);if(m){m.autorun=true;if(m.launcher.handler){if(m.launcher.scope)
m.launcher.handler.call(m.launcher.scope);else
m.launcher.handler();}}}}},initContextMenu:function(mIds){if(mIds){for(var i=0,len=mIds.length;i<len;i++){this.desktop.addContextMenuItem(mIds[i]);}}},initLogoutButton:function(){var config=this.getLogoutButtonConfig();this.desktop.taskbar.startMenu.addTool(config);},initShortcuts:function(mIds){if(mIds){for(var i=0,len=mIds.length;i<len;i++){this.desktop.addShortcut(mIds[i],false);}}},initStartMenu:function(mIds,tool){var startMenu=this.desktop.taskbar.startMenu;if(mIds){for(var i=0,len=mIds.length;i<len;i++){var m=this.getModule(mIds[i]);if(m){addItems(startMenu,m);}}}
function addItems(menu,m){if(m.moduleType=='menu'&&m.items){var items=m.items;for(var j=0,len=items.length;j<len;j++){var item=app.getModule(items[j]);if(item){addItems(m.menu,item);}}}
if(m.launcher){m.launcher.moduleId=m.moduleId;if(tool===true){menu.addTool(m.launcher);}else{menu.add(m.launcher);}}}},initQuickStart:function(mIds){if(mIds){for(var i=0,len=mIds.length;i<len;i++){this.desktop.addQuickStartButton(mIds[i],false);}}},initStyles:function(s){this.desktop.setBackgroundColor(s.backgroundcolor);this.desktop.setFontColor(s.fontcolor);this.desktop.setTheme({id:s.themeid,name:s.themename,pathtofile:s.themefile});this.desktop.setTransparency(s.transparency);this.desktop.setWallpaper({id:s.wallpaperid,name:s.wallpapername,pathtofile:s.wallpaperfile},true);this.desktop.setWallpaperPosition(s.wallpaperposition);},removeLoadingMask:function(){Ext.get('x-loading').remove();Ext.get('x-loading-mask').fadeOut({remove:true,duration:1.5});},getModule:function(v){var ms=this.modules||[];for(var i=0,len=ms.length;i<len;i++){if(ms[i].moduleId==v||ms[i].moduleType==v){return ms[i];}}
return false;},replaceModule:function(v,obj){var ms=this.modules||[];for(var i=0,len=ms.length;i<len;i++){if(ms[i].moduleId==v||ms[i].moduleType==v){ms[i]=obj;return true;}}
return false;},onReady:function(fn,scope){if(!this.isReady){this.on('ready',fn,scope);}else{fn.call(scope,this);}},getDesktop:function(){return this.desktop;},gaSetVar:function(v){if(window.pageTracker)
window.pageTracker._setVar(v);return true;},gaPageview:function(id){if(window.pageTracker){window.pageTracker._trackPageview(id);log('ga pagetrack: '+id);}
return true;}});Ext.FlashPanel=function(){Ext.FlashPanel.superclass.constructor.apply(this,arguments);};Ext.extend(Ext.FlashPanel,Ext.Panel,{hideMode:'visibility',bwrapCfg:{tag:'div',position:'absolute',cls:'x-panel-bwrap'}});Ext.DataView.DragSelector=function(cfg){cfg=cfg||{};var view,regions,proxy,tracker;var rs,bodyRegion,dragRegion=new Ext.lib.Region(0,0,0,0);var dragSafe=cfg.dragSafe===true;this.init=function(dataView){view=dataView;view.on('render',onRender);};function fillRegions(){rs=[];view.all.each(function(el){rs[rs.length]=el.getRegion();});bodyRegion=view.el.getRegion();}
function cancelClick(){return false;}
function onBeforeStart(e){return!dragSafe||e.target==view.el.dom;}
function onStart(e){view.on('containerclick',cancelClick,view,{single:true});if(!proxy)
proxy=view.el.createChild({cls:'x-view-selector'});else
proxy.setDisplayed('block');fillRegions();view.clearSelections();}
function onDrag(e){var startXY=tracker.startXY;var xy=tracker.getXY();var x=Math.min(startXY[0],xy[0]);var y=Math.min(startXY[1],xy[1]);var w=Math.abs(startXY[0]-xy[0]);var h=Math.abs(startXY[1]-xy[1]);dragRegion.left=x;dragRegion.top=y;dragRegion.right=x+w;dragRegion.bottom=y+h;dragRegion.constrainTo(bodyRegion);proxy.setRegion(dragRegion);for(var i=0,len=rs.length;i<len;i++){var r=rs[i],sel=dragRegion.intersect(r);if(sel&&!r.selected){r.selected=true;view.select(i,true);}else if(!sel&&r.selected){r.selected=false;view.deselect(i);}}}
function onEnd(e){if(proxy)
proxy.setDisplayed(false);}
function onRender(view){tracker=new Ext.dd.DragTracker({onBeforeStart:onBeforeStart,onStart:onStart,onDrag:onDrag,onEnd:onEnd});tracker.initEl(view.el);}};Ext.app.FileDragZone=function(view,config){this.view=view;this.scroll=false;Ext.app.FileDragZone.superclass.constructor.call(this,view.getEl(),config);};Ext.extend(Ext.app.FileDragZone,Ext.dd.DragZone,{getDragData:function(e){var target=e.getTarget(this.targetCls||'.thumb-wrap');if(target){var view=this.view;if(!view.isSelected(target)){view.onClick(e);}
var records=view.getSelectedRecords();var dragData={selections:records,nodes:view.getSelectedNodes()};if(records.length==1){dragData.ddel=target;dragData.single=true;}else{var div=document.createElement('div');div.className='multi-proxy';var count=document.createElement('div');count.innerHTML=records.length+' selected';div.appendChild(count);dragData.ddel=div;dragData.multi=true;}
return dragData;}
return false;},afterRepair:function(){if(this.dragData.nodes){for(var i=0,len=this.dragData.nodes.length;i<len;i++){Ext.fly(this.dragData.nodes[i]).frame('#8db2e3',1);}}
this.dragging=false;},getRepairXY:function(e){if(!this.dragData.multi){var xy=Ext.Element.fly(this.dragData.ddel).getXY();xy[0]+=3;xy[1]+=3;return xy;}
return false;}});if(Ext.isChrome===undefined){Ext.apply(Ext,{isChrome:Ext.isSafari3&&navigator.userAgent.toLowerCase().indexOf('chrome')!=-1});}
function __getBrowserOS(){var os='-unknown';if(Ext.isWindows)
os='-Windows';else if(Ext.isMac)
os='-Mac';else if(Ext.isLinux)
os='-Linux';if(Ext.isSecure)
os+='[https]';if(Ext.isIE6)
return'IE6'+os;else if(Ext.isIE7)
return'IE7'+os;else if(Ext.isIE)
return'IE'+os;else if(Ext.isOpera)
return'Opera'+os;else if(Ext.isChrome)
return'Chrome'+os;else if(Ext.isSafari3)
return'Safari3'+os;else if(Ext.isSafari2)
return'Safari2'+os;else if(Ext.isSafari)
return'Safari'+os;else if(Ext.isGecko3)
return'Gecko3'+os;else if(Ext.isGecko2)
return'Gecko2'+os;else if(Ext.isGecko)
return'Gecko'+os;else if(Ext.isAir)
return'AIR'+os;return'unknown'+os;}
function sha1(msg){function rotate_left(n,s){var t4=(n<<s)|(n>>>(32-s));return t4;};function lsb_hex(val){var str="";var i;var vh;var vl;for(i=0;i<=6;i+=2){vh=(val>>>(i*4+4))&0x0f;vl=(val>>>(i*4))&0x0f;str+=vh.toString(16)+vl.toString(16);}
return str;};function cvt_hex(val){var str="";var i;var v;for(i=7;i>=0;i--){v=(val>>>(i*4))&0x0f;str+=v.toString(16);}
return str;};function Utf8Encode(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0,len=string.length;n<len;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c);}
else if((c>127)&&(c<2048)){utftext+=String.fromCharCode((c>>6)|192);utftext+=String.fromCharCode((c&63)|128);}
else{utftext+=String.fromCharCode((c>>12)|224);utftext+=String.fromCharCode(((c>>6)&63)|128);utftext+=String.fromCharCode((c&63)|128);}}
return utftext;};var blockstart;var i,j;var W=new Array(80);var H0=0x67452301;var H1=0xEFCDAB89;var H2=0x98BADCFE;var H3=0x10325476;var H4=0xC3D2E1F0;var A,B,C,D,E;var temp;msg=Utf8Encode(msg);var msg_len=msg.length;var word_array=new Array();for(i=0;i<msg_len-3;i+=4){j=msg.charCodeAt(i)<<24|msg.charCodeAt(i+1)<<16|msg.charCodeAt(i+2)<<8|msg.charCodeAt(i+3);word_array.push(j);}
switch(msg_len%4){case 0:i=0x080000000;break;case 1:i=msg.charCodeAt(msg_len-1)<<24|0x0800000;break;case 2:i=msg.charCodeAt(msg_len-2)<<24|msg.charCodeAt(msg_len-1)<<16|0x08000;break;case 3:i=msg.charCodeAt(msg_len-3)<<24|msg.charCodeAt(msg_len-2)<<16|msg.charCodeAt(msg_len-1)<<8|0x80;break;}
word_array.push(i);while((word_array.length%16)!=14)word_array.push(0);word_array.push(msg_len>>>29);word_array.push((msg_len<<3)&0x0ffffffff);for(blockstart=0,len=word_array.length;blockstart<len;blockstart+=16){for(i=0;i<16;i++)W[i]=word_array[blockstart+i];for(i=16;i<=79;i++)W[i]=rotate_left(W[i-3]^W[i-8]^W[i-14]^W[i-16],1);A=H0;B=H1;C=H2;D=H3;E=H4;for(i=0;i<=19;i++){temp=(rotate_left(A,5)+((B&C)|(~B&D))+E+W[i]+0x5A827999)&0x0ffffffff;E=D;D=C;C=rotate_left(B,30);B=A;A=temp;}
for(i=20;i<=39;i++){temp=(rotate_left(A,5)+(B^C^D)+E+W[i]+0x6ED9EBA1)&0x0ffffffff;E=D;D=C;C=rotate_left(B,30);B=A;A=temp;}
for(i=40;i<=59;i++){temp=(rotate_left(A,5)+((B&C)|(B&D)|(C&D))+E+W[i]+0x8F1BBCDC)&0x0ffffffff;E=D;D=C;C=rotate_left(B,30);B=A;A=temp;}
for(i=60;i<=79;i++){temp=(rotate_left(A,5)+(B^C^D)+E+W[i]+0xCA62C1D6)&0x0ffffffff;E=D;D=C;C=rotate_left(B,30);B=A;A=temp;}
H0=(H0+A)&0x0ffffffff;H1=(H1+B)&0x0ffffffff;H2=(H2+C)&0x0ffffffff;H3=(H3+D)&0x0ffffffff;H4=(H4+E)&0x0ffffffff;}
var temp=cvt_hex(H0)+cvt_hex(H1)+cvt_hex(H2)+cvt_hex(H3)+cvt_hex(H4);return temp.toLowerCase();}
Ext.app.Module=function(config){Ext.apply(this,config);Ext.app.Module.superclass.constructor.call(this);this.init(config);}
Ext.extend(Ext.app.Module,Ext.util.Observable,{init:Ext.emptyFn});Ext.app.loadOnDemand=Ext.extend(Ext.app.Module,{init:function(cfg){this.moduleType=cfg.moduleType;this.launcher=cfg;this.launcher.handler=this.load;this.launcher.scope=this;this.loading=false;},load:function(){if(this.loading)
return;this.loading=true;this.publish('/desktop/notify',{title:'Loading...',iconCls:'info-icon',html:'Loading '+this.text});Ext.Ajax.request({success:function(o){var construct;try{eval(o.responseText);construct=eval("("+this.pkg+")");}catch(e){log('error while loading '+this.moduleId+' '+e);};this.loading=false;if(!construct){this.publish('/desktop/notify',{title:'Failed',iconCls:'error-icon',html:'App failed to load'});return;}
this.launcher=null;var m=new construct();this.launcher=m.launcher;app.replaceModule(this.moduleId,m);if(m.launcher&&m.launcher.handler)
m.launcher.handler=app.gaPageview.createDelegate(app,['/app/'+m.moduleId],false).createSequence(m.launcher.handler);if(m.launcher.scope)
m.launcher.handler.call(m.launcher.scope);else
m.launcher.handler();if(this.destroy)
this.destroy.defer(1,this);},failure:function(){this.loading=false;this.publish('/desktop/notify',{title:'Failed',iconCls:'error-icon',html:'App failed to load'});},scope:this,url:app.connection,params:{moduleId:this.moduleId,task:'on-demand',what:'src',format:'js'},scriptTag:true,callbackParam:'jsoncallback',timeout:10});}});QoDesk=new Ext.app.App({init:function(){Ext.QuickTips.init();},getLogoutButtonConfig:function(){return{text:'Logout',iconCls:'logout',handler:function(){Ext.Ajax.request({success:function(o){var decoded=Ext.decode(o.responseText);if(decoded.success){window.location=decoded.url;}
else{}},failure:function(o){},scope:this,method:'DELETE',url:'/user_session'});}};},getModules:function(){if(this.modules&&this.modules.length)
return this.modules;var modules=[];for(var i=0,len=this.apps.length;i<len;i++){if(typeof this.apps[i]=='string'){var construct=eval("("+this.apps[i]+")");if(construct)
modules.push(new construct());}else{modules.push(new Ext.app.loadOnDemand(this.apps[i]));}}
for(var i=0,len=app.config.modules.length;i<len;i++){var construct=eval("("+app.config.modules[i]+")");if(construct)
modules.push(new construct());else
log('module: '+app.config.modules[i]+' is not loaded, or onDemand');}
return this.modules=modules;},getStartConfig:function(){return{iconCls:'startmenu-home-icon',title:'<span style="float:right">i-housekeeping</span> '+app.config.user.first+' '+app.config.user.last,toolPanelWidth:115};},getDesktopConfig:function(){this.initDesktopConfig(app.config);}});if(window.sprocket){window.sprocket.socketConfig={url:'http://x.__DOMAIN__/comet/sprocket.socket',xurl:'http://x.__DOMAIN__/comet/iframe.html',xdomain:true};}
if(Ext.ux.Sprocket&&Ext.ux.Sprocket.Socket)
app.addAppVersion('Sprocket.Socket/'+Ext.ux.Sprocket.Socket.prototype.version);app.onReady(function(){if(window.sprocket&&!window.sprocket.SocketMan)
window.sprocket.SocketMan=new Ext.ux.Sprocket.SocketManager(window.sprocket.socketConfig);this.on('beforeunload',function(x){var sids=(window.sprocket&&sprocket.SocketMan)?sprocket.SocketMan.getAllConnectionIds():[];if(sids.length>0){x.conn.setRequestHeader('X-Sprockets',sids.join(','));document.title+='closing sockets:'+sids.length;}});},app);Ext.namespace("Ext.ux");Ext.ux.Shortcuts=function(config){var desktopEl=Ext.get(config.renderTo),taskbarEl=config.taskbarEl;var shortcutRecord=Ext.data.Record.create(['id','name','cls',{name:'size',type:'float'},{name:'lastmod',type:'date',dateFormat:'timestamp'}]);var store=new Ext.data.JsonStore({url:'',root:'files',fields:shortcutRecord});var dbg=Ext.getCmp('x-debug-browser');var extra=dbg?dbg.el.getHeight():0;var iconHeight=96;var sizes={desktopHeight:(Ext.lib.Dom.getViewHeight()-taskbarEl.getHeight()-extra)};function isOverflow(y){if(y>sizes.desktopHeight){return true;}
return false;}
var tpl=new Ext.XTemplate('<tpl for=".">','<tpl if="(xindex &gt; 1) && !((xindex - 1) % this.cols(xindex))">','<div style="clear:left"></div>','</tpl>','<div class="thumb-wrap ux-shortcut-item-btn {cls}-shortcut" id="shortcut-{id}">','<div class="thumb ux-shortcut-btn"><img src="images/s.gif" title="{name}"/></div>','<span class="x-editable ux-shortcut-btn-text">{shortName}</span></div>','</tpl>','<div class="x-clear"></div>',{cols:function(idx){var j=0;for(var i=0,len=store.getCount();i<len;i++){if((j*iconHeight)>=sizes.desktopHeight){j--;break;}
j++;}
return Math.ceil(store.getCount()/j);}});var view=new Ext.DataView({id:config.viewId,store:store,tpl:tpl,width:'100%',height:'100%',multiSelect:true,overClass:'x-view-over',itemSelector:'div.thumb-wrap',emptyText:'',plugins:[new Ext.DataView.DragSelector({dragSafe:true})],prepareData:function(data){if(data.iconCls)
data.iconCls=data.iconCls.replace(/-shortcut$/,'');data.shortName=Ext.util.Format.ellipsis(data.name,30);data.sizeString=Ext.util.Format.fileSize(data.size||0);data.dateString=data.lastmod.format("m/d/Y g:i a");return data;},listeners:{selectionchange:{fn:function(dv,nodes){var l=nodes.length;try{window.status=l+' item'+(l!=1?'s':'')+' selected';}catch(e){};}},dblclick:{fn:function(dv){var records=dv.getSelectedRecords();var record=records[0];if(!record)
return false;log('launching '+record.data.id);var module=app.getModule(record.data.id);if(module&&module.launcher&&module.launcher.handler)
module.launcher.handler.call(module.launcher.scope);}}}});this.desktopPanel=new Ext.Panel({renderTo:config.renderTo,id:'desktop-view',frame:false,border:false,width:'100%',height:sizes.desktopHeight,layout:'fit',items:view});this.addShortcut=function(config){if(config.iconCls)
config.iconCls=config.iconCls.replace(/-shortcut$/,'');var date=new Date();var record=new shortcutRecord({id:config.id,name:config.text,cls:config.iconCls,lastmod:date,launcher:config});store.add([record]);view.refresh();return record;};this.removeShortcut=function(shortcut){var record=store.getById(shortcut.id);if(record){var node=view.getNode(store.find('id',shortcut.data.id));app.desktop.config.launchers.shortcut.remove(shortcut.data.id);if(node)
Ext.fly(node).ghost('l',{duration:.5,callback:function(){store.remove(record);view.refresh();}});else{store.remove(record);view.refresh();}}};this.handleUpdate=function(){var dbg=Ext.getCmp('x-debug-browser');var extra=dbg?dbg.el.getHeight():0;sizes.desktopHeight=Ext.lib.Dom.getViewHeight()-taskbarEl.getHeight()-extra;this.desktopPanel.setHeight(sizes.desktopHeight);view.refresh();};Ext.EventManager.onWindowResize(this.handleUpdate,this,{delay:500});var dragZone=new Ext.app.FileDragZone(view,{containerScroll:false,ddGroup:'file-manager-group'});var dropTarget=new Ext.dd.DropTarget(this.desktopPanel.body.dom,{ddGroup:'file-manager-group',copy:false,notifyDrop:function(ddSource,e,odata){if(ddSource.dragData._done)
return true;ddSource.dragData._done=true;if(ddSource.view&&ddSource.view.store===store)
return false;function addRow(data,index,allItems){if(ddSource.grid)
ddSource.grid.store.remove(data);else
ddSource.view.store.remove(data);var record=new shortcutRecord(data.data);store.add(record);}
try{Ext.each(ddSource.dragData.selections,addRow);}catch(e){log('desktop:'+e);};if(ddSource.grid)
ddSource.grid.refresh();else
ddSource.view.refresh();view.refresh();return(true);}});};Ext.app.NetworkStatus=Ext.extend(Ext.app.Module,{moduleType:'core',moduleId:'network-status',init:function(){this.launcher={iconCls:'network-status-icon',scope:this,text:'Network Status',tooltip:'<b>Network Status</b><br />Red: Inactive  Green: Request pending'};this.isOn=false;Ext.Ajax.on('beforerequest',this.beforeRequest,this);Ext.Ajax.on('requestcomplete',this.requestComplete,this);Ext.Ajax.on('requestexception',this.requestException,this);},beforeRequest:function(conn){if(!conn.defaultHeaders)
conn.defaultHeaders={};conn.defaultHeaders['X-Client-Time']=(new Date).dateFormat('c/U');conn.defaultHeaders['X-Session-Duration']=(new Date).dateFormat('U')-app.startTime.dateFormat('U');this.activity();},requestComplete:function(){this.activity(true);},requestException:function(conn,res,o){if(res.status&&res.status==401)
return window.location='logout.pl';this.activity(true);this.publish('/desktop/notify',{title:'AJAX Error',iconCls:'network-status-icon',html:'AJAX Request Failed'+((Ext.log||window.console)?'<br>See the log for more info':'')});log('AJAX Request Failed');},activity:function(off){if(off||this.isOn){this.isOn=false;if(this.trayButton)
this.trayButton.setIconClass('network-status-icon');}else{this.isOn=true;if(this.trayButton)
this.trayButton.setIconClass('network-status-act-icon');}}});app.register('Ext.app.NetworkStatus');function SoundManager(smURL,smID){this.flashVersion=8;this.debugMode=false;this.useConsole=true;this.consoleOnly=true;this.waitForWindowLoad=false;this.nullURL='null.mp3';this.allowPolling=true;this.useMovieStar=false;this.useHighPerformance=true;this.bgColor='#000000';this.defaultOptions={'autoLoad':false,'stream':true,'autoPlay':false,'onid3':null,'onload':null,'whileloading':null,'onplay':null,'onpause':null,'onresume':null,'whileplaying':null,'onstop':null,'onfinish':null,'onbeforefinish':null,'onbeforefinishtime':5000,'onbeforefinishcomplete':null,'onjustbeforefinish':null,'onjustbeforefinishtime':200,'multiShot':true,'position':null,'pan':0,'volume':100};this.flash9Options={'isMovieStar':null,'usePeakData':false,'useWaveformData':false,'useEQData':false};this.movieStarOptions={'onmetadata':null,'useVideo':false}
this.flashBlockHelper={'enabled':false,'message':[]};var _s=this;this.version=null;this.versionNumber='V2.90a.20081028';this.movieURL=null;this.url=smURL;this.altURL=null;this.swfLoaded=false;this.enabled=false;this.o=null;this.id=(smID||'sm2movie');this.oMC=null;this.sounds=[];this.soundIDs=[];this.muted=false;this.isIE=(navigator.userAgent.match(/MSIE/i));this.isSafari=(navigator.userAgent.match(/safari/i));this.isGecko=(navigator.userAgent.match(/gecko/i));this.debugID='soundmanager-debug';this._debugOpen=true;this._didAppend=false;this._appendSuccess=false;this._didInit=false;this._disabled=false;this._windowLoaded=false;this._hasConsole=(typeof console!='undefined'&&typeof console.log!='undefined');this._debugLevels=['log','info','warn','error'];this._defaultFlashVersion=8;this.filePatterns={flash8:/\.(mp3)/i,flash9:/\.(mp3)/i};this.netStreamTypes=['aac','flv','mov','mp4','m4v','f4v','m4a','mp4v','3gp','3g2'];this.netStreamPattern=new RegExp('.('+this.netStreamTypes.join('|')+')','i');this.filePattern=null;this.features={peakData:false,waveformData:false,eqData:false};this.sandbox={'type':null,'types':{'remote':'remote (domain-based) rules','localWithFile':'local with file access (no internet access)','localWithNetwork':'local with network (internet access only, no local access)','localTrusted':'local, trusted (local + internet access)'},'description':null,'noRemote':null,'noLocal':null};this._setVersionInfo=function(){if(_s.flashVersion!=8&&_s.flashVersion!=9){alert('soundManager.flashVersion must be 8 or 9. "'+_s.flashVersion+'" is invalid. Reverting to '+_s._defaultFlashVersion+'.');_s.flashVersion=_s._defaultFlashVersion;}
_s.version=_s.versionNumber+(_s.flashVersion==9?' (AS3/Flash 9)':' (AS2/Flash 8)');if(_s.flashVersion>8){_s.defaultOptions=_s._mergeObjects(_s.defaultOptions,_s.flash9Options);}
if(_s.flashVersion>8&&_s.useMovieStar){_s.defaultOptions=_s._mergeObjects(_s.defaultOptions,_s.movieStarOptions);_s.filePatterns.flash9=new RegExp('.(mp3|'+_s.netStreamTypes.join('|')+')','i');}else{_s.useMovieStar=false;}
_s.filePattern=_s.filePatterns[(_s.flashVersion!=8?'flash9':'flash8')];_s.movieURL=(_s.flashVersion==8?'soundmanager2.swf':'soundmanager2_flash9.swf');_s.features.peakData=_s.features.waveformData=_s.features.eqData=(_s.flashVersion==9);}
this._overHTTP=(document.location?document.location.protocol.match(/http/i):null);this._waitingforEI=false;this._initPending=false;this._tryInitOnFocus=(this.isSafari&&typeof document.hasFocus=='undefined');this._isFocused=(typeof document.hasFocus!='undefined'?document.hasFocus():null);this._okToDisable=!this._tryInitOnFocus;this.useAltURL=!this._overHTTP;var flashCPLink='http://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html';this.supported=function(){return(_s._didInit&&!_s._disabled);};this.getMovie=function(smID){return _s.isIE?window[smID]:(_s.isSafari?document.getElementById(smID)||document[smID]:document.getElementById(smID));};this.loadFromXML=function(sXmlUrl){try{_s.o._loadFromXML(sXmlUrl);}catch(e){_s._failSafely();return true;};};this.createSound=function(oOptions){if(!_s._didInit)throw new Error('soundManager.createSound(): Not loaded yet - wait for soundManager.onload() before calling sound-related methods');if(arguments.length==2){var oOptions={'id':arguments[0],'url':arguments[1]};};var thisOptions=_s._mergeObjects(oOptions);var _tO=thisOptions;_s._wD('soundManager.createSound(): '+_tO.id+' ('+_tO.url+')',1);if(_s._idCheck(_tO.id,true)){_s._wD('soundManager.createSound(): '+_tO.id+' exists',1);return _s.sounds[_tO.id];};if(_s.flashVersion>8&&_s.useMovieStar){if(_tO.isMovieStar==null){_tO.isMovieStar=(_tO.url.match(_s.netStreamPattern)?true:false);}
if(_tO.isMovieStar){_s._wD('soundManager.createSound(): using MovieStar handling');}
if(_tO.isMovieStar&&(_tO.usePeakData||_tO.useWaveformData||_tO.useEQData)){_s._wD('Warning: peak/waveform/eqData features unsupported for non-MP3 formats');_tO.usePeakData=false;_tO.useWaveformData=false;_tO.useEQData=false;}};_s.sounds[_tO.id]=new SMSound(_tO);_s.soundIDs[_s.soundIDs.length]=_tO.id;if(_s.flashVersion==8){_s.o._createSound(_tO.id,_tO.onjustbeforefinishtime);}else{_s.o._createSound(_tO.id,_tO.url,_tO.onjustbeforefinishtime,_tO.usePeakData,_tO.useWaveformData,_tO.useEQData,_tO.isMovieStar,(_tO.isMovieStar?_tO.useVideo:false));};if(_tO.autoLoad||_tO.autoPlay){window.setTimeout(function(){if(_s.sounds[_tO.id]){_s.sounds[_tO.id].load(_tO);}},20);}
if(_tO.autoPlay){if(_s.flashVersion==8){_s.sounds[_tO.id].playState=1;}else{_s.sounds[_tO.id].play();}}
return _s.sounds[_tO.id];};this.createVideo=function(oOptions){if(arguments.length==2){var oOptions={'id':arguments[0],'url':arguments[1]};};if(_s.flashVersion>=9){oOptions.isMovieStar=true;oOptions.useVideo=true;}else{_s._wD('soundManager.createVideo(): flash 9 required for video. Exiting.',2);return false;}
if(!_s.useMovieStar){_s._wD('soundManager.createVideo(): MovieStar mode not enabled. Exiting.',2);}
return _s.createSound(oOptions);}
this.destroySound=function(sID,bFromSound){if(!_s._idCheck(sID))return false;for(var i=0;i<_s.soundIDs.length;i++){if(_s.soundIDs[i]==sID){_s.soundIDs.splice(i,1);continue;};};_s.sounds[sID].unload();if(!bFromSound){_s.sounds[sID].destruct();};delete _s.sounds[sID];};this.destroyVideo=this.destroySound;this.load=function(sID,oOptions){if(!_s._idCheck(sID))return false;_s.sounds[sID].load(oOptions);};this.unload=function(sID){if(!_s._idCheck(sID))return false;_s.sounds[sID].unload();};this.play=function(sID,oOptions){if(!_s._idCheck(sID)){if(typeof oOptions!='Object')oOptions={url:oOptions};if(oOptions&&oOptions.url){_s._wD('soundController.play(): attempting to create "'+sID+'"',1);oOptions.id=sID;_s.createSound(oOptions);}else{return false;};};_s.sounds[sID].play(oOptions);};this.start=this.play;this.setPosition=function(sID,nMsecOffset){if(!_s._idCheck(sID))return false;nMsecOffset=Math.min((nMsecOffset||0),_s.duration);_s.sounds[sID].setPosition(nMsecOffset);};this.stop=function(sID){if(!_s._idCheck(sID))return false;_s._wD('soundManager.stop('+sID+')',1);_s.sounds[sID].stop();};this.stopAll=function(){_s._wD('soundManager.stopAll()',1);for(var oSound in _s.sounds){if(_s.sounds[oSound]instanceof SMSound)_s.sounds[oSound].stop();};};this.pause=function(sID){if(!_s._idCheck(sID))return false;_s.sounds[sID].pause();};this.pauseAll=function(){for(var i=_s.soundIDs.length;i--;){_s.sounds[_s.soundIDs[i]].pause();}};this.resume=function(sID){if(!_s._idCheck(sID))return false;_s.sounds[sID].resume();};this.resumeAll=function(){for(var i=_s.soundIDs.length;i--;){_s.sounds[_s.soundIDs[i]].resume();}};this.togglePause=function(sID){if(!_s._idCheck(sID))return false;_s.sounds[sID].togglePause();};this.setPan=function(sID,nPan){if(!_s._idCheck(sID))return false;_s.sounds[sID].setPan(nPan);};this.setVolume=function(sID,nVol){if(!_s._idCheck(sID))return false;_s.sounds[sID].setVolume(nVol);};this.mute=function(sID){if(typeof sID!='string')sID=null;if(!sID){var o=null;_s._wD('soundManager.mute(): Muting all sounds');for(var i=_s.soundIDs.length;i--;){_s.sounds[_s.soundIDs[i]].mute();}
_s.muted=true;}else{if(!_s._idCheck(sID))return false;_s._wD('soundManager.mute(): Muting "'+sID+'"');_s.sounds[sID].mute();}};this.muteAll=function(){_s.mute();};this.unmute=function(sID){if(typeof sID!='string')sID=null;if(!sID){var o=null;_s._wD('soundManager.unmute(): Unmuting all sounds');for(var i=_s.soundIDs.length;i--;){_s.sounds[_s.soundIDs[i]].unmute();}
_s.muted=false;}else{if(!_s._idCheck(sID))return false;_s._wD('soundManager.unmute(): Unmuting "'+sID+'"');_s.sounds[sID].unmute();}};this.unmuteAll=function(){_s.unmute();};this.setPolling=function(bPolling){if(!_s.o||!_s.allowPolling)return false;_s.o._setPolling(bPolling);};this.disable=function(bUnload){if(_s._disabled)return false;_s._disabled=true;_s._wD('soundManager.disable(): Disabling all functions - future calls will return false.',1);for(var i=_s.soundIDs.length;i--;){_s._disableObject(_s.sounds[_s.soundIDs[i]]);};_s.initComplete();_s._disableObject(_s);};this.handleFlashBlock=function(bForce){return false;};this.canPlayURL=function(sURL){return(sURL?(sURL.match(_s.filePattern)?true:false):null);};this.getSoundById=function(sID,suppressDebug){if(!sID)throw new Error('SoundManager.getSoundById(): sID is null/undefined');var result=_s.sounds[sID];if(!result&&!suppressDebug){_s._wD('"'+sID+'" is an invalid sound ID.',2);};return result;};this.onload=function(){soundManager._wD('<em>Warning</em>: soundManager.onload() is undefined.',2);};this.onerror=function(){};this._idCheck=this.getSoundById;this._disableObject=function(o){for(var oProp in o){if(typeof o[oProp]=='function'&&typeof o[oProp]._protected=='undefined')o[oProp]=function(){return false;};};oProp=null;};this._failSafely=function(){var fpgssTitle='You may need to whitelist this location/domain eg. file:///C:/ or C:/ or mysite.com, or set ALWAYS ALLOW under the Flash Player Global Security Settings page. The latter is probably less-secure.';var flashCPL='<a href="'+flashCPLink+'" title="'+fpgssTitle+'">view/edit</a>';var FPGSS='<a href="'+flashCPLink+'" title="Flash Player Global Security Settings">FPGSS</a>';if(!_s._disabled){_s._wD('soundManager: Failed to initialise.',2);_s.disable();};};this._normalizeMovieURL=function(smURL){if(smURL){if(smURL.match(/\.swf/)){smURL=smURL.substr(0,smURL.lastIndexOf('.swf'));}
if(smURL.lastIndexOf('/')!=smURL.length-1){smURL=smURL+'/';}}
return(smURL&&smURL.lastIndexOf('/')!=-1?smURL.substr(0,smURL.lastIndexOf('/')+1):'./')+_s.movieURL;};this._getDocument=function(){return(document.body?document.body:(document.documentElement?document.documentElement:document.getElementsByTagName('div')[0]));};this._getDocument._protected=true;this._createMovie=function(smID,smURL){if(_s._didAppend&&_s._appendSuccess)return false;if(window.location.href.indexOf('debug=1')+1)_s.debugMode=true;_s._didAppend=true;_s._setVersionInfo();var remoteURL=(smURL?smURL:_s.url);var localURL=(_s.altURL?_s.altURL:remoteURL);_s.url=_s._normalizeMovieURL(_s._overHTTP?remoteURL:localURL);smURL=_s.url;var htmlEmbed='<embed name="'+smID+'" id="'+smID+'" src="'+smURL+'" width="100%" height="100%" quality="high" allowScriptAccess="always" quality="high" '+(_s.useHighPerformance&&!_s.useMovieStar?'wmode="transparent" ':'')+'bgcolor="'+_s.bgColor+'" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash"></embed>';var htmlObject='<object id="'+smID+'" data="'+smURL+'" type="application/x-shockwave-flash" width="100%" height="100%"><param name="movie" value="'+smURL+'" /><param name="AllowScriptAccess" value="always" /><param name="quality" value="high" />'+(_s.useHighPerformance&&!_s.useMovieStar?'<param name="wmode" value="transparent" /> ':'')+'<param name="bgcolor" value="'+_s.bgColor+'" /><!-- --></object>';var html=(!_s.isIE?htmlEmbed:htmlObject);var toggleElement='<div id="'+_s.debugID+'-toggle" style="position:fixed;_position:absolute;right:0px;bottom:0px;_top:0px;width:1.2em;height:1.2em;line-height:1.2em;margin:2px;padding:0px;text-align:center;border:1px solid #999;cursor:pointer;background:#fff;color:#333;z-index:10001" title="Toggle SM2 debug console" onclick="soundManager._toggleDebug()">-</div>';var debugHTML='<div id="'+_s.debugID+'" style="display:'+(_s.debugMode&&((!_s._hasConsole||!_s.useConsole)||(_s.useConsole&&_s._hasConsole&&!_s.consoleOnly))?'block':'none')+';opacity:0.85"></div>';var appXHTML='soundManager._createMovie(): appendChild/innerHTML set failed. May be app/xhtml+xml DOM-related.';var oTarget=_s._getDocument();if(oTarget){_s.oMC=document.getElementById('sm2-container')?document.getElementById('sm2-container'):document.createElement('div');if(!_s.oMC.id){_s.oMC.id='sm2-container';_s.oMC.className='movieContainer';var s=null;if(_s.useHighPerformance){s={position:'fixed',width:'8px',height:'8px',bottom:'0px',right:'0px',zIndex:-1}}else{s={position:'absolute',width:'1px',height:'1px',bottom:'0px',right:'0px'}}
var x=null;for(x in s){_s.oMC.style[x]=s[x];}
try{oTarget.appendChild(_s.oMC);_s.oMC.innerHTML=html;_s._appendSuccess=true;}catch(e){throw new Error(appXHTML);}}else{_s.oMC.innerHTML=html;_s._appendSuccess=true;}
if(!document.getElementById(_s.debugID)&&((!_s._hasConsole||!_s.useConsole)||(_s.useConsole&&_s._hasConsole&&!_s.consoleOnly))){var oDebug=document.createElement('div');oDebug.id=_s.debugID;oDebug.style.display=(_s.debugMode?'block':'none');if(_s.debugMode){try{var oD=document.createElement('div');oTarget.appendChild(oD);oD.innerHTML=toggleElement;}catch(e){throw new Error(appXHTML);};};oTarget.appendChild(oDebug);};oTarget=null;};_s._wD('-- SoundManager 2 '+_s.version+(_s.useMovieStar?', MovieStar mode':'')+(_s._wD?', high performance mode':'')+' --',1);_s._wD('soundManager._createMovie(): Trying to load '+smURL+(!_s._overHTTP&&_s.altURL?'(alternate URL)':''),1);};this._writeDebug=function(sText,sType,bTimestamp){if(!_s.debugMode)return false;if(typeof bTimestamp!='undefined'&&bTimestamp){sText=sText+' | '+new Date().getTime();};if(_s._hasConsole&&_s.useConsole){var sMethod=_s._debugLevels[sType];if(typeof console[sMethod]!='undefined'){if(window.log)
window.log(sMethod+':'+sText);else
console[sMethod](sText);}else{if(window.log)
log(sText);else
console.log(sText);};if(_s.useConsoleOnly)return true;};var sDID='soundmanager-debug';try{var o=document.getElementById(sDID);if(!o)return false;var oItem=document.createElement('div');sText=sText.replace(/\n/g,'<br />');if(typeof sType=='undefined'){var sType=0;}else{sType=parseInt(sType);};oItem.innerHTML=sText;if(sType){if(sType>=2)oItem.style.fontWeight='bold';if(sType==3)oItem.style.color='#ff3333';};o.insertBefore(oItem,o.firstChild);}catch(e){};o=null;};this._writeDebug._protected=true;this._wD=this._writeDebug;this._wDAlert=function(sText){alert(sText);};if(window.location.href.indexOf('debug=alert')+1&&_s.debugMode){_s._wD=_s._wDAlert;};this._toggleDebug=function(){var o=document.getElementById(_s.debugID);var oT=document.getElementById(_s.debugID+'-toggle');if(!o)return false;if(_s._debugOpen){oT.innerHTML='+';o.style.display='none';}else{oT.innerHTML='-';o.style.display='block';};_s._debugOpen=!_s._debugOpen;};this._toggleDebug._protected=true;this._debug=function(){_s._wD('--- soundManager._debug(): Current sound objects ---',1);for(var i=0,j=_s.soundIDs.length;i<j;i++){_s.sounds[_s.soundIDs[i]]._debug();};};this._mergeObjects=function(oMain,oAdd){var o1={};for(var i in oMain){o1[i]=oMain[i];}
var o2=(typeof oAdd=='undefined'?_s.defaultOptions:oAdd);for(var o in o2){if(typeof o1[o]=='undefined')o1[o]=o2[o];};return o1;};this.createMovie=function(sURL){if(sURL)_s.url=sURL;_s._initMovie();};this.go=this.createMovie;this._initMovie=function(){if(_s.o)return false;_s.o=_s.getMovie(_s.id);if(!_s.o){_s._createMovie(_s.id,_s.url);_s.o=_s.getMovie(_s.id);};if(_s.o){_s._wD('soundManager._initMovie(): Got '+_s.o.nodeName+' element ('+(_s._didAppend?'created via JS':'static HTML')+')',1);_s._wD('soundManager._initMovie(): Waiting for ExternalInterface call from Flash..');};};this.waitForExternalInterface=function(){if(_s._waitingForEI)return false;_s._waitingForEI=true;if(_s._tryInitOnFocus&&!_s._isFocused){_s._wD('soundManager: Special case: Flash may not have started due to non-focused tab (Safari is lame), and/or focus cannot be detected. Waiting for focus-related event..');return false;};if(!_s._didInit){_s._wD('soundManager: Getting impatient, still waiting for Flash.. ;)');};setTimeout(function(){if(!_s._didInit){_s._wD('soundManager: No Flash response within reasonable time after document load.\nPossible causes: Flash version under 8, no support, or Flash security denying JS-Flash communication.',2);if(!_s._overHTTP){_s._wD('soundManager: Loading this page from local/network file system (not over HTTP?) Flash security likely restricting JS-Flash access. Consider adding current URL to "trusted locations" in the Flash player security settings manager at '+flashCPLink+', or simply serve this content over HTTP.',2);};};if(!_s._didInit&&_s._okToDisable)_s._failSafely();},750);};this.handleFocus=function(){if(_s._isFocused||!_s._tryInitOnFocus)return true;_s._okToDisable=true;_s._isFocused=true;_s._wD('soundManager.handleFocus()');if(_s._tryInitOnFocus){window.removeEventListener('mousemove',_s.handleFocus,false);};_s._waitingForEI=false;setTimeout(_s.waitForExternalInterface,1000);if(window.removeEventListener){window.removeEventListener('focus',_s.handleFocus,false);}else if(window.detachEvent){window.detachEvent('onfocus',_s.handleFocus);};};this.initComplete=function(){if(_s._didInit)return false;_s._didInit=true;_s._wD('-- SoundManager 2 '+(_s._disabled?'failed to load':'loaded')+' ('+(_s._disabled?'security/load error':'OK')+') --',1);if(_s._disabled){_s._wD('soundManager.initComplete(): calling soundManager.onerror()',1);_s.onerror.apply(window);return false;};if(_s.waitForWindowLoad&&!_s._windowLoaded){_s._wD('soundManager: Waiting for window.onload()');if(window.addEventListener){window.addEventListener('load',_s.initUserOnload,false);}else if(window.attachEvent){window.attachEvent('onload',_s.initUserOnload);};return false;}else{if(_s.waitForWindowLoad&&_s._windowLoaded){_s._wD('soundManager: Document already loaded');};_s.initUserOnload();};};this.initUserOnload=function(){_s._wD('soundManager.initComplete(): calling soundManager.onload()',1);try{_s.onload.apply(window);}catch(e){_s._wD('soundManager.onload() threw an exception: '+e.message,2);setTimeout(function(){throw new Error(e)},20);return false;};_s._wD('soundManager.onload() complete',1);};this.init=function(){_s._wD('-- soundManager.init() --');_s._initMovie();if(_s._didInit){_s._wD('soundManager.init(): Already called?');return false;};if(window.removeEventListener){window.removeEventListener('load',_s.beginDelayedInit,false);}else if(window.detachEvent){window.detachEvent('onload',_s.beginDelayedInit);};try{_s._wD('Attempting to call JS -&gt; Flash..');_s.o._externalInterfaceTest(false);if(!_s.allowPolling){_s._wD('Polling (whileloading/whileplaying support) is disabled.',1);}
_s.setPolling(true);if(!_s.debugMode)_s.o._disableDebug();_s.enabled=true;}catch(e){_s._failSafely();_s.initComplete();return false;};_s.initComplete();};this.beginDelayedInit=function(){_s._wD('soundManager.beginDelayedInit(): Document loaded');_s._windowLoaded=true;setTimeout(_s.waitForExternalInterface,500);setTimeout(_s.beginInit,20);};this.beginInit=function(){if(_s._initPending)return false;_s.createMovie();_s._initMovie();_s._initPending=true;return true;};this.domContentLoaded=function(){_s._wD('soundManager.domContentLoaded()');if(document.removeEventListener)document.removeEventListener('DOMContentLoaded',_s.domContentLoaded,false);_s.go();};this._externalInterfaceOK=function(){if(_s.swfLoaded)return false;_s._wD('soundManager._externalInterfaceOK()');_s.swfLoaded=true;_s._tryInitOnFocus=false;if(_s.isIE){setTimeout(_s.init,100);}else{_s.init();};};this._setSandboxType=function(sandboxType){var sb=_s.sandbox;sb.type=sandboxType;sb.description=sb.types[(typeof sb.types[sandboxType]!='undefined'?sandboxType:'unknown')];_s._wD('Flash security sandbox type: '+sb.type);if(sb.type=='localWithFile'){sb.noRemote=true;sb.noLocal=false;_s._wD('Flash security note: Network/internet URLs will not load due to security restrictions. Access can be configured via Flash Player Global Security Settings Page: http://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html',2);}else if(sb.type=='localWithNetwork'){sb.noRemote=false;sb.noLocal=true;}else if(sb.type=='localTrusted'){sb.noRemote=false;sb.noLocal=false;};};this.destruct=function(){_s._wD('soundManager.destruct()');_s.disable(true);};function SMSound(oOptions){var _t=this;this.sID=oOptions.id;this.url=oOptions.url;this.options=_s._mergeObjects(oOptions);this.instanceOptions=this.options;this._iO=this.instanceOptions;this._debug=function(){if(_s.debugMode){var stuff=null;var msg=[];var sF=null;var sfBracket=null;var maxLength=64;for(stuff in _t.options){if(_t.options[stuff]!=null){if(_t.options[stuff]instanceof Function){sF=_t.options[stuff].toString();sF=sF.replace(/\s\s+/g,' ');sfBracket=sF.indexOf('{');msg[msg.length]=' '+stuff+': {'+sF.substr(sfBracket+1,(Math.min(Math.max(sF.indexOf('\n')-1,maxLength),maxLength))).replace(/\n/g,'')+'... }';}else{msg[msg.length]=' '+stuff+': '+_t.options[stuff];};};};_s._wD('SMSound() merged options: {\n'+msg.join(', \n')+'\n}');};};this._debug();this.id3={};this.resetProperties=function(bLoaded){_t.bytesLoaded=null;_t.bytesTotal=null;_t.position=null;_t.duration=null;_t.durationEstimate=null;_t.loaded=false;_t.playState=0;_t.paused=false;_t.readyState=0;_t.muted=false;_t.didBeforeFinish=false;_t.didJustBeforeFinish=false;_t.instanceOptions={};_t.instanceCount=0;_t.peakData={left:0,right:0};_t.waveformData=[];_t.eqData=[];};_t.resetProperties();this.load=function(oOptions){if(typeof oOptions!='undefined'){_t._iO=_s._mergeObjects(oOptions);_t.instanceOptions=_t._iO;}else{var oOptions=_t.options;_t._iO=oOptions;_t.instanceOptions=_t._iO;}
if(typeof _t._iO.url=='undefined')_t._iO.url=_t.url;_s._wD('soundManager.load(): '+_t._iO.url,1);if(_t._iO.url==_t.url&&_t.readyState!=0&&_t.readyState!=2){_s._wD('soundManager.load(): current URL already assigned.',1);return false;}
_t.loaded=false;_t.readyState=1;_t.playState=(oOptions.autoPlay?1:0);try{if(_s.flashVersion==8){_s.o._load(_t.sID,_t._iO.url,_t._iO.stream,_t._iO.autoPlay,(_t._iO.whileloading?1:0));}else{_s.o._load(_t.sID,_t._iO.url,_t._iO.stream?true:false,_t._iO.autoPlay?true:false);if(_t._iO.isMovieStar&&_t._iO.autoLoad&&!_t._iO.autoPlay){_t.pause();}};}catch(e){_s._wD('SMSound.load(): Exception: JS-Flash communication failed, or JS error.',2);_s.onerror();_s.disable();};};this.unload=function(){if(_t.readyState!=0){_s._wD('SMSound.unload(): "'+_t.sID+'"');if(_t.readyState!=2){_t.setPosition(0);}
_s.o._unload(_t.sID,_s.nullURL);_t.resetProperties();}};this.destruct=function(){_s._wD('SMSound.destruct(): "'+_t.sID+'"');_s.o._destroySound(_t.sID);_s.destroySound(_t.sID,true);}
this.play=function(oOptions){if(!oOptions)oOptions={};_t._iO=_s._mergeObjects(oOptions,_t._iO);_t._iO=_s._mergeObjects(_t._iO,_t.options);_t.instanceOptions=_t._iO;if(_t.playState==1){var allowMulti=_t._iO.multiShot;if(!allowMulti){_s._wD('SMSound.play(): "'+_t.sID+'" already playing (one-shot)',1);return false;}else{_s._wD('SMSound.play(): "'+_t.sID+'" already playing (multi-shot)',1);};};if(!_t.loaded){if(_t.readyState==0){_s._wD('SMSound.play(): Attempting to load "'+_t.sID+'"',1);_t._iO.stream=true;_t._iO.autoPlay=true;_t.load(_t._iO);}else if(_t.readyState==2){_s._wD('SMSound.play(): Could not load "'+_t.sID+'" - exiting',2);return false;}else{_s._wD('SMSound.play(): "'+_t.sID+'" is loading - attempting to play..',1);};}else{_s._wD('SMSound.play(): "'+_t.sID+'"');};if(_t.paused){_t.resume();}else{_t.playState=1;if(!_t.instanceCount||_s.flashVersion==9)_t.instanceCount++;_t.position=(typeof _t._iO.position!='undefined'&&!isNaN(_t._iO.position)?_t._iO.position:0);if(_t._iO.onplay)_t._iO.onplay.apply(_t);_t.setVolume(_t._iO.volume);_t.setPan(_t._iO.pan);_s.o._start(_t.sID,_t._iO.loop||1,(_s.flashVersion==9?_t.position:_t.position/1000));};};this.start=this.play;this.stop=function(bAll){if(_t.playState==1){_t.playState=0;_t.paused=false;if(_t._iO.onstop)_t._iO.onstop.apply(_t);_s.o._stop(_t.sID,bAll);_t.instanceCount=0;_t._iO={};};};this.setPosition=function(nMsecOffset){_t._iO.position=nMsecOffset;_s._wD('SMSound.setPosition('+nMsecOffset+')');_s.o._setPosition(_t.sID,(_s.flashVersion==9?_t._iO.position:_t._iO.position/1000),(_t.paused||!_t.playState));};this.pause=function(){if(_t.paused||_t.playState==0)return false;_s._wD('SMSound.pause()');_t.paused=true;_s.o._pause(_t.sID);if(_t._iO.onpause)_t._iO.onpause.apply(_t);};this.resume=function(){if(!_t.paused||_t.playState==0)return false;_s._wD('SMSound.resume()');_t.paused=false;_s.o._pause(_t.sID);if(_t._iO.onresume)_t._iO.onresume.apply(_t);};this.togglePause=function(){_s._wD('SMSound.togglePause()');if(!_t.playState){_t.play({position:(_s.flashVersion==9?_t.position:_t.position/1000)});return false;};if(_t.paused){_t.resume();}else{_t.pause();};};this.setPan=function(nPan){if(typeof nPan=='undefined')nPan=0;_s.o._setPan(_t.sID,nPan);_t._iO.pan=nPan;};this.setVolume=function(nVol){if(typeof nVol=='undefined')nVol=100;_s.o._setVolume(_t.sID,(_s.muted&&!_t.muted)||_t.muted?0:nVol);_t._iO.volume=nVol;};this.mute=function(){_t.muted=true;_s.o._setVolume(_t.sID,0);};this.unmute=function(){_t.muted=false;_s.o._setVolume(_t.sID,typeof _t._iO.volume!='undefined'?_t._iO.volume:_t.options.volume);};this._whileloading=function(nBytesLoaded,nBytesTotal,nDuration){if(!_t._iO.isMovieStar){_t.bytesLoaded=nBytesLoaded;_t.bytesTotal=nBytesTotal;_t.duration=Math.floor(nDuration);_t.durationEstimate=parseInt((_t.bytesTotal/_t.bytesLoaded)*_t.duration);if(_t.readyState!=3&&_t._iO.whileloading)_t._iO.whileloading.apply(_t);}else{_t.bytesLoaded=nBytesLoaded;_t.bytesTotal=nBytesTotal;_t.duration=Math.floor(nDuration);_t.durationEstimate=_t.duration;if(_t.readyState!=3&&_t._iO.whileloading)_t._iO.whileloading.apply(_t);}};this._onid3=function(oID3PropNames,oID3Data){_s._wD('SMSound._onid3(): "'+this.sID+'" ID3 data received.');var oData=[];for(var i=0,j=oID3PropNames.length;i<j;i++){oData[oID3PropNames[i]]=oID3Data[i];};_t.id3=_s._mergeObjects(_t.id3,oData);if(_t._iO.onid3)_t._iO.onid3.apply(_t);};this._whileplaying=function(nPosition,oPeakData,oWaveformData,oEQData){if(isNaN(nPosition)||nPosition==null)return false;_t.position=nPosition;if(_t._iO.usePeakData&&typeof oPeakData!='undefined'&&oPeakData){_t.peakData={left:oPeakData.leftPeak,right:oPeakData.rightPeak};};if(_t._iO.useWaveformData&&typeof oWaveformData!='undefined'&&oWaveformData){_t.waveformData=oWaveformData;};if(_t._iO.useEQData&&typeof oEQData!='undefined'&&oEQData){_t.eqData=oEQData;};if(_t.playState==1){if(_t._iO.whileplaying){_t._iO.whileplaying.apply(_t);};if(_t.loaded&&_t._iO.onbeforefinish&&_t._iO.onbeforefinishtime&&!_t.didBeforeFinish&&_t.duration-_t.position<=_t._iO.onbeforefinishtime){_s._wD('duration-position &lt;= onbeforefinishtime: '+_t.duration+' - '+_t.position+' &lt= '+_t._iO.onbeforefinishtime+' ('+(_t.duration-_t.position)+')');_t._onbeforefinish();};};};this._onload=function(bSuccess){bSuccess=(bSuccess==1?true:false);_s._wD('SMSound._onload(): "'+_t.sID+'"'+(bSuccess?' loaded.':' failed to load? - '+_t.url));if(!bSuccess){if(_s.sandbox.noRemote==true){_s._wD('SMSound._onload(): Reminder: Flash security is denying network/internet access',1);};if(_s.sandbox.noLocal==true){_s._wD('SMSound._onload(): Reminder: Flash security is denying local access',1);};};_t.loaded=bSuccess;_t.readyState=bSuccess?3:2;if(_t._iO.onload){_t._iO.onload.apply(_t);};};this._onbeforefinish=function(){if(!_t.didBeforeFinish){_t.didBeforeFinish=true;if(_t._iO.onbeforefinish){_s._wD('SMSound._onbeforefinish(): "'+_t.sID+'"');_t._iO.onbeforefinish.apply(_t);}};};this._onjustbeforefinish=function(msOffset){if(!_t.didJustBeforeFinish){_t.didJustBeforeFinish=true;if(_t._iO.onjustbeforefinish){_s._wD('SMSound._onjustbeforefinish(): "'+_t.sID+'"');_t._iO.onjustbeforefinish.apply(_t);}};};this._onfinish=function(){_t.playState=0;_t.paused=false;if(_t._iO.onfinish){_s._wD('SMSound._onfinish(): "'+_t.sID+'"');_t._iO.onfinish.apply(_t);}
if(_t._iO.onbeforefinishcomplete)_t._iO.onbeforefinishcomplete.apply(_t);_t.setPosition(0);_t.didBeforeFinish=false;_t.didJustBeforeFinish=false;if(_t.instanceCount){_t.instanceCount--;if(!_t.instanceCount){_t.instanceCount=0;_t.instanceOptions={};}}};this._onmetadata=function(oMetaData){_s._wD('SMSound.onmetadata()');if(!oMetaData.width&&!oMetaData.height){_s._wD('No width/height given, assuming defaults');oMetaData.width=320;oMetaData.height=240;};_t.metadata=oMetaData;_t.width=oMetaData.width;_t.height=oMetaData.height;if(_t._iO.onmetadata){_s._wD('SMSound._onmetadata(): "'+_t.sID+'"');_t._iO.onmetadata.apply(_t);}
_s.wD('SMSound.onmetadata() complete');};};if(_s._tryInitOnFocus)
Ext.EventManager.on(window,'mousemove',_s.handleFocus,_s);Ext.EventManager.on(window,'focus',_s.handleFocus,_s);Ext.EventManager.on(window,'unload',_s.destruct,_s);Ext.onReady(_s.beginDelayedInit,_s);};Ext.app.SoundManager=Ext.extend(Ext.app.Module,{moduleType:'core',moduleId:'sound-manager',disabled:true,settings:{muted:false,volume:60},size:{width:130,height:230},init:function(){this.launcher={handler:this.createWindow,scope:this,iconCls:'sound-manager-mute-icon',scope:this,text:'Volume Control',tooltip:'<b>Volume Control</b><br />Adjust sound properties'};app.onReady(this.onReady,this);this.subscribe('/desktop/sound/play',this.playSoundEvent,this);this.subscribe('/desktop/sound/volume',this.setVolumeEvent,this);},createWindow:function(){var win=app.desktop.getWindow('sound-manager-win');if(win){if(!win.ishidden)
return win.hide();win.setPosition(app.desktop.getViewWidth()-this.size.width,app.desktop.getViewHeight()-this.size.height);if(this.disabled)
win.body.mask();else
win.body.unmask();}else{var x=app.desktop.getViewWidth()-this.size.width;var y=app.desktop.getViewHeight()-this.size.height;this.slider=new Ext.Slider({height:150,vertical:true,minValue:0,maxValue:100,value:this.settings.volume,listeners:{change:{fn:this.setVolume,scope:this},dragend:{fn:this.saveVolume,scope:this}}});win=app.desktop.createWindow({title:'Volume',id:'sound-manager-win',iconCls:'sound-manager-icon',closeAction:'hide',notifyButton:'sound-manager',animateToNotifyButton:true,maximizable:false,minimizable:false,collapsible:false,width:this.size.width,height:this.size.height,x:x,y:y,resizable:false,layout:'border',border:false,stateId:'ext-foo',items:[{region:'center',bodyStyle:'padding:10px;padding-left:45px',items:[this.slider,new Ext.form.Checkbox({name:'mute-volume',hideLabel:true,boxLabel:'Mute',checked:this.settings.muted,handler:this.muteClicked,scope:this})]}]});Ext.EventManager.onWindowResize(function(){var w=app.desktop.getWindow('sound-manager-win');w.setPosition(app.desktop.getViewWidth()-this.size.width,app.desktop.getViewHeight()-this.size.height);},this,{delay:200});if(this.disabled)
win.body.mask();}
win.show();},onReady:function(){this.loadManager.defer(1000,this);this.settings=Ext.state.Manager.get('volume-settings',this.settings);},loadManager:function(){log('loading sound manager 2');this.soundManager=window.soundManager=new SoundManager('javascripts/housekeeping/system/core/sound/');this.soundManager.defaultOptions.volume=this.settings.volume;this.soundManager.onerror=this.onError.createDelegate(this);this.soundManager.onload=this.onLoad.createDelegate(this);app.desktop.addNotificationButton('sound-manager',false);},onLoad:function(){this.publish('/desktop/sound/manager/loaded',this.settings);if(this.trayButton){if(this.settings.muted)
this.trayButton.setIconClass('sound-manager-mute-icon');else
this.trayButton.setIconClass('sound-manager-icon');}
this.disabled=false;var win=app.desktop.getWindow('sound-manager-win');if(win)
win.body.unmask();},onError:function(){this.publish('/desktop/sound/manager/error',{message:'Sound Manager 2 failed to load'});log('flash sound manager failed to load');if(this.trayButton)
this.trayButton.setIconClass('sound-manager-error-icon');this.disabled=true;var win=app.desktop.getWindow('sound-manager-win');if(win)
win.body.mask();},playSoundEvent:function(obj){this.playSound(obj.file);},playSound:function(url){this.publish('/desktop/sound/startplay',{url:url,volume:this.settings.volume,muted:this.settings.muted});if(this.disabled)
return;if(!this.soundManager)
return log('sound manager not found');this.currentId=Ext.id(null,'sound');var data=[];var opts={id:this.currentId,url:url,volume:this.settings.volume,autoPlay:true,onload:this.soundLoaded.createDelegate(this,data,0),onid3:this.soundInfo.createDelegate(this,data,0)};data.push(this.soundManager.createSound(opts));},soundInfo:function(o){this.publish('/desktop/sound/meta',o);},soundLoaded:function(o){this.publish('/desktop/sound/loaded',o);if(this.settings.muted)
this.soundManager.mute(this.currentId);else
this.soundManager.unmute(this.currentId);},mute:function(mute){if(mute){this.settings.muted=true;if(this.currentId)
this.soundManager.mute(this.currentId);if(this.trayButton)
this.trayButton.setIconClass('sound-manager-mute-icon');}else{this.settings.muted=false;if(this.currentId)
this.soundManager.unmute(this.currentId);if(this.trayButton)
his.trayButton.setIconClass('sound-manager-icon');}
this.saveSettings();},muteClicked:function(o,mute){this.publish('/desktop/sound/volume',{muted:mute});},setVolume:function(o,vol){if(this.timer)
window.clearTimeout(this.timer);this.timer=this.publish.defer(75,this,['/desktop/sound/volume',{volume:vol}]);},setVolumeEvent:function(e){if(e.hasOwnProperty('volume')){this.settings.volume=e.volume;if(this.currentId)
this.soundManager.setVolume(this.currentId,e.volume);if(this.slider)
this.slider.setValue(e.volume);}
if(e.hasOwnProperty('muted'))
this.mute(e.muted);},saveVolume:function(){this.saveSettings();},saveSettings:function(){Ext.state.Manager.set('volume-settings',this.settings);}});app.register('Ext.app.SoundManager');(function(){var EV=Ext.lib.Event;Ext.ux.ManagedIFrame=function(){var args=Array.prototype.slice.call(arguments,0),el=Ext.get(args[0]),config=args[0];if(el&&el.dom&&el.dom.tagName=='IFRAME'){config=args[1]||{};}else{config=args[0]||args[1]||{};el=config.autoCreate?Ext.get(Ext.DomHelper.append(config.autoCreate.parent||document.body,Ext.apply({tag:'iframe',src:(Ext.isIE&&Ext.isSecure)?Ext.SSL_SECURE_URL:''},config.autoCreate))):null;}
if(!el||el.dom.tagName!='IFRAME')return el;el.dom.name||(el.dom.name=el.dom.id);el.dom.mifId=el.dom.id;this.addEvents({"focus":true,"blur":true,"unload":true,"domready":true,"documentloaded":true,"exception":true,"message":true});if(config.listeners){this.listeners=config.listeners;Ext.ux.ManagedIFrame.superclass.constructor.call(this);}
Ext.apply(el,this);el.addClass('x-managed-iframe');if(config.style){el.applyStyles(config.style);}
el._maskEl=el.parent('.x-managed-iframe-mask')||el.parent().addClass('x-managed-iframe-mask');Ext.apply(el,{disableMessaging:config.disableMessaging===true,loadMask:Ext.apply({msg:'Loading..',msgCls:'x-mask-loading',maskEl:el._maskEl,hideOnReady:true,disabled:!config.loadMask},config.loadMask),_eventName:Ext.isIE?'onreadystatechange':'onload',_windowContext:null,eventsFollowFrameLinks:typeof config.eventsFollowFrameLinks=='undefined'?true:config.eventsFollowFrameLinks});el.dom[el._eventName]=el.loadHandler.createDelegate(el);var um=el.updateManager=new Ext.UpdateManager(el,true);um.showLoadIndicator=config.showLoadIndicator||false;if(config.src){el.setSrc(config.src);}else{var content=config.html||config.content||false;if(content){el.update.defer(10,el,[content]);}}
return Ext.ux.ManagedIFrame.Manager.register(el);};var MIM=Ext.ux.ManagedIFrame.Manager=function(){var frames={};var readyHandler=function(e,target){try{var id=target?target.mifId:null,frame;if((frame=this.getFrameById(id||target.id))&&frame._frameAction){frame.loadHandler({type:'domready'});}}catch(rhEx){}};var implementation={shimCls:'x-frame-shim',register:function(frame){frame.manager=this;frames[frame.id]=frames[frame.dom.name]={ref:frame,elCache:{}};return frame;},deRegister:function(frame){frame._unHook();delete frames[frame.id];delete frames[frame.dom.name];},hideShims:function(){if(!this.shimApplied)return;Ext.select('.'+this.shimCls,true).removeClass(this.shimCls+'-on');this.shimApplied=false;},showShims:function(){if(!this.shimApplied){this.shimApplied=true;Ext.select('.'+this.shimCls,true).addClass(this.shimCls+'-on');}},getFrameById:function(id){return typeof id=='string'?(frames[id]?frames[id].ref||null:null):null;},getFrameByName:function(name){return this.getFrameById(name);},getFrameHash:function(frame){return frame.id?frames[frame.id]:null;},eventProxy:function(e){if(!e)return;e=Ext.EventObject.setEvent(e);var be=e.browserEvent||e;if(e.type=='unload'){this._unHook();}
if(!be['eventPhase']||(be['eventPhase']==(be['AT_TARGET']||2))){return this.fireEvent(e.type,e);}},_flyweights:{},destroy:function(){if(this._domreadySignature){Ext.EventManager.un.apply(Ext.EventManager,this._domreadySignature);}},removeNode:Ext.isIE?function(frame,n){frame=MIM.getFrameHash(frame);if(frame&&n&&n.tagName!='BODY'){d=frame.scratchDiv||(frame.scratchDiv=frame.getDocument().createElement('div'));d.appendChild(n);d.innerHTML='';}}:function(frame,n){if(n&&n.parentNode&&n.tagName!='BODY'){n.parentNode.removeChild(n);}}};if(document.addEventListener){Ext.EventManager.on.apply(Ext.EventManager,implementation._domreadySignature=[window,"DOMFrameContentLoaded",readyHandler,implementation]);}
Ext.EventManager.on(window,'beforeunload',implementation.destroy,implementation);return implementation;}();MIM.showDragMask=MIM.showShims;MIM.hideDragMask=MIM.hideShims;MIM.El=function(frame,el,forceNew){var frameObj;frame=(frameObj=MIM.getFrameHash(frame))?frameObj.ref:null;if(!frame){return null;}
var elCache=frameObj.elCache||(frameObj.elCache={});var dom=frame.getDom(el);if(!dom){return null;}
var id=dom.id;if(forceNew!==true&&id&&elCache[id]){return elCache[id];}
this.dom=dom;this.id=id||Ext.id(dom);};MIM.El.get=function(frame,el){var ex,elm,id,doc;if(!frame||!el){return null;}
var frameObj;frame=(frameObj=MIM.getFrameHash(frame))?frameObj.ref:null;if(!frame){return null;}
var elCache=frameObj.elCache||(frameObj.elCache={});if(!(doc=frame.getDocument())){return null;}
if(typeof el=="string"){if(!(elm=frame.getDom(el))){return null;}
if(ex=elCache[el]){ex.dom=elm;}else{ex=elCache[el]=new MIM.El(frame,elm);}
return ex;}else if(el.tagName){if(!(id=el.id)){id=Ext.id(el);}
if(ex=elCache[id]){ex.dom=el;}else{ex=elCache[id]=new MIM.El(frame,el);}
return ex;}else if(el instanceof MIM.El){if(el!=frameObj.docEl){el.dom=frame.getDom(el.id)||el.dom;elCache[el.id]=el;}
return el;}else if(el.isComposite){return el;}else if(Ext.isArray(el)){return frame.select(el);}else if(el==doc){if(!frameObj.docEl){var f=function(){};f.prototype=MIM.El.prototype;frameObj.docEl=new f();frameObj.docEl.dom=doc;}
return frameObj.docEl;}
return null;};Ext.apply(MIM.El.prototype,Ext.Element.prototype);Ext.extend(Ext.ux.ManagedIFrame,Ext.util.Observable,{src:null,resetUrl:Ext.isIE&&Ext.isSecure?Ext.SSL_SECURE_URL:'about:blank',setSrc:function(url,discardUrl,callback){var src=url||this.src||this.resetUrl;this._windowContext=null;this._unHook();this._frameAction=this.frameInit=this._domReady=false;if(Ext.isOpera){this.reset();}
this._callBack=callback||false;this.showMask();(function(){var s=typeof src=='function'?src()||'':src;try{this._frameAction=true;this.dom.src=s;this.frameInit=true;this.checkDOM();}catch(ex){this.fireEvent('exception',this,ex);}}).defer(100,this);if(discardUrl!==true){this.src=src;}
return this;},reset:function(src,callback){this.dom.src=src||this.resetUrl;if(typeof callback=='function'){callback.defer(100);}
return this;},scriptRE:/(?:<script.*?>)((\n|\r|.)*?)(?:<\/script>)/gi,update:function(content,loadScripts,callback){loadScripts=loadScripts||this.getUpdateManager().loadScripts||false;content=Ext.DomHelper.markup(content||'');content=loadScripts===true?content:content.replace(this.scriptRE,"");var doc;if(doc=this.getDocument()){this._frameAction=!!content.length;this._windowContext=this.src=null;this._callBack=callback||false;this._unHook();this.showMask();doc.open();doc.write(content);doc.close();this.frameInit=true;if(this._frameAction){this.checkDOM();}else{this.hideMask(true);if(this._callBack)this._callBack();}}else{this.hideMask(true);if(this._callBack)this._callBack();}
return this;},disableMessaging:true,_XFrameMessaging:function(){var tagStack={'$':[]};var isEmpty=function(v,allowBlank){return v===null||v===undefined||(!allowBlank?v==='':false);};window.sendMessage=function(message,tag,origin){var MIF;if(MIF=arguments.callee.manager){if(message._fromHost){var fn,result;var compTag=message.tag||tag||null;var mstack=!isEmpty(compTag)?tagStack[compTag.toLowerCase()]||[]:tagStack["$"];for(var i=0,l=mstack.length;i<l;i++){if(fn=mstack[i]){result=fn.apply(fn.__scope,arguments)===false?false:result;if(fn.__single){mstack[i]=null;}
if(result===false){break;}}}
return result;}else{message={type:isEmpty(tag)?'message':'message:'+tag.toLowerCase().replace(/^\s+|\s+$/g,''),data:message,domain:origin||document.domain,uri:document.documentURI,source:window,tag:isEmpty(tag)?null:tag.toLowerCase()};try{return MIF.disableMessaging!==true?MIF.fireEvent.call(MIF,message.type,MIF,message):null;}catch(ex){}
return null;}}};window.onhostmessage=function(fn,scope,single,tag){if(typeof fn=='function'){if(!isEmpty(fn.__index)){throw"onhostmessage: duplicate handler definition"+(tag?" for tag:"+tag:'');}
var k=isEmpty(tag)?"$":tag.toLowerCase();tagStack[k]||(tagStack[k]=[]);Ext.apply(fn,{__tag:k,__single:single||false,__scope:scope||window,__index:tagStack[k].length});tagStack[k].push(fn);}else
{throw"onhostmessage: function required";}};window.unhostmessage=function(fn){if(typeof fn=='function'&&typeof fn.__index!='undefined'){var k=fn.__tag||"$";tagStack[k][fn.__index]=null;}};},get:function(el){return MIM.El.get(this,el);},fly:function(el,named){named=named||'_global';el=this.getDom(el);if(!el){return null;}
if(!MIM._flyweights[named]){MIM._flyweights[named]=new Ext.Element.Flyweight();}
MIM._flyweights[named].dom=el;return MIM._flyweights[named];},getDom:function(el){var d;if(!el||!(d=this.getDocument())){return null;}
return el.dom?el.dom:(typeof el=='string'?d.getElementById(el):el);},select:function(selector,unique){var d;return(d=this.getDocument())?Ext.Element.select(selector,unique,d):null;},query:function(selector){var d;return(d=this.getDocument())?Ext.DomQuery.select(selector,d):null;},getDoc:function(){return this.get(this.getDocument());},removeNode:function(node){MIM.removeNode(this,this.getDom(node));},_unHook:function(){var elcache,h=MIM.getFrameHash(this)||{};if(this._hooked&&h&&(elcache=h.elCache)){for(var id in elcache){var el=elcache[id];delete elcache[id];if(el.removeAllListeners)el.removeAllListeners();}
if(h.docEl){h.docEl.removeAllListeners();h.docEl=null;delete h.docEl;}}
this._hooked=this._domReady=this._domFired=false;},_renderHook:function(){this._windowContext=this.CSS=null;this._hooked=false;try{if(this.writeScript('(function(){(window.hostMIF = parent.Ext.get("'+
this.dom.id+'"))._windowContext='+
(Ext.isIE?'window':'{eval:function(s){return eval(s);}}')+';})();')){this._frameProxy||(this._frameProxy=MIM.eventProxy.createDelegate(this));var w=this.getWindow();EV.doAdd(w,'focus',this._frameProxy);EV.doAdd(w,'blur',this._frameProxy);EV.doAdd(w,'unload',this._frameProxy);if(this.disableMessaging!==true){this.loadFunction({name:'XMessage',fn:this._XFrameMessaging},false,true);var sm;if(sm=w.sendMessage){sm.manager=this;}}
this.CSS=new CSSInterface(this.getDocument());}}catch(ex){}
return this.domWritable();},sendMessage:function(message,tag,origin){var win;if(this.disableMessaging!==true&&(win=this.getWindow())){tag||(tag=message.tag||'');tag=tag.toLowerCase();message=Ext.applyIf(message.data?message:{data:message},{type:Ext.isEmpty(tag)?'message':'message:'+tag,domain:origin||document.domain,uri:document.documentURI,source:window,tag:tag||null,_fromHost:this});return win.sendMessage?win.sendMessage.call(null,message,tag,origin):null;}
return null;},_windowContext:null,getDocument:function(){var win=this.getWindow(),doc=null;try{doc=(Ext.isIE&&win?win.document:null)||this.dom.contentDocument||window.frames[this.id].document||null;}catch(gdEx){return false;}
return doc;},getBody:function(){var d;return(d=this.getDocument())?d.body:null;},getDocumentURI:function(){var URI,d;try{URI=this.src&&(d=this.getDocument())?d.location.href:null;}catch(ex){}
return URI||this.src;},getWindow:function(){var dom=this.dom,win=null;try{win=dom.contentWindow||window.frames[dom.name]||null;}catch(gwEx){}
return win;},print:function(){try{var win=this.getWindow();if(Ext.isIE){win.focus();}
win.print();}catch(ex){throw'print exception: '+(ex.description||ex.message||ex);}},destroy:function(){this.removeAllListeners();if(this.dom){this.dom[this._eventName]=null;Ext.ux.ManagedIFrame.Manager.deRegister(this);this._windowContext=null;if(Ext.isIE&&this.dom.src){this.dom.src='javascript:false';}
this._maskEl=null;this.remove();}
if(this.loadMask){Ext.apply(this.loadMask,{masker:null,maskEl:null});}},domWritable:function(){return!!this._windowContext;},execScript:function(block,useDOM){try{if(this.domWritable()){if(useDOM){this.writeScript(block);}else{return this._windowContext.eval(block);}}else{throw'execScript:non-secure context'}}catch(ex){this.fireEvent('exception',this,ex);return false;}
return true;},writeScript:function(block,attributes){attributes=Ext.apply({},attributes||{},{type:"text/javascript",text:block});try{var head,script,doc=this.getDocument();if(doc&&typeof doc.getElementsByTagName!='undefined'){if(!(head=doc.getElementsByTagName("head")[0])){head=doc.createElement("head");doc.getElementsByTagName("html")[0].appendChild(head);}
if(head&&(script=doc.createElement("script"))){for(var attrib in attributes){if(attributes.hasOwnProperty(attrib)&&attrib in script){script[attrib]=attributes[attrib];}}
return!!head.appendChild(script);}}}catch(ex){this.fireEvent('exception',this,ex);}
return false;},loadFunction:function(fn,useDOM,invokeIt){var name=fn.name||fn;var fn=fn.fn||window[fn];this.execScript(name+'='+fn,useDOM);if(invokeIt){this.execScript(name+'()');}},showMask:function(msg,msgCls,forced){var lmask;if((lmask=this.loadMask)&&(!lmask.disabled||forced)){if(lmask._vis)return;lmask.masker||(lmask.masker=Ext.get(lmask.maskEl||this.dom.parentNode||this.wrap({tag:'div',style:{position:'relative'}})));lmask._vis=true;lmask.masker.mask.defer(lmask.delay||5,lmask.masker,[msg||lmask.msg,msgCls||lmask.msgCls]);}},hideMask:function(forced){var tlm;if((tlm=this.loadMask)&&!tlm.disabled&&tlm.masker){if(!forced&&(tlm.hideOnReady!==true&&this._domReady)){return;}
tlm._vis=false;tlm.masker.unmask.defer(tlm.delay||5,tlm.masker);}},loadHandler:function(e,target){if(!this.frameInit||(!this._frameAction&&!this.eventsFollowFrameLinks)){return;}
target||(target={});var rstatus=(e&&typeof e.type!=='undefined'?e.type:this.dom.readyState);switch(rstatus){case'loading':case'interactive':break;case'domready':if(this._domReady)return;this._domReady=true;if(this._hooked=this._renderHook()){this._domFired=true;this.fireEvent("domready",this);}
case'domfail':this._domReady=true;this.hideMask();break;case'load':case'complete':if(!this._domReady){this.loadHandler({type:'domready',id:this.id});}
this.hideMask(true);if(this._frameAction||this.eventsFollowFrameLinks){this.fireEvent.defer(50,this,["documentloaded",this]);}
this._frameAction=this._frameInit=false;if(this.eventsFollowFrameLinks){this._domFired=this._domReady=false;}
if(this._callBack){this._callBack(this);}
break;default:}
this.frameState=rstatus;},checkDOM:function(win){if(Ext.isOpera||Ext.isGecko||!this._frameAction)return;var n=0,win=win||this.getWindow(),manager=this,domReady=false,max=300;var poll=function(){try{var doc=manager.getDocument(),body=null;if(doc===false){throw"Document Access Denied";}
if(!manager._domReady){domReady=!!(doc&&doc.getElementsByTagName);domReady=domReady&&(body=doc.getElementsByTagName('body')[0])&&!!body.innerHTML.length;}}catch(ex){n=max;}
if(!manager._frameAction||manager._domReady)return;if((++n<max)&&!domReady)
{setTimeout(arguments.callee,10);return;}
manager.loadHandler({type:domReady?'domready':'domfail'});};setTimeout(poll,40);}});var styleCamelRe=/(-[a-z])/gi;var styleCamelFn=function(m,a){return a.charAt(1).toUpperCase();};var CSSInterface=function(hostDocument){var doc;if(hostDocument){doc=hostDocument;return{rules:null,createStyleSheet:function(cssText,id){var ss;if(!doc)return;var head=doc.getElementsByTagName("head")[0];var rules=doc.createElement("style");rules.setAttribute("type","text/css");if(id){rules.setAttribute("id",id);}
if(Ext.isIE){head.appendChild(rules);ss=rules.styleSheet;ss.cssText=cssText;}else{try{rules.appendChild(doc.createTextNode(cssText));}catch(e){rules.cssText=cssText;}
head.appendChild(rules);ss=rules.styleSheet?rules.styleSheet:(rules.sheet||doc.styleSheets[doc.styleSheets.length-1]);}
this.cacheStyleSheet(ss);return ss;},removeStyleSheet:function(id){if(!doc)return;var existing=doc.getElementById(id);if(existing){existing.parentNode.removeChild(existing);}},swapStyleSheet:function(id,url){this.removeStyleSheet(id);if(!doc)return;var ss=doc.createElement("link");ss.setAttribute("rel","stylesheet");ss.setAttribute("type","text/css");ss.setAttribute("id",id);ss.setAttribute("href",url);doc.getElementsByTagName("head")[0].appendChild(ss);},refreshCache:function(){return this.getRules(true);},cacheStyleSheet:function(ss){if(this.rules){this.rules={};}
try{var ssRules=ss.cssRules||ss.rules;for(var j=ssRules.length-1;j>=0;--j){this.rules[ssRules[j].selectorText]=ssRules[j];}}catch(e){}},getRules:function(refreshCache){if(this.rules==null||refreshCache){this.rules={};if(doc){var ds=doc.styleSheets;for(var i=0,len=ds.length;i<len;i++){try{this.cacheStyleSheet(ds[i]);}catch(e){}}}}
return this.rules;},getRule:function(selector,refreshCache){var rs=this.getRules(refreshCache);if(!Ext.isArray(selector)){return rs[selector];}
for(var i=0;i<selector.length;i++){if(rs[selector[i]]){return rs[selector[i]];}}
return null;},updateRule:function(selector,property,value){if(!Ext.isArray(selector)){var rule=this.getRule(selector);if(rule){rule.style[property.replace(styleCamelRe,styleCamelFn)]=value;return true;}}else{for(var i=0;i<selector.length;i++){if(this.updateRule(selector[i],property,value)){return true;}}}
return false;}};}};Ext.ux.ManagedIframePanel=Ext.extend(Ext.Panel,{defaultSrc:null,bodyStyle:{height:'100%',width:'100%',position:'relative'},frameStyle:{overflow:'auto'},frameConfig:null,hideMode:!Ext.isIE?'nosize':'display',shimCls:Ext.ux.ManagedIFrame.Manager.shimCls,shimUrl:null,loadMask:false,stateful:false,animCollapse:Ext.isIE&&Ext.enableFx,autoScroll:false,closable:true,ctype:"Ext.ux.ManagedIframePanel",showLoadIndicator:false,unsupportedText:'Inline frames are NOT enabled\/supported by your browser.',initComponent:function(){this.bodyCfg||(this.bodyCfg={cls:'x-managed-iframe-mask',children:[Ext.apply({tag:'iframe',frameborder:0,cls:'x-managed-iframe',style:this.frameStyle||null,html:this.unsupportedText||null},this.frameConfig?this.frameConfig.autoCreate||{}:false,Ext.isIE&&Ext.isSecure?{src:Ext.SSL_SECURE_URL}:false),{tag:'img',src:this.shimUrl||Ext.BLANK_IMAGE_URL,cls:this.shimCls,galleryimg:"no"}]});this.autoScroll=false;this.items=null;if(this.stateful!==false){this.stateEvents||(this.stateEvents=['documentloaded']);}
Ext.ux.ManagedIframePanel.superclass.initComponent.call(this);this.monitorResize||(this.monitorResize=this.fitToParent);this.addEvents({documentloaded:true,domready:true,message:true,exception:true});this.addListener=this.on;},doLayout:function(){if(this.fitToParent&&!this.ownerCt){var pos=this.getPosition(),size=(Ext.get(this.fitToParent)||this.getEl().parent()).getViewSize();this.setSize(size.width-pos[0],size.height-pos[1]);}
Ext.ux.ManagedIframePanel.superclass.doLayout.apply(this,arguments);},beforeDestroy:function(){if(this.rendered){if(this.tools){for(var k in this.tools){Ext.destroy(this.tools[k]);}}
if(this.header&&this.headerAsText){var s;if(s=this.header.child('span'))s.remove();this.header.update('');}
Ext.each(['iframe','shim','header','topToolbar','bottomToolbar','footer','loadMask','body','bwrap'],function(elName){if(this[elName]){if(typeof this[elName].destroy=='function'){this[elName].destroy();}else{Ext.destroy(this[elName]);}
this[elName]=null;delete this[elName];}},this);}
Ext.ux.ManagedIframePanel.superclass.beforeDestroy.call(this);},onDestroy:function(){Ext.Panel.superclass.onDestroy.call(this);},onRender:function(ct,position){Ext.ux.ManagedIframePanel.superclass.onRender.call(this,ct,position);if(this.iframe=this.body.child('iframe.x-managed-iframe')){this.iframe.ownerCt=this;var El=Ext.Element;var mode=El[this.hideMode.toUpperCase()]||'x-hide-nosize';Ext.each([this[this.collapseEl],this.floating?null:this.getActionEl(),this.iframe],function(el){if(el)el.setVisibilityMode(mode);},this);if(this.loadMask){this.loadMask=Ext.apply({disabled:false,maskEl:this.body,hideOnReady:true},this.loadMask);}
if(this.iframe=new Ext.ux.ManagedIFrame(this.iframe,{loadMask:this.loadMask,showLoadIndicator:this.showLoadIndicator,disableMessaging:this.disableMessaging,style:this.frameStyle})){this.loadMask=this.iframe.loadMask;this.relayEvents(this.iframe,["blur","focus","unload","documentloaded","domready","exception","message"].concat(this._msgTagHandlers||[]));delete this._msgTagHandlers;}
this.getUpdater().showLoadIndicator=this.showLoadIndicator||false;var ownerCt=this.ownerCt;while(ownerCt){ownerCt.on('afterlayout',function(container,layout){var MIM=Ext.ux.ManagedIFrame.Manager,st=false;Ext.each(['north','south','east','west'],function(region){var reg;if((reg=layout[region])&&reg.splitEl){st=true;if(!reg.split._splitTrapped){reg.split.on('beforeresize',MIM.showShims,MIM);reg.split._splitTrapped=true;}}},this);if(st&&!this._splitTrapped){this.on('resize',MIM.hideShims,MIM);this._splitTrapped=true;}},this,{single:true});ownerCt=ownerCt.ownerCt;}}
this.shim=Ext.get(this.body.child('.'+this.shimCls));},toggleShim:function(){if(this.shim&&this.shimCls)this.shim.toggleClass(this.shimCls+'-on');},afterRender:function(container){var html=this.html;delete this.html;Ext.ux.ManagedIframePanel.superclass.afterRender.call(this);if(this.iframe){if(this.defaultSrc){this.setSrc();}
else if(html){this.iframe.update(typeof html=='object'?Ext.DomHelper.markup(html):html);}}},sendMessage:function(){if(this.iframe){this.iframe.sendMessage.apply(this.iframe,arguments);}},on:function(name){var tagRE=/^message\:/i,n=null;if(typeof name=='object'){for(var na in name){if(!this.filterOptRe.test(na)&&tagRE.test(na)){n||(n=[]);n.push(na.toLowerCase());}}}else if(tagRE.test(name)){n=[name.toLowerCase()];}
if(this.getFrame()&&n){this.relayEvents(this.iframe,n);}else{this._msgTagHandlers||(this._msgTagHandlers=[]);if(n)this._msgTagHandlers=this._msgTagHandlers.concat(n);}
Ext.ux.ManagedIframePanel.superclass.on.apply(this,arguments);},setSrc:function(url,discardUrl,callback){url=url||this.defaultSrc||false;if(!url)return this;if(url.url){callback=url.callback||false;discardUrl=url.discardUrl||false;url=url.url||false;}
var src=url||(Ext.isIE&&Ext.isSecure?Ext.SSL_SECURE_URL:'');if(this.rendered&&this.iframe){this.iframe.setSrc(src,discardUrl,callback);}
return this;},getState:function(){var URI=this.iframe?this.iframe.getDocumentURI()||null:null;return Ext.apply(Ext.ux.ManagedIframePanel.superclass.getState.call(this)||{},URI?{defaultSrc:typeof URI=='function'?URI():URI}:null);},getUpdater:function(){return this.rendered?(this.iframe||this.body).getUpdater():null;},getFrame:function(){return this.rendered?this.iframe:null},getFrameWindow:function(){return this.rendered&&this.iframe?this.iframe.getWindow():null;},getFrameDocument:function(){return this.rendered&&this.iframe?this.iframe.getDocument():null;},getFrameDoc:function(){return this.rendered&&this.iframe?this.iframe.getDoc():null;},getFrameBody:function(){return this.rendered&&this.iframe?this.iframe.getBody():null;},load:function(loadCfg){var um;if(um=this.getUpdater()){if(loadCfg&&loadCfg.renderer){um.setRenderer(loadCfg.renderer);delete loadCfg.renderer;}
um.update.apply(um,arguments);}
return this;},doAutoLoad:function(){this.load(typeof this.autoLoad=='object'?this.autoLoad:{url:this.autoLoad});}});Ext.reg('iframepanel',Ext.ux.ManagedIframePanel);Ext.ux.ManagedIframePortlet=Ext.extend(Ext.ux.ManagedIframePanel,{anchor:'100%',frame:true,collapseEl:'bwrap',collapsible:true,draggable:true,cls:'x-portlet'});Ext.reg('iframeportlet',Ext.ux.ManagedIframePortlet);Ext.apply(Ext.Element.prototype,{setVisible:function(visible,animate){if(!animate||!Ext.lib.Anim){if(this.visibilityMode==Ext.Element.DISPLAY){this.setDisplayed(visible);}else if(this.visibilityMode==Ext.Element.VISIBILITY){this.fixDisplay();this.dom.style.visibility=visible?"visible":"hidden";}else{this[visible?'removeClass':'addClass'](String(this.visibilityMode));}}else{var dom=this.dom;var visMode=this.visibilityMode;if(visible){this.setOpacity(.01);this.setVisible(true);}
this.anim({opacity:{to:(visible?1:0)}},this.preanim(arguments,1),null,.35,'easeIn',function(){if(!visible){if(visMode==Ext.Element.DISPLAY){dom.style.display="none";}else if(visMode==Ext.Element.VISIBILITY){dom.style.visibility="hidden";}else{Ext.get(dom).addClass(String(visMode));}
Ext.get(dom).setOpacity(1);}});}
return this;},isVisible:function(deep){var vis=!(this.getStyle("visibility")=="hidden"||this.getStyle("display")=="none"||this.hasClass(this.visibilityMode));if(deep!==true||!vis){return vis;}
var p=this.dom.parentNode;while(p&&p.tagName.toLowerCase()!="body"){if(!Ext.fly(p,'_isVisible').isVisible()){return false;}
p=p.parentNode;}
return true;}});Ext.onReady(function(){var CSS=Ext.util.CSS,rules=[];CSS.getRule('.x-managed-iframe')||(rules.push('.x-managed-iframe {height:100%;width:100%;overflow:auto;}'));CSS.getRule('.x-managed-iframe-mask')||(rules.push('.x-managed-iframe-mask{width:100%;height:100%;position:relative;}'));if(!CSS.getRule('.x-frame-shim')){rules.push('.x-frame-shim {z-index:8500;position:absolute;top:0px;left:0px;background:transparent!important;overflow:hidden;display:none;}');rules.push('.x-frame-shim-on{width:100%;height:100%;display:block;zoom:1;}');rules.push('.ext-ie6 .x-frame-shim{margin-left:5px;margin-top:3px;}');}
CSS.getRule('.x-hide-nosize')||(rules.push('.x-hide-nosize,.x-hide-nosize *{height:0px!important;width:0px!important;border:none;}'));if(!!rules.length){CSS.createStyleSheet(rules.join(' '));}});})();Ext.override(Ext.data.Connection,{request:function(o){if(this.fireEvent("beforerequest",this,o)!==false){var p=o.params;if(typeof p=="function"){p=p.call(o.scope||window,o);}
if(typeof p=="object"){p=Ext.urlEncode(p);}
if(this.extraParams){var extras=Ext.urlEncode(this.extraParams);p=p?(p+'&'+extras):extras;}
var url=o.url||this.url;if(typeof url=='function'){url=url.call(o.scope||window,o);}
if(o.form){var form=Ext.getDom(o.form);url=url||form.action;var enctype=form.getAttribute("enctype");if(o.isUpload||(enctype&&enctype.toLowerCase()=='multipart/form-data')){return this.doFormUpload(o,p,url);}
var f=Ext.lib.Ajax.serializeForm(form);p=p?(p+'&'+f):f;}
var hs=o.headers;if(this.defaultHeaders){hs=Ext.apply(hs||{},this.defaultHeaders);if(!o.headers){o.headers=hs;}}
var cb={success:this.handleResponse,failure:this.handleFailure,scope:this,argument:{options:o},timeout:this.timeout};var method=o.method||this.method||(p?"POST":"GET");if(method=='GET'&&(this.disableCaching&&o.disableCaching!==false)||o.disableCaching===true){url+=(url.indexOf('?')!=-1?'&':'?')+'_dc='+(new Date().getTime());}
if(typeof o.autoAbort=='boolean'){if(o.autoAbort){this.abort();}}else if(this.autoAbort!==false){this.abort();}
if((method=='GET'&&p)||o.xmlData||o.jsonData){url+=(url.indexOf('?')!=-1?'&':'?')+p;p='';}
if(o.scriptTag||this.scriptTag){this.transId=this.scriptRequest(method,url,cb,p,o);}else{this.transId=Ext.lib.Ajax.request(method,url,cb,p,o);}
return this.transId;}else{Ext.callback(o.callback,o.scope,[o,null,null]);return null;}},scriptRequest:function(method,url,cb,data,options){var transId=++Ext.data.ScriptTagProxy.TRANS_ID;var trans={id:transId,cb:options.callbackName||"stcCallback"+transId,scriptId:"stcScript"+transId,options:options};url+=(url.indexOf("?")!=-1?"&":"?")+data+String.format("&{0}={1}",options.callbackParam||this.callbackParam||'callback',trans.cb);var conn=this;window[trans.cb]=function(o){conn.handleScriptResponse(o,trans);};trans.timeoutId=this.handleScriptFailure.defer(cb.timeout,this,[trans]);var script=document.createElement("script");script.setAttribute("src",url);script.setAttribute("type","text/javascript");script.setAttribute("id",trans.scriptId);document.getElementsByTagName("head")[0].appendChild(script);return trans;},handleScriptResponse:function(o,trans){this.transId=false;this.destroyScriptTrans(trans,true);var options=trans.options;var doc;if(typeof o=='string'){if(window.ActiveXObject){var doc=new ActiveXObject("Microsoft.XMLDOM");doc.async="false";doc.loadXML(o);}else{var doc=new DOMParser().parseFromString(o,"text/xml");}}
response={responseObject:o,responseText:(typeof o=="object")?Ext.util.JSON.encode(o):String(o),responseXML:doc,argument:options.argument}
this.fireEvent("requestcomplete",this,response,options);Ext.callback(options.success,options.scope,[response,options]);Ext.callback(options.callback,options.scope,[options,true,response]);},handleScriptFailure:function(trans){this.trans=false;this.destroyScriptTrans(trans,false);var options=trans.options;response={argument:options.argument,status:500,statusText:'Server failed to respond',responseText:''};this.fireEvent("requestexception",this,response,options,{status:-1,statusText:'communication failure'});Ext.callback(options.failure,options.scope,[response,options]);Ext.callback(options.callback,options.scope,[options,false,response]);},destroyScriptTrans:function(trans,isLoaded){document.getElementsByTagName("head")[0].removeChild(document.getElementById(trans.scriptId));clearTimeout(trans.timeoutId);if(isLoaded){window[trans.cb]=undefined;try{delete window[trans.cb];}catch(e){}}else{window[trans.cb]=function(){window[trans.cb]=undefined;try{delete window[trans.cb];}catch(e){}};}}});Ext.namespace('Ext.ux');Ext.ux.CssProxy=function(config){Ext.ux.CssProxy.superclass.constructor.call(this);Ext.apply(this,config);this.doc=document.documentElement;};Ext.ux.CssProxy.TRANS_ID=1000;Ext.ux.CssProxy.sandbox=function(x){};Ext.ux.CssProxy.MATCH_ORDINAL=/#c(\d+)/;Ext.ux.CssProxy.MATCH_URL=/url\("?data\:[^,]*,([^")]+)"?\)/;Ext.extend(Ext.ux.CssProxy,Ext.data.DataProxy,{timeout:30000,nocache:true,load:function(params,reader,callback,scope,arg){if(this.fireEvent('beforeload',this,params)!==false){if(this.autoAbort!==false){this.abort();}
var p=Ext.urlEncode(Ext.apply(params,this.extraParams));var url=this.url;url+=(url.indexOf('?')!=-1?'&':'?')+p;if(this.nocache){url+='&_dc='+(new Date().getTime());}
var transId=++Ext.ux.CssProxy.TRANS_ID;var trans={id:transId,cb:'chrCallback'+transId,frameId:'chrIframe'+transId,params:params,arg:arg,url:url,callback:callback,scope:scope,reader:reader};var iframe=document.createElement('iframe');iframe.setAttribute('id',trans.frameId);iframe.style.position='absolute';iframe.style.left=iframe.style.top='-1000px';iframe.style.width=iframe.style.height=0;this.doc.appendChild(iframe);trans.document=iframe.contentDocument||iframe.contentWindow.document;window[trans.cb]=this.handleResponse.createDelegate(this,[trans]);trans.document.open('text/html',false);trans.document.write("<html><head>");trans.document.write("<link rel='stylesheet' type='text/css' media='print, csshttprequest' href='"+Ext.util.Format.htmlEncode(url)+"' />");trans.document.write("</head><body>");trans.document.write("<script type='text/javascript'>");trans.document.write("(function(){var w = window; var p = w.parent; p.Ext.ux.CssProxy.sandbox(w); w.onload = function(){p."+trans.cb+"();};})();");trans.document.write("</script>");trans.document.write("</body></html>");trans.document.close();trans.timeoutId=this.handleFailure.defer(this.timeout,this,[trans]);this.trans=trans;}else{callback.call(scope||this,null,arg,false);}},isLoading:function(){return this.trans?true:false;},abort:function(){if(this.isLoading()){this.destroyTrans(this.trans);}},destroyTrans:function(trans,isLoaded){window.setTimeout(function(){try{var iframe=document.getElementById(trans.frameId);iframe.parentNode.removeChild(iframe);}catch(e){var f=e;};},0);clearTimeout(trans.timeoutId);if(isLoaded){window[trans.cb]=undefined;try{delete window[trans.cb];}catch(e){}}else{window[trans.cb]=function(){window[trans.cb]=undefined;try{delete window[trans.cb];}catch(e){}};}},handleResponse:function(trans){var o=this.parseCSS(trans);this.trans=false;this.destroyTrans(trans,true);var result;try{result=trans.reader.read({responseText:o});}catch(e){this.fireEvent('loadexception',this,o,trans.arg,e);trans.callback.call(trans.scope||window,null,trans.arg,false);return;}
this.fireEvent('load',this,o,trans.arg);trans.callback.call(trans.scope||window,result,trans.arg,true);},handleFailure:function(trans){this.trans=false;this.destroyTrans(trans,false);this.fireEvent('loadexception',this,null,trans.arg);trans.callback.call(trans.scope||window,null,trans.arg,false);},parseCSS:function(trans){var data=[];try{var rules=trans.document.styleSheets[0].cssRules||trans.document.styleSheets[0].rules;for(var i=0,len=rules.length;i<len;i++){try{var r=rules.item?rules.item(i):rules[i];var ord=r.selectorText.match(Ext.ux.CssProxy.MATCH_ORDINAL)[1];var val=r.style.backgroundImage.match(Ext.ux.CssProxy.MATCH_URL)[1];data[ord]=val;}catch(e){};}}catch(e){trans.document.getElementsByTagName('link')[0].setAttribute('media','screen');var x=trans.document.createElement('div');x.innerHTML='x';trans.document.body.appendChild(x);var ord=0;try{while(1){x.id='c'+ord;var style=trans.document.defaultView.getComputedStyle(x,null);var bg=style['background-image']||style.backgroundImage||style.getPropertyValue('background-image');var val=bg.match(Ext.ux.CssProxy.MATCH_URL)[1];data[ord]=val;ord++;}}catch(e){};}
return decodeURIComponent(data.join(''));}});Ext.tree.XDomainTreeLoader=function(config){Ext.tree.XDomainTreeLoader.superclass.constructor.call(this,config);};Ext.extend(Ext.tree.XDomainTreeLoader,Ext.tree.TreeLoader,{getParams:function(node){var bp=this.baseParams;bp.node=node.id;return bp;},requestData:function(node,callback){var url=this.url||this.dataUrl;if(url&&!this.proxy){this.proxy=new Ext.data.ScriptTagProxy({url:this.url});}
this.proxy.url=url;if(this.fireEvent("beforeload",this,node,callback)!==false){var p=this.getParams(node);var reader=new Ext.data.JsonReader({root:'children'},['text','id','cls','href','leaf']);this.proxy.load(p,reader,this.handleResponse,this,{cb:callback,node:node});}
else{if(typeof callback=="function"){callback();}}},processResponse:function(data,node,callback){try{var o=data;node.beginUpdate();for(var i=0,len=o.length;i<len;i++){var n=this.createNode(o[i].data);if(n){node.appendChild(n);}}
node.endUpdate();if(typeof callback=="function"){callback(this,node);}}
catch(e){this.handleFailure(data);}},handleResponse:function(data,arg,isSuccess){console.log("data: %o\narg: %o\nisSuccess: %o",data,arg,isSuccess);data=data.records;var o;if(this.rootField){o=data[this.rootField];}
else{o=data;}
this.processResponse(o,arg.node,arg.cb);this.fireEvent("load",this,arg.node,data);},handleFailure:function(data,node,callback){this.transId=false;this.fireEvent("loadexception",this,node,data);if(typeof callback=="function"){callback(this,node);}}});tx={data:{},ui:{}};tx.data.homeagent_url="http://localhost:3000"
tx.data.authorize_con={login_url:tx.data.homeagent_url+"/authorize/login"};tx.data.tasks_con={url:tx.data.homeagent_url+"/tasks/index_remote"};tx.data.tasklists_con={url:tx.data.homeagent_url+"/tasklists/index_remote",update_remote_url:tx.data.homeagent_url+"/tasklists/update_remote",destroy_remote_url:tx.data.homeagent_url+"/tasklists/destroy_remote",create_remote_url:tx.data.homeagent_url+"/tasklists/create_remote",graphics_url:tx.data.homeagent_url+"/tasklists/graphics"};tx.data.notes_con={url:tx.data.homeagent_url+"/notes/index_remote",update_remote_url:tx.data.homeagent_url+"/notes/update_remote",destroy_remote_url:tx.data.homeagent_url+"/notes/destroy_remote",create_remote_url:tx.data.homeagent_url+"/notes/create_remote"};tx.data.collaborates_con={url:tx.data.homeagent_url+"/collaborates/index_remote",update_remote_url:tx.data.homeagent_url+"/collaborates/update_remote",destroy_remote_url:tx.data.homeagent_url+"/collaborates/destroy_remote",create_remote_url:tx.data.homeagent_url+"/collaborates/create_remote"};tx.data.cashrecords_con={url:tx.data.homeagent_url+"/cashrecords/index_remote",update_remote_url:tx.data.homeagent_url+"/cashrecords/update_remote",destroy_remote_url:tx.data.homeagent_url+"/cashrecords/destroy_remote",create_remote_url:tx.data.homeagent_url+"/cashrecords/create_remote",postdirectory_remote_url:tx.data.homeagent_url+"/cashrecords/postdirectory",adoptdirectory_remote_url:tx.data.homeagent_url+"/cashrecords/adoptdirectory",cleandirectory_remote_url:tx.data.homeagent_url+"/cashrecords/cleandirectory",cashrecords_sharelist_remote_url:tx.data.homeagent_url+"/cashrecords/cashrecords_sharelist"};tx.data.contacts_con={url:tx.data.homeagent_url+"/contacts/index_remote",update_remote_url:tx.data.homeagent_url+"/contacts/update_remote",destroy_remote_url:tx.data.homeagent_url+"/contacts/destroy_remote",create_remote_url:tx.data.homeagent_url+"/contacts/create_remote",postdirectory_remote_url:tx.data.homeagent_url+"/contacts/postdirectory",adoptdirectory_remote_url:tx.data.homeagent_url+"/contacts/adoptdirectory",cleandirectory_remote_url:tx.data.homeagent_url+"/contacts/cleandirectory",contacts_sharelist_remote_url:tx.data.homeagent_url+"/contacts/contacts_sharelist"};tx.data.accounts_con={url:tx.data.homeagent_url+"/accounts/index_remote",update_remote_url:tx.data.homeagent_url+"/accounts/update_remote",destroy_remote_url:tx.data.homeagent_url+"/accounts/destroy_remote",create_remote_url:tx.data.homeagent_url+"/accounts/create_remote",postdirectory_remote_url:tx.data.homeagent_url+"/accounts/postdirectory",adoptdirectory_remote_url:tx.data.homeagent_url+"/accounts/adoptdirectory",cleandirectory_remote_url:tx.data.homeagent_url+"/accounts/cleandirectory",accounts_sharelist_remote_url:tx.data.homeagent_url+"/accounts/accounts_sharelist"};tx.data.banks_con={url:tx.data.homeagent_url+"/financials/index_remote",update_remote_url:tx.data.homeagent_url+"/financials/update_remote",destroy_remote_url:tx.data.homeagent_url+"/financials/destroy_remote",create_remote_url:tx.data.homeagent_url+"/financials/create_remote",postdirectory_remote_url:tx.data.homeagent_url+"/financials/postdirectory",adoptdirectory_remote_url:tx.data.homeagent_url+"/financials/adoptdirectory",cleandirectory_remote_url:tx.data.homeagent_url+"/financials/cleandirectory",banks_sharelist_remote_url:tx.data.homeagent_url+"/financials/banks_sharelist"};tx.data.documents_con={url:tx.data.homeagent_url+"/documents/index_remote",update_remote_url:tx.data.homeagent_url+"/documents/update_remote",destroy_remote_url:tx.data.homeagent_url+"/documents/destroy_remote",create_remote_url:tx.data.homeagent_url+"/documents/create_remote",postdirectory_remote_url:tx.data.homeagent_url+"/documents/postdirectory",adoptdirectory_remote_url:tx.data.homeagent_url+"/documents/adoptdirectory",cleandirectory_remote_url:tx.data.homeagent_url+"/documents/cleandirectory",documents_sharelist_remote_url:tx.data.homeagent_url+"/documents/documents_sharelist",documents_upload_url:tx.data.homeagent_url+"/documents/upload_remote"};Ext.uniqueId=function(){var t=String(new Date().getTime()).substr(4);var s='ABCDEFGHIJKLMNOPQRSTUVWXYZ';for(var i=0;i<4;i++){t+=s.charAt(Math.floor(Math.random()*26));}
return t;}
tx.data.Task=Ext.data.Record.create([{name:'taskId',type:'string'},{name:'listId',type:'string'},{name:'title',type:'string'},{name:'description',type:'string'},{name:'dueDate',type:'date',dateFormat:"d-m-Y H:i:s"},{name:'completed',type:'boolean'},{name:'completedDate',type:'date',dateFormat:"d-m-Y H:i:s"},{name:'reminder',type:'date',dateFormat:"d-m-Y H:i:s"}]);tx.data.List=Ext.data.Record.create([{name:'listId',type:'string'},{name:'user_id',type:'string'},{name:'parentId',type:'string'},{name:'listName',type:'string'},{name:'listType',type:'string'},{name:'description',type:'string'},{name:'isFolder',type:'boolean'}]);tx.data.Note=Ext.data.Record.create([{name:'noteId',type:'string'},{name:'user_id',type:'string'},{name:'title',type:'string'},{name:'note',type:'string'},{name:'note_type',type:'string'},{name:'last_update',type:'date',dateFormat:"m-d-Y H:i:s"}]);tx.data.Collaborate=Ext.data.Record.create([{name:'collaborateId',type:'string'},{name:'user_id',type:'string'},{name:'listId',type:'string'},{name:'listName',type:'string'},{name:'title',type:'string'},{name:'link_to',type:'string'},{name:'action_to',type:'string'},{name:'auth_type',type:'string'},{name:'login',type:'string'},{name:'password',type:'string'}]);tx.data.Cashrecord=Ext.data.Record.create([{name:'date',type:'date',dateFormat:"m-d-Y"},{name:'day',type:'string'},{name:'debit',type:'string'},{name:'credit',type:'string'},{name:'antidebit',type:'string'},{name:'anticredit',type:'string'},{name:'total',type:'string'}]);tx.data.Contact=Ext.data.Record.create([{name:'contactId',type:'string'},{name:'contact_name',type:'string'},{name:'contact_type',type:'string'},{name:'address',type:'string'},{name:'city',type:'string'},{name:'country',type:'string'},{name:'phone',type:'string'},{name:'fax',type:'string'},{name:'email',type:'string'},{name:'url',type:'string'}]);tx.data.Account=Ext.data.Record.create([{name:'accountId',type:'string'},{name:'contact_id',type:'string'},{name:'account_no',type:'string'},{name:'account_type',type:'string'},{name:'currency',type:'string'},{name:'balance',type:'string'},{name:'balance_date',type:'date',dateFormat:"m-d-Y H:i:s"},{name:'credit_limit',type:'string'}]);tx.data.Bank=Ext.data.Record.create([{name:'bankId',type:'string'},{name:'name',type:'string'},{name:'branch',type:'string'},{name:'address',type:'string'},{name:'city',type:'string'},{name:'country',type:'string'},{name:'phone',type:'string'},{name:'fax',type:'string'},{name:'email',type:'string'},{name:'url',type:'string'},{name:'conn_person',type:'string'},{name:'businessdate',type:'date',dateFormat:"m-d-Y H:i:s"}]);tx.data.TaskStore=Ext.extend(Ext.data.GroupingStore,{constructor:function(){tx.data.TaskStore.superclass.constructor.call(this,{sortInfo:{field:'dueDate',direction:"ASC"},groupField:'dueDate',taskFilter:'all',reader:new Ext.data.JsonReader({totalProperty:"Total",root:"Tasks",id:'taskId',fields:tx.data.Task})});this.conn=tx.data.tasks_con;this.proxy=new Ext.ux.CssProxy(tx.data.tasks_con);},applyFilter:function(filter){if(filter!==undefined){this.taskFilter=filter;}
var value=this.taskFilter;if(value=='all'){return this.clearFilter();}
return this.filterBy(function(item){return item.data.completed===value;});},addRemote:function(data){this.suspendEvents();Ext.Ajax.request({url:'http://localhost:3000/tasks/create_remote',scriptTag:true,callbackParam:'jsoncallback',timeout:10,params:{format:'js',task:Ext.util.JSON.encode(data)},success:function(r){var aff;},failure:function(r){var fas2;},scope:this});Ext.Ajax.request({url:'/googlecalendar/add_task',timeout:10,params:{task:Ext.util.JSON.encode(data)},success:function(response){var fas;},failure:function(){var fas2;},scope:this});this.resumeEvents();},addTask:function(data){this.suspendEvents();this.clearFilter();this.resumeEvents();this.loadData({Tasks:[data]},true);this.addRemote(data);this.commitChanges();this.suspendEvents();this.applyFilter();this.applyGrouping(true);this.resumeEvents();this.fireEvent('datachanged',this);},removeTask:function(data){this.suspendEvents();Ext.Ajax.request({url:'http://localhost:3000/tasks/destroy_remote',scriptTag:true,callbackParam:'jsoncallback',timeout:10,params:{format:'js',id:data.taskId},success:function(response){var fas;},failure:function(){var fas2;},scope:this});this.resumeEvents();},updateTask:function(data){this.suspendEvents();if(data.dueDate&&data.dueDate!=""){data.dueDate=data.dueDate.format('d-m-Y H:i:s');data.reminder=data.reminder==""?"":data.reminder.format('d-m-Y H:i:s');Ext.Ajax.request({url:'http://localhost:3000/tasks/update_remote',scriptTag:true,callbackParam:'jsoncallback',timeout:10,params:{format:'js',task:Ext.util.JSON.encode(data)},success:function(response){var fas;},failure:function(){var fas2;},scope:this});}
this.reload();this.resumeEvents();},reload:function(){Ext.getCmp('calendar').setHtml(Ext.getCmp('calendar').defaultSrc);},loadList:function(listId){var multi=Ext.isArray(listId);this.activeList=multi?listId[0]:listId;this.suspendEvents();if(multi){var ps=[];for(var i=0,len=listId.length;i<len;i++){ps.push('?');}
this.load({params:{format:'jsonc',tasklist_id:ps}});}else{this.load({params:{format:'jsonc',tasklist_id:listId}});}
this.applyFilter();this.applyGrouping(true);this.resumeEvents();this.fireEvent('datachanged',this);},removeList:function(listId){this.suspendEvents();Ext.Ajax.request({url:'http://localhost:3000/tasklists/destroy_remote',scriptTag:true,callbackParam:'jsoncallback',timeout:10,params:{format:'js',id:listId},success:function(response){var fas;},failure:function(){var fas2;},scope:this});this.reload();this.resumeEvents();},createTask:function(title,listText,dueDate,description,completed){if(!Ext.isEmpty(title)){var listId='';if(!Ext.isEmpty(listText)){listId=tx.data.tasklists.addList(Ext.util.Format.htmlEncode(listText)).id;}else{listId=tx.data.tasklists.newList(false).id;}
var cur_date=new Date();dueDate.setHours(cur_date.getHours()-2);dueDate.setMinutes(cur_date.getMinutes()+2);dueDate.setSeconds(cur_date.getSeconds());this.addTask({taskId:Ext.uniqueId(),title:Ext.util.Format.htmlEncode(title),dueDate:dueDate.format('d-m-Y H:i:s')||'',description:description||'',listId:listId,completed:completed||false});}},afterEdit:function(r){if(r.isModified(this.getGroupState())){this.applyGrouping();}
fixDateMember(r.data,'completedDate');fixDateMember(r.data,'reminder');fixDateMember(r.data,'dueDate');if(r.isModified('completed')){r.editing=true;r.set('completedDate',r.data.completed?new Date():'');r.editing=false;}
tx.data.TaskStore.superclass.afterEdit.apply(this,arguments);},init:function(){this.load({params:{format:'jsonc',description:'TASK'},scope:this,callback:function(){this.reload();}});},lookup:function(id){this.suspendEvents();var task;if(task=this.getById(id)){this.resumeEvents();return task;}
var data=this.proxy.table.lookup(id);if(data){var result=this.reader.readRecords([data]);this.resumeEvents();return result.records[0];}
this.resumeEvents();return null;}});tx.data.ListStore=Ext.extend(Ext.data.Store,{constructor:function(){tx.data.ListStore.superclass.constructor.call(this,{sortInfo:{field:'listName',direction:"ASC"},reader:new Ext.data.JsonReader({id:'listId',totalProperty:"Total",root:"Tasklists",fields:tx.data.List})});this.boundTrees={};this.conn=tx.data.tasklists_con;this.proxy=new Ext.ux.CssProxy(tx.data.tasklists_con);},getName:function(id){var l=this.data.map[id];return l?l.data.listName:'';},addRemote:function(data){Ext.Ajax.request({url:tx.data.tasklists_con.create_remote_url,scriptTag:true,callbackParam:'jsoncallback',timeout:10,params:{format:'js',tasklist:Ext.util.JSON.encode(data)},success:function(r){this.publish('/desktop/notify',{title:'Create List',html:r.responseObject.notice});},failure:function(r){this.publish('/desktop/notify',{title:'Create List',html:r.responseObject.notice});},scope:this});},removeList:function(id){Ext.Ajax.request({url:tx.data.tasklists_con.destroy_remote_url,scriptTag:true,callbackParam:'jsoncallback',timeout:10,params:{format:'js',listId:id},success:function(r){this.publish('/desktop/notify',{title:'Remove List',html:r.responseObject.notice});},failure:function(r){this.publish('/desktop/notify',{title:'Remove List',html:r.responseObject.notice});},scope:this});},updateList:function(node){var l=new tx.data.List({listId:node.id,listName:node.text,listType:node.listType,description:node.description,isFolder:node.attributes.leaf,parentId:node.parentNode.id||'root'},node.id);Ext.Ajax.request({url:tx.data.tasklists_con.update_remote_url,scriptTag:true,callbackParam:'jsoncallback',timeout:10,params:{format:'js',tasklist:Ext.util.JSON.encode(l.data)},success:function(r){this.publish('/desktop/notify',{title:'Update List',html:r.responseObject.notice});},failure:function(r){this.publish('/desktop/notify',{title:'Update List',html:r.responseObject.notice});},scope:this});},addList:function(name,id,listType,description,isFolder,parentId){var l=this.findList(name);if(!l){var id=id||Ext.uniqueId();l=new tx.data.List({listId:id,listName:name,listType:listType,description:description,isFolder:isFolder===true,parentId:parentId||'root'},id);this.addRemote(l.data);this.add(l);}
return l;},newList:function(isFolder,parentId,listType,description){var i=1;var text=isFolder?'New Folder ':'New List ';while(this.findList(text+i)){i++;}
return this.addList(text+i,undefined,listType,description,isFolder,parentId);},findList:function(name){var d=this.data;for(var i=0,len=d.length;i<len;i++){if(d.items[i].data.listName===name){return d.items[i];}}
return null;},bindRoot:function(root){var d=this.data;for(var i=0,len=d.length;i<len;i++){if(d.items[i].data.listType===root.listType&&d.items[i].data.parentId==="root"){return null;}}
this.addList(root.text,undefined,root.listType,'',true,root.id);},bindTree:function(tree){this.boundTrees[tree.id]={add:function(ls,records){var pnode=tree.getNodeById(records[0].data.parentId);if(pnode){pnode.reload();}},remove:function(ls,record){var node=tree.getNodeById(record.id);if(node&&node.parentNode){node.parentNode.removeChild(node);}},update:function(ls,record){var node=tree.getNodeById(record.id);if(node){node.setText(record.data.listName);}},active_tree:tree};this.on(this.boundTrees[tree.id]);},unbindTree:function(tree){var h=this.boundTrees[tree.id];if(h){this.un('add',h.add);this.un('remove',h.remove);this.un('update',h.update);}},init:function(tree,root){if(tree&&root){this.load({params:{format:'jsonc',listType:root.listType},scope:this,callback:function(){this.bindRoot(root);this.boundTrees[tree.id].active_tree.getLoader().load(root);}});}}});tx.data.HomeAgentStore=Ext.extend(Ext.data.GroupingStore,{constructor:function(config){Ext.apply(this,config);tx.data.HomeAgentStore.superclass.constructor.call(this,{sortInfo:{field:config.sort_field,direction:"ASC"},reader:new Ext.data.JsonReader({id:config.host_id,totalProperty:"Total",root:config.host_root,fields:config.record_fields})});this.conn=config.conn
this.proxy=new Ext.ux.CssProxy(config.conn);},loadItem:function(listId){var multi=Ext.isArray(listId);this.activeList=multi?listId[0]:listId;this.suspendEvents();if(multi){var ps=[];for(var i=0,len=listId.length;i<len;i++){ps.push('?');}
this.load({params:{format:'jsonc',tasklist_id:ps}});}else{this.load({params:{format:'jsonc',tasklist_id:listId}});}},addRemote:function(data){Ext.Ajax.request({url:this.conn.create_remote_url,scriptTag:true,callbackParam:'jsoncallback',timeout:10,params:{format:'js',create_data:Ext.util.JSON.encode(data)},success:function(response){var aff;},failure:function(){var fas2;},scope:this});},removeRemote:function(id){Ext.Ajax.request({url:this.conn.destroy_remote_url,scriptTag:true,callbackParam:'jsoncallback',timeout:10,params:{format:'js',destroyId:id},success:function(r){var fas;},failure:function(r){var fas2;},scope:this});},updateRemote:function(node){var l=new tx.data.List({listId:node.id,listName:node.text,isFolder:node.attributes.leaf,parentId:node.parentNode.id||'root'},node.id);Ext.Ajax.request({url:this.conn.update_remote_url,scriptTag:true,callbackParam:'jsoncallback',timeout:10,params:{format:'js',update_data:Ext.util.JSON.encode(l.data)},success:function(r){var fas;},failure:function(r){var fas2;},scope:this});},init:function(params){this.load({params:{format:'jsonc',params:params},scope:this});}});tx.data.tasks=new tx.data.TaskStore();tx.data.tasklists=new tx.data.ListStore({id:'tasklists'});tx.data.collaboratelists=new tx.data.ListStore({id:'collaboratelists'});tx.data.categorylists=new tx.data.ListStore({id:'categorylists'});tx.data.collaborates=new tx.data.HomeAgentStore({conn:tx.data.collaborates_con,host_id:'id',host_root:'Collaborates',record_fields:tx.data.Collaborate,sort_field:'link_to'});tx.data.cashrecords=new tx.data.HomeAgentStore({conn:tx.data.cashrecords_con,host_id:'id',host_root:'Cashrecords',record_fields:tx.data.Cashrecords,sort_field:'date'});tx.data.notes=new tx.data.HomeAgentStore({conn:tx.data.notes_con,host_id:'id',host_root:'Notes',record_fields:tx.data.Note,sort_field:'title'});tx.data.accounts=new tx.data.HomeAgentStore({conn:tx.data.accounts_con,host_id:'id',host_root:'Accounts',record_fields:tx.data.Accounts,sort_field:'account_type'});tx.data.banks=new tx.data.HomeAgentStore({conn:tx.data.banks_con,host_id:'id',host_root:'Banks',record_fields:tx.data.Banks,sort_field:'name'});tx.data.getDefaultReminder=function(task){var s=task.data.dueDate?task.data.dueDate.clearTime(true):new Date().clearTime();s=s.add('mi',Ext.state.Manager.get('defaultReminder'));return s;};tx.data.getActiveListId=function(listType){var storage;if(listType=="TASK")
storage=tx.data.tasklists;else if(listType=="COLLABORATE")
storage=tx.data.collaboratelists;else if(listType=="STRATEGY")
storage=tx.data.tasklists;else if(listType=="CATEGORY")
storage=tx.data.categorylists;var id=storage.activeList;if(!id){var first=storage.getAt(0);if(first){id=first.id;}else{id=storage.newList().id;}}
return id;};Ext.namespace('Ext.ux.form');Ext.ux.form.DateTime=Ext.extend(Ext.form.Field,{defaultAutoCreate:{tag:'input',type:'hidden'},dateWidth:135,timeWidth:100,dtSeparator:' ',hiddenFormat:'d-m-Y H:i:s',otherToNow:true,timePosition:'right',initComponent:function(){Ext.ux.form.DateTime.superclass.initComponent.call(this);var dateConfig=Ext.apply({},{id:this.id+'-date',format:this.dateFormat,width:this.dateWidth,listeners:{blur:{scope:this,fn:this.onBlur},focus:{scope:this,fn:this.onFocus}}},this.dateConfig);this.df=new Ext.form.DateField(dateConfig);delete(this.dateFormat);var timeConfig=Ext.apply({},{id:this.id+'-time',format:this.timeFormat,width:this.timeWidth,listeners:{blur:{scope:this,fn:this.onBlur},focus:{scope:this,fn:this.onFocus}}},this.timeConfig);this.tf=new Ext.form.TimeField(timeConfig);delete(this.timeFormat);this.relayEvents(this.df,['focus','specialkey','invalid','valid']);this.relayEvents(this.tf,['focus','specialkey','invalid','valid']);},onRender:function(ct,position){if(this.isRendered){return;}
Ext.ux.form.DateTime.superclass.onRender.call(this,ct,position);if('below'===this.timePosition){var t=Ext.DomHelper.append(ct,{tag:'table',style:'border-collapse:collapse',children:[{tag:'tr',children:[{tag:'td',style:'padding-bottom:1px',cls:'ux-datetime-date'}]},{tag:'tr',children:[{tag:'td',cls:'ux-datetime-time'}]}]},true);}
else{var t=Ext.DomHelper.append(ct,{tag:'table',style:'border-collapse:collapse',children:[{tag:'tr',children:[{tag:'td',style:'padding-right:4px',cls:'ux-datetime-date'},{tag:'td',cls:'ux-datetime-time'}]}]},true);}
this.tableEl=t;this.wrap=t.wrap({cls:'x-form-field-wrap'});this.wrap.on("mousedown",this.onMouseDown,this,{delay:10});this.df.render(t.child('td.ux-datetime-date'));this.tf.render(t.child('td.ux-datetime-time'));if(Ext.isIE&&Ext.isStrict){t.select('input').applyStyles({top:0});}
this.on('specialkey',this.onSpecialKey,this);this.df.el.swallowEvent(['keydown','keypress']);this.tf.el.swallowEvent(['keydown','keypress']);if('side'===this.msgTarget){var elp=this.el.findParent('.x-form-element',10,true);this.errorIcon=elp.createChild({cls:'x-form-invalid-icon'});this.df.errorIcon=this.errorIcon;this.tf.errorIcon=this.errorIcon;}
this.isRendered=true;},getPositionEl:function(){return this.wrap;},getResizeEl:function(){return this.wrap;},adjustSize:Ext.BoxComponent.prototype.adjustSize,alignErrorIcon:function(){this.errorIcon.alignTo(this.wrap,'tl-tr',[2,0]);},onSpecialKey:function(t,e){if(e.getKey()==e.TAB){if(t===this.df&&!e.shiftKey){e.stopEvent();this.tf.focus();}
if(t===this.tf&&e.shiftKey){e.stopEvent();this.df.focus();}}},setSize:function(w,h){if(!w){return;}
if('below'==this.timePosition){this.df.setSize(w,h);this.tf.setSize(w,h)
if(Ext.isIE){this.df.el.up('td').setWidth(w);this.tf.el.up('td').setWidth(w);}}
else{this.df.setSize(w-this.timeWidth-4,h);this.tf.setSize(this.timeWidth,h);if(Ext.isIE){this.df.el.up('td').setWidth(w-this.timeWidth-4);this.tf.el.up('td').setWidth(this.timeWidth);}}},setValue:function(val){if(!val){this.setDate('');this.setTime('');this.updateValue();return;}
val=new Date(val.getTime());var da,time;if(Ext.isDate(val)){this.setDate(val);this.setTime(val);this.dateValue=new Date(val);}
else{da=val.split(this.dtSeparator);this.setDate(da[0]);if(da[1]){this.setTime(da[1]);}}
this.updateValue();},getValue:function(){return this.dateValue?new Date(this.dateValue):'';},onMouseDown:function(e){this.wrapClick='td'===e.target.nodeName.toLowerCase();},onFocus:function(){if(!this.hasFocus){this.hasFocus=true;this.startValue=this.getValue();this.fireEvent("focus",this);}},onBlur:function(f){if(this.wrapClick){f.focus();this.wrapClick=false;}
if(f===this.df){this.updateDate();}
else{this.updateTime();}
this.updateHidden();(function(){if(!this.df.hasFocus&&!this.tf.hasFocus){var v=this.getValue();if(String(v)!==String(this.startValue)){this.fireEvent("change",this,v,this.startValue);}
this.hasFocus=false;this.fireEvent('blur',this);}}).defer(100,this);},updateDate:function(){var d=this.df.getValue();if(d){if(!Ext.isDate(this.dateValue)){this.initDateValue();if(!this.tf.getValue()){this.setTime(this.dateValue);}}
this.dateValue.setFullYear(d.getFullYear());this.dateValue.setMonth(d.getMonth());this.dateValue.setDate(d.getDate());}
else{this.dateValue='';this.setTime('');}},updateTime:function(){var t=this.tf.getValue();if(t&&!Ext.isDate(t)){t=Date.parseDate(t,this.tf.format);}
if(t&&!this.df.getValue()){this.initDateValue();this.setDate(this.dateValue);}
if(Ext.isDate(this.dateValue)){if(t){this.dateValue.setHours(t.getHours());this.dateValue.setMinutes(t.getMinutes());this.dateValue.setSeconds(t.getSeconds());}
else{this.dateValue.setHours(0);this.dateValue.setMinutes(0);this.dateValue.setSeconds(0);}}},initDateValue:function(){this.dateValue=this.otherToNow?new Date():new Date(1970,0,1,0,0,0);},updateHidden:function(){if(this.isRendered){var value=Ext.isDate(this.dateValue)?this.dateValue.format(this.hiddenFormat):'';this.el.dom.value=value;}},updateValue:function(){this.updateDate();this.updateTime();this.updateHidden();return;},setDate:function(date){this.df.setValue(date);},setTime:function(date){this.tf.setValue(date);},isValid:function(){return this.df.isValid()&&this.tf.isValid();},validate:function(){return this.df.validate()&&this.tf.validate();},focus:function(){this.df.focus();},onDisable:function(){if(this.rendered){this.df.disable();this.tf.disable();}},onEnable:function(){if(this.rendered){this.df.enable();this.tf.enable();}}});Ext.reg('xdatetime',Ext.ux.form.DateTime);Ext.BLANK_IMAGE_URL='images/s.gif';function fixDate(d){return d?new Date(d.getTime()):d;}
function fixDateMember(o,name){if(o[name]){o[name]=new Date((typeof(o[name])=='string')?new Date(o[name]).getTime():o[name].getTime());}}
Ext.ux.SelectBox=function(config){this.searchResetDelay=1000;config=config||{};config=Ext.apply(config||{},{editable:false,forceSelection:true,rowHeight:false,lastSearchTerm:false,triggerAction:'all',mode:'local'});Ext.ux.SelectBox.superclass.constructor.apply(this,arguments);this.lastSelectedIndex=this.selectedIndex||0;};Ext.extend(Ext.ux.SelectBox,Ext.form.ComboBox,{lazyInit:false,initEvents:function(){Ext.ux.SelectBox.superclass.initEvents.apply(this,arguments);this.el.on('keydown',this.keySearch,this,true);this.cshTask=new Ext.util.DelayedTask(this.clearSearchHistory,this);},keySearch:function(e,target,options){var raw=e.getKey();var key=String.fromCharCode(raw);var startIndex=0;if(!this.store.getCount()){return;}
switch(raw){case Ext.EventObject.HOME:e.stopEvent();this.selectFirst();return;case Ext.EventObject.END:e.stopEvent();this.selectLast();return;case Ext.EventObject.PAGEDOWN:this.selectNextPage();e.stopEvent();return;case Ext.EventObject.PAGEUP:this.selectPrevPage();e.stopEvent();return;}
if((e.hasModifier()&&!e.shiftKey)||e.isNavKeyPress()||e.isSpecialKey()){return;}
if(this.lastSearchTerm==key){startIndex=this.lastSelectedIndex;}
this.search(this.displayField,key,startIndex);this.cshTask.delay(this.searchResetDelay);},onRender:function(ct,position){this.store.on('load',this.calcRowsPerPage,this);Ext.ux.SelectBox.superclass.onRender.apply(this,arguments);if(this.mode=='local'){this.calcRowsPerPage();}},onSelect:function(record,index,skipCollapse){if(this.fireEvent('beforeselect',this,record,index)!==false){this.setValue(record.data[this.valueField||this.displayField]);if(!skipCollapse){this.collapse();}
this.lastSelectedIndex=index+1;this.fireEvent('select',this,record,index);}},render:function(ct){Ext.ux.SelectBox.superclass.render.apply(this,arguments);if(Ext.isSafari){this.el.swallowEvent('mousedown',true);}
this.el.unselectable();this.innerList.unselectable();this.trigger.unselectable();this.innerList.on('mouseup',function(e,target,options){if(target.id&&target.id==this.innerList.id){return;}
this.onViewClick();},this);this.innerList.on('mouseover',function(e,target,options){if(target.id&&target.id==this.innerList.id){return;}
this.lastSelectedIndex=this.view.getSelectedIndexes()[0]+1;this.cshTask.delay(this.searchResetDelay);},this);this.trigger.un('click',this.onTriggerClick,this);this.trigger.on('mousedown',function(e,target,options){e.preventDefault();this.onTriggerClick();},this);this.on('collapse',function(e,target,options){Ext.getDoc().un('mouseup',this.collapseIf,this);},this,true);this.on('expand',function(e,target,options){Ext.getDoc().on('mouseup',this.collapseIf,this);},this,true);},clearSearchHistory:function(){this.lastSelectedIndex=0;this.lastSearchTerm=false;},selectFirst:function(){this.focusAndSelect(this.store.data.first());},selectLast:function(){this.focusAndSelect(this.store.data.last());},selectPrevPage:function(){if(!this.rowHeight){return;}
var index=Math.max(this.selectedIndex-this.rowsPerPage,0);this.focusAndSelect(this.store.getAt(index));},selectNextPage:function(){if(!this.rowHeight){return;}
var index=Math.min(this.selectedIndex+this.rowsPerPage,this.store.getCount()-1);this.focusAndSelect(this.store.getAt(index));},search:function(field,value,startIndex){field=field||this.displayField;this.lastSearchTerm=value;var index=this.store.find.apply(this.store,arguments);if(index!==-1){this.focusAndSelect(index);}},focusAndSelect:function(record){var index=typeof record==='number'?record:this.store.indexOf(record);this.select(index,this.isExpanded());this.onSelect(this.store.getAt(record),index,this.isExpanded());},calcRowsPerPage:function(){if(this.store.getCount()){this.rowHeight=Ext.fly(this.view.getNode(0)).getHeight();this.rowsPerPage=this.maxHeight/this.rowHeight;}else{this.rowHeight=false;}}});ListLoader=function(config){Ext.apply(this,config);};Ext.extend(ListLoader,Ext.util.Observable,{keyAttribute:'id',keyField:'parentId',load:function(node,callback){var key=this.keyField;var v=node.attributes[this.keyAttribute];var rs=this.store.queryBy(function(r){return r.data[key]===v;});while(node.firstChild){node.removeChild(node.firstChild);}
node.beginUpdate();for(var i=0,d=rs.items,len=d.length;i<len;i++){var n=this.createNode(d[i]);if(n){node.appendChild(n);}}
node.endUpdate();if(typeof callback=="function"){callback(this,node);}},createNode:function(record){var d=record.data,n;if(d.isFolder){n=new Ext.tree.AsyncTreeNode({loader:this,id:record.id.toString(),text:d.listName,leaf:false,iconCls:'icon-folder',editable:true,expanded:true,isFolder:true});}else{n=new Ext.tree.TreeNode({id:record.id.toString(),text:d.listName,leaf:true,iconCls:'icon-list',editable:true});}
return n;}});ListTree=function(config){ListTree.superclass.constructor.call(this,Ext.apply({enableDD:false,animate:false,rootVisible:false,split:true,autoScroll:true,margins:'3 0 3 3',cmargins:'3 3 3 3',useArrows:true,collapsible:true,minWidth:120},config));this.on('contextmenu',this.onContextMenu,this);this.on('textchange',this.onTextchange,this);this.on('nodedrop',this.onNodeDrop,this,{buffer:100});this.on('beforenodedrop',this.onBeforeNodeDrop,this);this.on('nodedragover',this.onNodeDragOver,this);}
Ext.extend(ListTree,Ext.tree.TreePanel,{initComponent:function(){this.loader=new ListLoader({store:this.store});ListTree.superclass.initComponent.call(this);var root=new Ext.tree.AsyncTreeNode({text:'All Lists',id:'root',leaf:false,iconCls:'icon-folder',expanded:true,isFolder:true,editable:false,draggable:false});this.setRootNode(root);this.editor=new Ext.tree.TreeEditor(this,{allowBlank:false,blankText:'A name is required',selectOnFocus:true});this.editor.shadow=false;this.editor.on('beforecomplete',function(ed,value,startValue){var node=ed.editNode;value=Ext.util.Format.htmlEncode(value);var r=this.store.getById(node.id);r.set('listName',value);},this);this.sorter=new Ext.tree.TreeSorter(this,{folderSort:false,sortType:function(node){return parseInt(node.id,10);}});},getActiveFolderId:function(){var sm=this.selModel;var n=sm.getSelectedNode();if(n){return n.attributes.isFolder?n.id:n.attributes.parentId;}
return'root';},onContextMenu:function(node,e){if(!this.menu){this.menu=new Ext.menu.Menu({id:'lists-ctx',listWidth:200,items:[{iconCls:'icon-edit',text:'Open List Item',scope:this,handler:function(){this.ctxNode.select();this.actions.newTask.execute(this.ctxNode);}},{iconCls:'icon-list-new',text:'New List',scope:this,handler:function(){this.ctxNode.select();this.actions.newList.execute();}},{iconCls:'icon-folder-new',text:'New Folder',scope:this,handler:function(){this.ctxNode.select();this.actions.newFolder.execute();}},'-',{text:'Delete',iconCls:'icon-list-delete',scope:this,handler:function(){this.removeList(this.ctxNode);}}]});this.menu.on('hide',this.onContextHide,this);}
if(this.ctxNode){this.ctxNode.ui.removeClass('x-node-ctx');this.ctxNode=null;}
this.ctxNode=node;this.ctxNode.ui.addClass('x-node-ctx');this.menu.items.get(1).setVisible(!!node.attributes.isFolder);this.menu.items.get(2).setVisible(!!node.attributes.isFolder);this.menu.items.get(0).setVisible(!node.attributes.isFolder);this.menu.showAt(e.getXY());},onContextHide:function(){if(this.ctxNode){this.ctxNode.ui.removeClass('x-node-ctx');this.ctxNode=null;}},startEdit:function(node,select){if(typeof node=='string'){node=this.getNodeById(node);}
if(select===true){node.select();}
var ed=this.editor;setTimeout(function(){ed.editNode=node;ed.startEdit(node.ui.textNode);},10);},onTextchange:function(node,text,oldText){if(text!=oldText)
{this.loader.store.updateList(node);}},removeList:function(s){if(s&&s.attributes.editable){Ext.Msg.confirm('Confirm','Are you sure you want to delete "'+Ext.util.Format.htmlEncode(s.text)+'"?',function(btn){if(btn=='yes'){if(s.nextSibling){s.nextSibling.select();}
else
if(s.previousSibling){s.previousSibling.select();}
s.parentNode.removeChild(s);this.store.removeList(s.id);this.store.remove(this.store.getById(s.id));tx.data.tasks.removeList(s.id);}},this);}},onNodeDrop:function(de){var node=de.target;if(de.point!='above'&&de.point!='below'){node=node.parentNode||node;}},onBeforeNodeDrop:function(de){if(!de.rawEvent.ctrlKey){return true;}
var ns=de.dropNode,p=de.point,t=de.target;if(!(ns instanceof Array)){ns=[ns];}
var n;for(var i=0,len=ns.length;i<len;i++){n=cloneNode(ns[i]);if(p=="above"){t.parentNode.insertBefore(n,t);}else if(p=="below"){t.parentNode.insertBefore(n,t.nextSibling);}else{t.appendChild(n);}}
n.ui.focus();if(de.tree.hlDrop){n.ui.highlight();}
t.ui.endDrop();de.tree.fireEvent("nodedrop",de);return false;},onNodeDragOver:function(de){var p=de.point,t=de.target;if(p=="above"||t=="below"){t=t.parentNode;}
if(!t){return false;}
return(this.canAppend({},t)===true);}});Ext.menu.TreeItem=Ext.extend(Ext.menu.Adapter,{constructor:function(config){Ext.menu.TreeItem.superclass.constructor.call(this,config.tree,config);this.tree=this.component;this.addEvents('selectionchange');this.tree.on("render",function(tree){tree.body.swallowEvent(['click','keydown','keypress','keyup']);});this.tree.getSelectionModel().on("selectionchange",this.onSelect,this);},onSelect:function(tree,sel){this.fireEvent("select",this,sel,tree);}});Ext.menu.TreeMenu=Ext.extend(Ext.menu.Menu,{cls:'x-tree-menu',hideOnClick:false,plain:true,constructor:function(config){Ext.menu.TreeMenu.superclass.constructor.call(this,config);this.treeItem=new Ext.menu.TreeItem(config);this.add(this.treeItem);this.tree=this.treeItem.tree;this.tree.on('click',this.onNodeClick,this);this.relayEvents(this.treeItem,["selectionchange"]);},beforeDestroy:function(){this.tree.destroy();},onNodeClick:function(node,e){if(!node.attributes.isFolder){this.treeItem.handleClick(e);}}});Ext.ux.TreeSelector=Ext.extend(Ext.form.TriggerField,{initComponent:function(){Ext.ux.TreeSelector.superclass.initComponent.call(this);this.addEvents('selectionchange');this.tree.getSelectionModel().on('selectionchange',this.onSelection,this);this.tree.on({'expandnode':this.sync,'collapsenode':this.sync,'append':this.sync,'remove':this.sync,'insert':this.sync,scope:this});this.on('focus',this.onTriggerClick,this);},sync:function(){if(this.menu&&this.menu.isVisible()){if(this.tree.body.getHeight()>this.maxHeight){this.tree.body.setHeight(this.maxHeight);this.restricted=true;}else if(this.restricted&&this.tree.body.dom.firstChild.offsetHeight<this.maxHeight){this.tree.body.setHeight('');this.restricted=false;}
this.menu.el.sync();}},onSelection:function(tree,node){if(!node){this.setRawValue('');}else{this.setRawValue(node.text);}},initEvents:function(){Ext.ux.TreeSelector.superclass.initEvents.call(this);this.el.on('mousedown',this.onTriggerClick,this);this.el.on("keydown",this.onKeyDown,this);},onKeyDown:function(e){if(e.getKey()==e.DOWN){this.onTriggerClick();}},validateBlur:function(){return!this.menu||!this.menu.isVisible();},getValue:function(){var sm=this.tree.getSelectionModel();var s=sm.getSelectedNode();return s?s.id:'';},setValue:function(id){var n=this.tree.getNodeById(id);if(n){n.select();}else{this.tree.getSelectionModel().clearSelections();}},onDestroy:function(){if(this.menu){this.menu.destroy();}
if(this.wrap){this.wrap.remove();}
Ext.ux.TreeSelector.superclass.onDestroy.call(this);},menuListeners:{show:function(){this.onFocus();},hide:function(){this.focus.defer(10,this);var ml=this.menuListeners;this.menu.un("show",ml.show,this);this.menu.un("hide",ml.hide,this);}},onTriggerClick:function(){if(this.disabled){return;}
this.menu.on(Ext.apply({},this.menuListeners,{scope:this}));this.menu.show(this.el,"tl-bl?");this.sync();var sm=this.tree.getSelectionModel();var selected=sm.getSelectedNode();if(selected){selected.ensureVisible();sm.activate.defer(250,sm,[selected]);}},beforeBlur:function(){},onRender:function(){Ext.ux.TreeSelector.superclass.onRender.apply(this,arguments);this.menu=new Ext.menu.TreeMenu(Ext.apply(this.menuConfig||{},{tree:this.tree}));this.menu.render();this.tree.body.addClass('x-tree-selector');},readOnly:true});Ext.tree.ActivationModel=Ext.extend(Ext.tree.DefaultSelectionModel,{select:function(node){return this.activate(Ext.tree.ActivationModel.superclass.select.call(this,node));},activate:function(node){if(!node){return;}
if(this.activated!=node){if(this.activated){this.activated.ui.removeClass('x-tree-activated');}
this.activated=node;node.ui.addClass('x-tree-activated');}
node.ui.focus();return node;},activatePrevious:function(){var s=this.activated;if(!s){return null;}
var ps=s.previousSibling;if(ps){if(!ps.isExpanded()||ps.childNodes.length<1){return this.activate(ps);}else{var lc=ps.lastChild;while(lc&&lc.isExpanded()&&lc.childNodes.length>0){lc=lc.lastChild;}
return this.activate(lc);}}else if(s.parentNode&&(this.tree.rootVisible||!s.parentNode.isRoot)){return this.activate(s.parentNode);}
return null;},activateNext:function(){var s=this.activated;if(!s){return null;}
if(s.firstChild&&s.isExpanded()){return this.activate(s.firstChild);}else if(s.nextSibling){return this.activate(s.nextSibling);}else if(s.parentNode){var newS=null;s.parentNode.bubble(function(){if(this.nextSibling){newS=this.getOwnerTree().selModel.activate(this.nextSibling);return false;}});return newS;}
return null;},onKeyDown:function(e){var s=this.activated;var sm=this;if(!s){return;}
var k=e.getKey();switch(k){case e.DOWN:e.stopEvent();this.activateNext();break;case e.UP:e.stopEvent();this.activatePrevious();break;case e.RIGHT:e.preventDefault();if(s.hasChildNodes()){if(!s.isExpanded()){s.expand();}else if(s.firstChild){this.activate(s.firstChild,e);}}
break;case e.LEFT:e.preventDefault();if(s.hasChildNodes()&&s.isExpanded()){s.collapse();}else if(s.parentNode&&(this.tree.rootVisible||s.parentNode!=this.tree.getRootNode())){this.activate(s.parentNode,e);}
break;};}});ListSelector=Ext.extend(Ext.ux.TreeSelector,{maxHeight:200,listenForLoad:false,initComponent:function(){this.tree=new Ext.tree.TreePanel({animate:false,border:false,rootVisible:false,width:this.treeWidth||180,autoScroll:true,useArrows:true,selModel:new Ext.tree.ActivationModel(),loader:new ListLoader({store:this.store})});var root=this.root=new Ext.tree.AsyncTreeNode({text:'All Lists',id:'root',leaf:false,iconCls:'icon-folder',expanded:true,isFolder:true});this.tree.setRootNode(root);this.tree.on('render',function(){this.store.bindTree(this.tree);},this);ListSelector.superclass.initComponent.call(this);this.root.listType=this.root_listType;this.root.text=this.root_text;this.store.init(this.tree,this.root);this.tree.getSelectionModel().on('beforeselect',this.beforeSelection,this);this.tree.getSelectionModel().on('selectionchange',this.selectionChange,this);if(this.listenForLoad){this.store.on('load',function(){root.reload();},this,{single:true});}},beforeSelection:function(tree,node){if(node&&node.attributes.isFolder){node.toggle();return false;}},selectionChange:function(tree){return true;}});Ext.namespace('Ext.ux');Ext.ux.GMapPanel=Ext.extend(Ext.Panel,{respErrors:[{code:G_GEO_BAD_REQUEST,msg:'A directions request could not be successfully parsed. For example, the request may have been rejected if it contained more than the maximum number of waypoints allowed.'},{code:G_GEO_SERVER_ERROR,msg:'A geocoding or directions request could not be successfully processed, yet the exact reason for the failure is not known.'},{code:G_GEO_MISSING_QUERY,msg:'The HTTP q parameter was either missing or had no value. For geocoding requests, this means that an empty address was specified as input. For directions requests, this means that no query was specified in the input.'},{code:G_GEO_MISSING_ADDRESS,msg:'Synonym for G_GEO_MISSING_QUERY.'},{code:G_GEO_UNKNOWN_ADDRESS,msg:'No corresponding geographic location could be found for the specified address. This may be due to the fact that the address is relatively new, or it may be incorrect.'},{code:G_GEO_UNAVAILABLE_ADDRESS,msg:'The geocode for the given address or the route for the given directions query cannot be returned due to legal or contractual reasons.'},{code:G_GEO_UNKNOWN_DIRECTIONS,msg:'The GDirections object could not compute directions between the points mentioned in the query. This is usually because there is no route available between the two points, or because we do not have data for routing in that region.'},{code:G_GEO_BAD_KEY,msg:'The given key is either invalid or does not match the domain for which it was given.'},{code:G_GEO_TOO_MANY_QUERIES,msg:'The given key has gone over the requests limit in the 24 hour period or has submitted too many requests in too short a period of time. If you\'re sending multiple requests in parallel or in a tight loop, use a timer or pause in your code to make sure you don\'t send the requests too quickly.'}],respErrorTitle:'Error',geoErrorMsgUnable:'Unable to Locate the Address you provided',geoErrorTitle:'Address Location Error',geoErrorMsgAccuracy:'The address provided has a low accuracy.<br><br>Level {0} Accuracy (8 = Exact Match, 1 = Vague Match)',initComponent:function(){var defConfig={plain:true,zoomLevel:0,yaw:180,pitch:0,gmapType:'map',border:false,displayGeoErrors:false,minGeoAccuracy:7,mapDefined:false,mapDefinedGMap:false};Ext.applyIf(this,defConfig);Ext.ux.GMapPanel.superclass.initComponent.call(this);},afterRender:function(){var wh=this.ownerCt.getSize();Ext.applyIf(this,wh);Ext.ux.GMapPanel.superclass.afterRender.call(this);if(this.gmapType==='map'){this.gmap=new GMap2(this.body.dom);this.mapDefined=true;this.mapDefinedGMap=true;}
if(this.gmapType==='panorama'){this.gmap=new GStreetviewPanorama(this.body.dom);this.mapDefined=true;}
if(!this.mapDefined&&this.gmapType){this.gmap=new GMap2(this.body.dom);this.gmap.setMapType(this.gmapType);this.mapDefined=true;this.mapDefinedGMap=true;}
if(typeof this.addControl=='object'&&this.mapDefinedGMap){this.getMap().addControl(this.addControl);}
this.addMapControls();this.addOptions();if(typeof this.setCenter==='object'){if(typeof this.setCenter.geoCodeAddr==='string'){this.geoCodeLookup(this.setCenter.geoCodeAddr,this.setCenter.marker,false,true,this.setCenter.listeners);}else{if(this.gmapType==='map'){var point=this.fixLatLng(new GLatLng(this.setCenter.lat,this.setCenter.lng));this.getMap().setCenter(point,this.zoomLevel);}
if(typeof this.setCenter.marker==='object'&&typeof point==='object'){this.addMarker(point,this.setCenter.marker,this.setCenter.marker.clear);}}
if(this.gmapType==='panorama'){this.getMap().setLocationAndPOV(new GLatLng(this.setCenter.lat,this.setCenter.lng),{yaw:this.yaw,pitch:this.pitch,zoom:this.zoomLevel});}}
GEvent.bind(this.gmap,'load',this,function(){this.onMapReady();});},onMapReady:function(){this.addMarkers(this.markers);this.addKMLOverlay(this.autoLoadKML);},onResize:function(w,h){if(typeof this.getMap()=='object'){this.getMap().checkResize();}
Ext.ux.GMapPanel.superclass.onResize.call(this,w,h);},setSize:function(width,height,animate){if(typeof this.getMap()=='object'){this.getMap().checkResize();}
Ext.ux.GMapPanel.superclass.setSize.call(this,width,height,animate);},getMap:function(){return this.gmap;},getCenter:function(){return this.fixLatLng(this.getMap().getCenter());},getCenterLatLng:function(){var ll=this.getCenter();return{lat:ll.lat(),lng:ll.lng()};},addMarkers:function(markers){if(Ext.isArray(markers)){for(var i=0;i<markers.length;i++){if(typeof markers[i].geoCodeAddr=='string'){this.geoCodeLookup(markers[i].geoCodeAddr,markers[i].marker,false,markers[i].setCenter,markers[i].listeners);}else{var mkr_point=this.fixLatLng(new GLatLng(markers[i].lat,markers[i].lng));this.addMarker(mkr_point,markers[i].marker,false,markers[i].setCenter,markers[i].listeners);}}}},addMarker:function(point,marker,clear,center,listeners){Ext.applyIf(marker,G_DEFAULT_ICON);if(clear===true){this.getMap().clearOverlays();}
if(center===true){this.getMap().setCenter(point,this.zoomLevel);}
var mark=new GMarker(point,marker);if(typeof listeners==='object'){for(evt in listeners){GEvent.bind(mark,evt,this,listeners[evt]);}}
this.getMap().addOverlay(mark);},addMapControls:function(){if(this.gmapType==='map'){if(Ext.isArray(this.mapControls)){for(i=0;i<this.mapControls.length;i++){this.addMapControl(this.mapControls[i]);}}else if(typeof this.mapControls==='string'){this.addMapControl(this.mapControls);}else if(typeof this.mapControls==='object'){this.getMap().addControl(this.mapControls);}}},addMapControl:function(mc){var mcf=window[mc];if(typeof mcf==='function'){this.getMap().addControl(new mcf());}},addOptions:function(){if(Ext.isArray(this.mapConfOpts)){var mc;for(i=0;i<this.mapConfOpts.length;i++){this.addOption(this.mapConfOpts[i]);}}else if(typeof this.mapConfOpts==='string'){this.addOption(this.mapConfOpts);}},addOption:function(mo){var mof=this.getMap()[mo];if(typeof mof==='function'){this.getMap()[mo]();}},addKMLOverlay:function(kmlfile){if(typeof kmlfile==='string'&&kmlfile!==''){var geoXml=new GGeoXml(kmlfile);this.getMap().addOverlay(geoXml);}},geoCodeLookup:function(addr,marker,clear,center,listeners){if(!this.geocoder){this.geocoder=new GClientGeocoder();}
this.geocoder.getLocations(addr,this.addAddressToMap.createDelegate(this,[addr,marker,clear,center,listeners],true));},addAddressToMap:function(response,addr,marker,clear,center,listeners){if(!response||response.Status.code!=200){this.respErrorMsg(response.Status.code);}else{place=response.Placemark[0];addressinfo=place.AddressDetails;accuracy=addressinfo.Accuracy;if(accuracy===0){this.geoErrorMsg(this.geoErrorTitle,this.geoErrorMsgUnable);}else{if(accuracy<this.minGeoAccuracy){this.geoErrorMsg(this.geoErrorTitle,String.format(this.geoErrorMsgAccuracy,accuracy));}else{point=this.fixLatLng(new GLatLng(place.Point.coordinates[1],place.Point.coordinates[0]));if(center){this.getMap().setCenter(point,this.zoomLevel);}
if(typeof marker==='object'){if(!marker.title){marker.title=place.address;}
Ext.applyIf(marker,G_DEFAULT_ICON);this.addMarker(point,marker,clear,false,listeners);}}}}},geoErrorMsg:function(title,msg){if(this.displayGeoErrors){Ext.MessageBox.alert(title,msg);}},respErrorMsg:function(code){Ext.each(this.respErrors,function(obj){if(code==obj.code){Ext.MessageBox.alert(this.respErrorTitle,obj.msg);}},this);},fixLatLng:function(llo){if(this.getMap().getCurrentMapType().QO=='visible'){llo.lat(180-llo.lat());llo.lng(180-llo.lng());}
return llo;}});Ext.reg('gmappanel',Ext.ux.GMapPanel);